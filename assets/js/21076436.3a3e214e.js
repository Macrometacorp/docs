"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[1302],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>m});var r=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),c=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=c(e.components);return r.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),d=c(n),m=a,h=d["".concat(s,".").concat(m)]||d[m]||p[m]||o;return n?r.createElement(h,i(i({ref:t},u),{},{components:n})):r.createElement(h,i({ref:t},u))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var c=2;c<o;c++)i[c]=n[c];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},55169:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>p,frontMatter:()=>o,metadata:()=>l,toc:()=>c});var r=n(87462),a=(n(67294),n(3905));const o={sidebar_position:40,title:"Part 4 - Import Traits and Merge"},i=void 0,l={unversionedId:"queryworkers/c8ql/got-tutorial/import-and-merge",id:"queryworkers/c8ql/got-tutorial/import-and-merge",title:"Part 4 - Import Traits and Merge",description:"This section explains how to use queries to combine information in collections.",source:"@site/docs/queryworkers/c8ql/got-tutorial/import-and-merge.md",sourceDirName:"queryworkers/c8ql/got-tutorial",slug:"/queryworkers/c8ql/got-tutorial/import-and-merge",permalink:"/docs/queryworkers/c8ql/got-tutorial/import-and-merge",draft:!1,editUrl:"https://github.com/macrometacorp/docs/edit/main/docs/queryworkers/c8ql/got-tutorial/import-and-merge.md",tags:[],version:"current",sidebarPosition:40,frontMatter:{sidebar_position:40,title:"Part 4 - Import Traits and Merge"},sidebar:"defaultSidebar",previous:{title:"Part 3 - Sort and Limit",permalink:"/docs/queryworkers/c8ql/got-tutorial/sort-and-limit"},next:{title:"Part 5 - Graph Traversal",permalink:"/docs/queryworkers/c8ql/got-tutorial/graph-traversal"}},s={},c=[{value:"References to Other Document Collections",id:"references-to-other-document-collections",level:2},{value:"Import Traits Data",id:"import-traits-data",level:2},{value:"Resolve Traits",id:"resolve-traits",level:2},{value:"Merge Characters and Traits",id:"merge-characters-and-traits",level:2},{value:"Next Steps",id:"next-steps",level:2}],u={toc:c};function p(e){let{components:t,...o}=e;return(0,a.kt)("wrapper",(0,r.Z)({},u,o,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"This section explains how to use queries to combine information in collections."),(0,a.kt)("h2",{id:"references-to-other-document-collections"},"References to Other Document Collections"),(0,a.kt)("p",null,"The character data you imported has an attribute ",(0,a.kt)("em",{parentName:"p"},"traits")," for each character, which is an array of strings. It does not store character features directly, however. Instead, it lists letters that represent traits. For example, Ned Stark has five traits."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "name": "Ned",\n    ...\n    "traits": ["A","H","C","N","P"]\n}\n')),(0,a.kt)("p",null,"The idea here is that ",(0,a.kt)("em",{parentName:"p"},"traits")," is supposed to store documents keys of another collection, which you can use to resolve the letters to labels such as ",(0,a.kt)("inlineCode",{parentName:"p"},"strong"),". By using another collection for the actual traits, you can easily query for all existing traits later on and store labels in multiple languages for instance in a central place. If you embedded traits directly, it becomes unmanageable."),(0,a.kt)("p",null,"Here's Ned Stark with his traits written out:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "name": "Ned",\n    ...\n    "traits": [\n        {\n            "de": "stark",\n            "en": "strong"\n        },\n        {\n            "de": "einflussreich",\n            "en": "powerful"\n        },\n        {\n            "de": "loyal",\n            "en": "loyal"\n        },\n        {\n            "de": "rational",\n            "en": "rational"\n        },\n        {\n            "de": "mutig",\n            "en": "brave"\n        }\n    ]\n}\n')),(0,a.kt)("p",null,"If you were to rename or translate one trait, then you would need to find all other character documents with the same trait and perform the changes there too. If you only refer to a trait in another collection, then you just need to update one record in a single document."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Comparison_DataModels",src:n(33092).Z,width:"742",height:"800"})),(0,a.kt)("h2",{id:"import-traits-data"},"Import Traits Data"),(0,a.kt)("p",null,"Below you find the traits data. Follow the pattern shown in ",(0,a.kt)("a",{parentName:"p",href:"/docs/queryworkers/c8ql/got-tutorial/c8ql-crud#create-documents"},"Create Documents")," to import it:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Create a document collection named ",(0,a.kt)("strong",{parentName:"li"},"Traits"),"."),(0,a.kt)("li",{parentName:"ol"},"Assign the data to a variable in C8QL, ",(0,a.kt)("inlineCode",{parentName:"li"},"LET data = [ ... ]"),"."),(0,a.kt)("li",{parentName:"ol"},"Use a ",(0,a.kt)("inlineCode",{parentName:"li"},"FOR")," loop to iterate over each array element of the data."),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("inlineCode",{parentName:"li"},"INSERT")," the element ",(0,a.kt)("inlineCode",{parentName:"li"},"INTO Traits"),".")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'[\n    { "_key": "A", "en": "strong", "de": "stark" },\n    { "_key": "B", "en": "polite", "de": "freundlich" },\n    { "_key": "C", "en": "loyal", "de": "loyal" },\n    { "_key": "D", "en": "beautiful", "de": "sch\xf6n" },\n    { "_key": "E", "en": "sneaky", "de": "hinterlistig" },\n    { "_key": "F", "en": "experienced", "de": "erfahren" },\n    { "_key": "G", "en": "corrupt", "de": "korrupt" },\n    { "_key": "H", "en": "powerful", "de": "einflussreich" },\n    { "_key": "I", "en": "naive", "de": "naiv" },\n    { "_key": "J", "en": "unmarried", "de": "unverheiratet" },\n    { "_key": "K", "en": "skillful", "de": "geschickt" },\n    { "_key": "L", "en": "young", "de": "jung" },\n    { "_key": "M", "en": "smart", "de": "klug" },\n    { "_key": "N", "en": "rational", "de": "rational" },\n    { "_key": "O", "en": "ruthless", "de": "skrupellos" },\n    { "_key": "P", "en": "brave", "de": "mutig" },\n    { "_key": "Q", "en": "mighty", "de": "m\xe4chtig" },\n    { "_key": "R", "en": "weak", "de": "schwach" }\n]\n')),(0,a.kt)("h2",{id:"resolve-traits"},"Resolve Traits"),(0,a.kt)("p",null,"Let's start simple by returning only the traits attribute of each character:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"FOR c IN Characters\n    RETURN c.traits\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'[\n    { "traits": ["A","H","C","N","P"] },\n    { "traits": ["D","H","C"] },\n    ...\n]\n')),(0,a.kt)("p",null,"You can use the ",(0,a.kt)("em",{parentName:"p"},"traits")," array together with the ",(0,a.kt)("inlineCode",{parentName:"p"},"DOCUMENT()")," function to use the elements as document keys and look up them up in the Traits collection:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'FOR c IN Characters\n    RETURN DOCUMENT("Traits", c.traits)\n')),(0,a.kt)("p",null,"The results return a Trait document with all fields for each trait for each character. Here is part of the first one:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'[\n  [\n    {\n      "_key": "A",\n      "_id": "Traits/A",\n      "_rev": "_V5oRUS2---",\n      "en": "strong",\n      "de": "stark"\n    },\n    {\n      "_key": "H",\n      "_id": "Traits/H",\n      "_rev": "_V5oRUS6--E",\n      "en": "powerful",\n      "de": "einflussreich"\n    },\n    {\n      "_key": "C",\n      "_id": "Traits/C",\n      "_rev": "_V5oRUS6--_",\n      "en": "loyal",\n      "de": "loyal"\n    },\n    {\n      "_key": "N",\n      "_id": "Traits/N",\n      "_rev": "_V5oRUT---D",\n      "en": "rational",\n      "de": "rational"\n    },\n    {\n      "_key": "P",\n      "_id": "Traits/P",\n      "_rev": "_V5oRUTC---",\n      "en": "brave",\n      "de": "mutig"\n    }\n  ],\n  [\n    {\n      "_key": "D",\n      "_id": "Traits/D",\n      "_rev": "_V5oRUS6--A",\n      "en": "beautiful",\n      "de": "sch\xf6n"\n    },\n  ],\n  ...\n]\n')),(0,a.kt)("p",null,"This is a bit too much information, so let's only return English labels using the ",(0,a.kt)("a",{parentName:"p",href:"/docs/queryworkers/c8ql/array-operators#array-expansion"},"array expansion")," notation:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'FOR c IN Characters\n    RETURN DOCUMENT("Traits", c.traits)[*].en\n')),(0,a.kt)("p",null,"The results list just the English labels for each character:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'[\n  [\n    "strong",\n    "powerful",\n    "loyal",\n    "rational",\n    "brave"\n  ],\n  [\n    "beautiful",\n    "powerful",\n    "loyal"\n  ],\n  ...\n]\n')),(0,a.kt)("h2",{id:"merge-characters-and-traits"},"Merge Characters and Traits"),(0,a.kt)("p",null,"Great, you resolved the letters to meaningful traits! But which character do they belong to? With the ",(0,a.kt)("inlineCode",{parentName:"p"},"MERGE()")," operation, you can combine the character document and the data from trait document:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'FOR c IN Characters\n    RETURN MERGE(c, { traits: DOCUMENT("Traits", c.traits)[*].en } )\n')),(0,a.kt)("p",null,"Results will be similar to the following:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'[\n  {\n    "_id": "Characters/2861650",\n    "_key": "2861650",\n    "_rev": "_V1bzsXa---",\n    "age": 41,\n    "alive": false,\n    "name": "Ned",\n    "surname": "Stark",\n    "traits": [\n      "strong",\n      "powerful",\n      "loyal",\n      "rational",\n      "brave"\n    ]\n  },\n  {\n    "_id": "Characters/2861653",\n    "_key": "2861653",\n    "_rev": "_V1bzsXa--B",\n    "age": 40,\n    "alive": false,\n    "name": "Catelyn",\n    "surname": "Stark",\n    "traits": [\n      "beautiful",\n      "powerful",\n      "loyal"\n    ]\n  },\n  ...\n]\n')),(0,a.kt)("p",null,"Because you used an object ",(0,a.kt)("inlineCode",{parentName:"p"},"{ traits: ... }")," which has the same attribute name ",(0,a.kt)("em",{parentName:"p"},"traits")," as the original character attribute, the latter is overwritten by the merge."),(0,a.kt)("p",null,"For more information, refer to ",(0,a.kt)("a",{parentName:"p",href:"/docs/queryworkers/c8ql/functions/document#merge"},"MERGE()"),"."),(0,a.kt)("h2",{id:"next-steps"},"Next Steps"),(0,a.kt)("p",null,"Great job! You can now combine data from different collections. When you're ready, continue the tutorial in ",(0,a.kt)("a",{parentName:"p",href:"/docs/queryworkers/c8ql/got-tutorial/graph-traversal"},"Part 5 - Graph Traversal"),"."))}p.isMDXComponent=!0},33092:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/Comparison_DataModels-4953c7cf512f4150c38074f3ef0c29f9.png"}}]);