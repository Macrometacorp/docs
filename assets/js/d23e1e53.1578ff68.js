"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[62938],{3905:(e,t,r)=>{r.d(t,{Zo:()=>c,kt:()=>m});var n=r(67294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var l=n.createContext({}),u=function(e){var t=n.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},c=function(e){var t=u(e.components);return n.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=u(r),m=a,f=d["".concat(l,".").concat(m)]||d[m]||p[m]||o;return r?n.createElement(f,i(i({ref:t},c),{},{components:r})):n.createElement(f,i({ref:t},c))}));function m(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=r.length,i=new Array(o);i[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var u=2;u<o;u++)i[u]=r[u];return n.createElement.apply(null,i)}return n.createElement.apply(null,r)}d.displayName="MDXCreateElement"},85162:(e,t,r)=>{r.d(t,{Z:()=>i});var n=r(67294),a=r(34334);const o="tabItem_Ymn6";function i(e){let{children:t,hidden:r,className:i}=e;return n.createElement("div",{role:"tabpanel",className:(0,a.Z)(o,i),hidden:r},t)}},65488:(e,t,r)=>{r.d(t,{Z:()=>m});var n=r(87462),a=r(67294),o=r(34334),i=r(72389),s=r(67392),l=r(7094),u=r(12466);const c="tabList__CuJ",p="tabItem_LNqP";function d(e){const{lazy:t,block:r,defaultValue:i,values:d,groupId:m,className:f}=e,b=a.Children.map(e.children,(e=>{if((0,a.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})),h=d??b.map((e=>{let{props:{value:t,label:r,attributes:n}}=e;return{value:t,label:r,attributes:n}})),y=(0,s.l)(h,((e,t)=>e.value===t.value));if(y.length>0)throw new Error(`Docusaurus error: Duplicate values "${y.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`);const v=null===i?i:i??b.find((e=>e.props.default))?.props.value??b[0].props.value;if(null!==v&&!h.some((e=>e.value===v)))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${v}" but none of its children has the corresponding value. Available values are: ${h.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);const{tabGroupChoices:k,setTabGroupChoices:w}=(0,l.U)(),[N,g]=(0,a.useState)(v),E=[],{blockElementScrollPositionUntilNextRender:O}=(0,u.o5)();if(null!=m){const e=k[m];null!=e&&e!==N&&h.some((t=>t.value===e))&&g(e)}const T=e=>{const t=e.currentTarget,r=E.indexOf(t),n=h[r].value;n!==N&&(O(t),g(n),null!=m&&w(m,String(n)))},j=e=>{let t=null;switch(e.key){case"ArrowRight":{const r=E.indexOf(e.currentTarget)+1;t=E[r]??E[0];break}case"ArrowLeft":{const r=E.indexOf(e.currentTarget)-1;t=E[r]??E[E.length-1];break}}t?.focus()};return a.createElement("div",{className:(0,o.Z)("tabs-container",c)},a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.Z)("tabs",{"tabs--block":r},f)},h.map((e=>{let{value:t,label:r,attributes:i}=e;return a.createElement("li",(0,n.Z)({role:"tab",tabIndex:N===t?0:-1,"aria-selected":N===t,key:t,ref:e=>E.push(e),onKeyDown:j,onFocus:T,onClick:T},i,{className:(0,o.Z)("tabs__item",p,i?.className,{"tabs__item--active":N===t})}),r??t)}))),t?(0,a.cloneElement)(b.filter((e=>e.props.value===N))[0],{className:"margin-top--md"}):a.createElement("div",{className:"margin-top--md"},b.map(((e,t)=>(0,a.cloneElement)(e,{key:t,hidden:e.props.value!==N})))))}function m(e){const t=(0,i.Z)();return a.createElement(d,(0,n.Z)({key:String(t)},e))}},66378:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>p,frontMatter:()=>o,metadata:()=>s,toc:()=>u});var n=r(87462),a=(r(67294),r(3905));r(65488),r(85162);const o={title:"Projection Queries",sidebar_position:80},i=void 0,s={unversionedId:"queryworkers/projection-queries",id:"queryworkers/projection-queries",title:"Projection Queries",description:"You can return a projection of the documents in OLD or NEW instead of returning the entire documents. This can be used to reduce the amount of data returned by queries.",source:"@site/docs/queryworkers/projection-queries.md",sourceDirName:"queryworkers",slug:"/queryworkers/projection-queries",permalink:"/docs/queryworkers/projection-queries",draft:!1,editUrl:"https://github.com/macrometacorp/docs/edit/main/docs/queryworkers/projection-queries.md",tags:[],version:"current",sidebarPosition:80,frontMatter:{title:"Projection Queries",sidebar_position:80},sidebar:"defaultSidebar",previous:{title:"Data Modification Queries",permalink:"/docs/queryworkers/data-modification-queries"},next:{title:"Query Errors",permalink:"/docs/queryworkers/query-errors"}},l={},u=[{value:"Using OLD and NEW in the same query",id:"using-old-and-new-in-the-same-query",level:2},{value:"Calculations with OLD or NEW",id:"calculations-with-old-or-new",level:2}],c={toc:u};function p(e){let{components:t,...r}=e;return(0,a.kt)("wrapper",(0,n.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"You can return a projection of the documents in ",(0,a.kt)("inlineCode",{parentName:"p"},"OLD")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"NEW")," instead of returning the entire documents. This can be used to reduce the amount of data returned by queries."),(0,a.kt)("p",null,"For example, the following query will return only the keys of the inserted documents:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"FOR i IN 1..100\n    INSERT { value: i } IN test \n    RETURN NEW._key\n")),(0,a.kt)("h2",{id:"using-old-and-new-in-the-same-query"},"Using OLD and NEW in the same query"),(0,a.kt)("p",null,"For ",(0,a.kt)("inlineCode",{parentName:"p"},"UPDATE"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"REPLACE")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"UPSERT")," statements, both ",(0,a.kt)("inlineCode",{parentName:"p"},"OLD")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"NEW")," can be used to return the previous revision of a document together with the updated revision:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'FOR u IN users\n    FILTER u.status == "not active"\n    UPDATE u WITH { status: "inactive" } IN users \n    RETURN { old: OLD, new: NEW }\n')),(0,a.kt)("h2",{id:"calculations-with-old-or-new"},"Calculations with OLD or NEW"),(0,a.kt)("p",null,"It is also possible to run additional calculations with ",(0,a.kt)("inlineCode",{parentName:"p"},"LET")," statements between the data-modification part and the final ",(0,a.kt)("inlineCode",{parentName:"p"},"RETURN")," of a C8QL query."),(0,a.kt)("p",null,"For example, the following query performs an upsert operation and returns whether an existing document was updated, or a new document was inserted. It does so by checking the ",(0,a.kt)("inlineCode",{parentName:"p"},"OLD")," variable after the ",(0,a.kt)("inlineCode",{parentName:"p"},"UPSERT")," and using a ",(0,a.kt)("inlineCode",{parentName:"p"},"LET")," statement to store a temporary string for the operation type:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'UPSERT { name: "test" }\n    INSERT { name: "test" }\n    UPDATE { } IN users\nLET opType = IS_NULL(OLD) ? "insert" : "update"\nRETURN { _key: NEW._key, type: opType }\n')))}p.isMDXComponent=!0}}]);