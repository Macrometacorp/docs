"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[58978],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>h});var i=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=i.createContext({}),c=function(e){var t=i.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},u=function(e){var t=c(e.components);return i.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},p=i.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),p=c(n),h=r,m=p["".concat(s,".").concat(h)]||p[h]||d[h]||o;return n?i.createElement(m,a(a({ref:t},u),{},{components:n})):i.createElement(m,a({ref:t},u))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,a=new Array(o);a[0]=p;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,a[1]=l;for(var c=2;c<o;c++)a[c]=n[c];return i.createElement.apply(null,a)}return i.createElement.apply(null,n)}p.displayName="MDXCreateElement"},29671:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>a,default:()=>d,frontMatter:()=>o,metadata:()=>l,toc:()=>c});var i=n(87462),r=(n(67294),n(3905));const o={sidebar_position:160,title:"Troubleshoot Indexes"},a=void 0,l={unversionedId:"collections/indexing/troubleshoot-indexes",id:"collections/indexing/troubleshoot-indexes",title:"Troubleshoot Indexes",description:"When in doubt about whether and which indexes will be used for executing a given C8QL query, click Execution Plan in the web interface in the Queries view.",source:"@site/docs/collections/indexing/troubleshoot-indexes.md",sourceDirName:"collections/indexing",slug:"/collections/indexing/troubleshoot-indexes",permalink:"/docs/collections/indexing/troubleshoot-indexes",draft:!1,editUrl:"https://github.com/macrometacorp/docs/edit/main/docs/collections/indexing/troubleshoot-indexes.md",tags:[],version:"current",sidebarPosition:160,frontMatter:{sidebar_position:160,title:"Troubleshoot Indexes"},sidebar:"defaultSidebar",previous:{title:"Create Index in Background",permalink:"/docs/collections/indexing/create-index-in-background"},next:{title:"Search Views",permalink:"/docs/search/search"}},s={},c=[],u={toc:c};function d(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,i.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"When in doubt about whether and which indexes will be used for executing a given C8QL query, click ",(0,r.kt)("strong",{parentName:"p"},"Execution Plan")," in the web interface in the Queries view."),(0,r.kt)("p",null,"If any of the explain methods shows that a query is not using indexes, the following steps may help:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Check if the attribute names in the query are correctly spelled. In a schema-free database, documents in the same collection can have varying structures. There is no such thing as a ",(0,r.kt)("inlineCode",{parentName:"p"},"non-existing attribute")," error. A query that refers to attribute names not present in any of the documents will not return an error, and obviously will not benefit from indexes.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Check the value of the ",(0,r.kt)("inlineCode",{parentName:"p"},"Indexes Used")," method for the collections used in the query and validate that indexes are actually present on the attributes used in the query filter conditions.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"If indexes are present but not used by the query, the indexes may have the wrong type. For example, a hash index will only be used for equality comparisons (i.e. ",(0,r.kt)("inlineCode",{parentName:"p"},"=="),") but not for other comparison types such as ",(0,r.kt)("inlineCode",{parentName:"p"},"<"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"<="),", ",(0,r.kt)("inlineCode",{parentName:"p"},">"),", ",(0,r.kt)("inlineCode",{parentName:"p"},">="),". Additionally hash indexes will only be used if all of the index attributes are used in the query's FILTER conditions. A skiplist index will only be used if at least its first attribute is used in a FILTER condition. If additionally of the skiplist index attributes are specified in the query (from left-to-right), they may also be used and allow to filter more documents.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Using indexed attributes as function parameters or in arbitrary expressions will likely lead to the index on the attribute not being used. For example, the following queries will not use an index on ",(0,r.kt)("inlineCode",{parentName:"p"},"value"),":"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"      FOR doc IN collection FILTER TO_NUMBER(doc.value) == 42 RETURN doc\n      FOR doc IN collection FILTER doc.value - 1 == 42 RETURN doc\n")),(0,r.kt)("p",null,"  In these cases the queries should be rewritten so that only the index attribute is present on one side of the operator, or additional filters and indexes should be used to restrict the amount of documents otherwise."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Certain C8QL functions such as ",(0,r.kt)("inlineCode",{parentName:"p"},"WITHIN()")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"FULLTEXT()")," do utilize indexes internally, but their use is not mentioned in the query explanation for functions in general. These functions will raise query errors (at runtime) if no suitable index is present for the collection in question.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"The query optimizer will in general pick one index per collection in a query. It can pick more than one index per collection if the FILTER condition contains multiple branches combined with logical ",(0,r.kt)("inlineCode",{parentName:"p"},"OR"),".  For example, the following queries can use indexes:"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"      FOR doc IN collection FILTER doc.value1 == 42 || doc.value1 == 23 RETURN doc\n      FOR doc IN collection FILTER doc.value1 == 42 || doc.value2 == 23 RETURN doc\n      FOR doc IN collection FILTER doc.value1 < 42 || doc.value2 > 23 RETURN doc\n")),(0,r.kt)("p",null,"  The two ",(0,r.kt)("inlineCode",{parentName:"p"},"OR"),"s in the first query will be converted to an ",(0,r.kt)("inlineCode",{parentName:"p"},"IN")," list, and if there is a suitable index on ",(0,r.kt)("inlineCode",{parentName:"p"},"value1"),", it will be used. The second query requires two separate indexes on ",(0,r.kt)("inlineCode",{parentName:"p"},"value1")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"value2")," and will use them if present. The third query can use the indexes on ",(0,r.kt)("inlineCode",{parentName:"p"},"value1")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"value2")," when they are sorted."))}d.isMDXComponent=!0}}]);