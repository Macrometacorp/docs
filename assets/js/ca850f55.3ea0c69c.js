"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[17363],{3905:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>d});var a=t(67294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,o=function(e,n){if(null==e)return{};var t,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var s=a.createContext({}),c=function(e){var n=a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},u=function(e){var n=c(e.components);return a.createElement(s.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef((function(e,n){var t=e.components,o=e.mdxType,i=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),m=c(t),d=o,g=m["".concat(s,".").concat(d)]||m[d]||p[d]||i;return t?a.createElement(g,r(r({ref:n},u),{},{components:t})):a.createElement(g,r({ref:n},u))}));function d(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var i=t.length,r=new Array(i);r[0]=m;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,r[1]=l;for(var c=2;c<i;c++)r[c]=t[c];return a.createElement.apply(null,r)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},85162:(e,n,t)=>{t.d(n,{Z:()=>r});var a=t(67294),o=t(34334);const i="tabItem_Ymn6";function r(e){let{children:n,hidden:t,className:r}=e;return a.createElement("div",{role:"tabpanel",className:(0,o.Z)(i,r),hidden:t},n)}},65488:(e,n,t)=>{t.d(n,{Z:()=>d});var a=t(87462),o=t(67294),i=t(34334),r=t(72389),l=t(67392),s=t(7094),c=t(12466);const u="tabList__CuJ",p="tabItem_LNqP";function m(e){const{lazy:n,block:t,defaultValue:r,values:m,groupId:d,className:g}=e,f=o.Children.map(e.children,(e=>{if((0,o.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})),y=m??f.map((e=>{let{props:{value:n,label:t,attributes:a}}=e;return{value:n,label:t,attributes:a}})),h=(0,l.l)(y,((e,n)=>e.value===n.value));if(h.length>0)throw new Error(`Docusaurus error: Duplicate values "${h.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`);const b=null===r?r:r??f.find((e=>e.props.default))?.props.value??f[0].props.value;if(null!==b&&!y.some((e=>e.value===b)))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${b}" but none of its children has the corresponding value. Available values are: ${y.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);const{tabGroupChoices:_,setTabGroupChoices:w}=(0,s.U)(),[v,k]=(0,o.useState)(b),C=[],{blockElementScrollPositionUntilNextRender:N}=(0,c.o5)();if(null!=d){const e=_[d];null!=e&&e!==v&&y.some((n=>n.value===e))&&k(e)}const T=e=>{const n=e.currentTarget,t=C.indexOf(n),a=y[t].value;a!==v&&(N(n),k(a),null!=d&&w(d,String(a)))},x=e=>{let n=null;switch(e.key){case"ArrowRight":{const t=C.indexOf(e.currentTarget)+1;n=C[t]??C[0];break}case"ArrowLeft":{const t=C.indexOf(e.currentTarget)-1;n=C[t]??C[C.length-1];break}}n?.focus()};return o.createElement("div",{className:(0,i.Z)("tabs-container",u)},o.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.Z)("tabs",{"tabs--block":t},g)},y.map((e=>{let{value:n,label:t,attributes:r}=e;return o.createElement("li",(0,a.Z)({role:"tab",tabIndex:v===n?0:-1,"aria-selected":v===n,key:n,ref:e=>C.push(e),onKeyDown:x,onFocus:T,onClick:T},r,{className:(0,i.Z)("tabs__item",p,r?.className,{"tabs__item--active":v===n})}),t??n)}))),n?(0,o.cloneElement)(f.filter((e=>e.props.value===v))[0],{className:"margin-top--md"}):o.createElement("div",{className:"margin-top--md"},f.map(((e,n)=>(0,o.cloneElement)(e,{key:n,hidden:e.props.value!==v})))))}function d(e){const n=(0,r.Z)();return o.createElement(m,(0,a.Z)({key:String(n)},e))}},16372:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>u,contentTitle:()=>s,default:()=>d,frontMatter:()=>l,metadata:()=>c,toc:()=>p});var a=t(87462),o=(t(67294),t(3905)),i=t(65488),r=t(85162);const l={sidebar_position:6,title:"Spot Collections"},s=void 0,c={unversionedId:"collections/documents/tutorials/using-spotcollections",id:"collections/documents/tutorials/using-spotcollections",title:"Spot Collections",description:"There are some use cases that call for strong consistency across all regions. For example, a financial application might need to show users' account balances. When users make a deposit, they want to see the result of this deposit reflected immediately when they view their balance (otherwise they may fear their money has been lost!). There should never appear to be more or less money in aggregate in the bank than there really is.",source:"@site/docs/collections/documents/tutorials/using-spotcollections.md",sourceDirName:"collections/documents/tutorials",slug:"/collections/documents/tutorials/using-spotcollections",permalink:"/docs/collections/documents/tutorials/using-spotcollections",draft:!1,editUrl:"https://github.com/macrometacorp/docs/edit/main/docs/collections/documents/tutorials/using-spotcollections.md",tags:[],version:"current",sidebarPosition:6,frontMatter:{sidebar_position:6,title:"Spot Collections"},sidebar:"defaultSidebar",previous:{title:"Maps, Sets, SortedSets",permalink:"/docs/collections/documents/tutorials/maps_sets_sortedsets"},next:{title:"Using Rest APIs",permalink:"/docs/collections/documents/tutorials/using_rest_api"}},u={},p=[{value:"Pre-requisite",id:"pre-requisite",level:2},{value:"SDK download",id:"sdk-download",level:2},{value:"Code Sample",id:"code-sample",level:2}],m={toc:p};function d(e){let{components:n,...t}=e;return(0,o.kt)("wrapper",(0,a.Z)({},m,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"There are some use cases that call for strong consistency across all regions. For example, a financial application might need to show users' account balances. When users make a deposit, they want to see the result of this deposit reflected immediately when they view their balance (otherwise they may fear their money has been lost!). There should never appear to be more or less money in aggregate in the bank than there really is. "),(0,o.kt)("p",null,"When performing read operations, here you want to read the latest copy of your data in ",(0,o.kt)("strong",{parentName:"p"},"global")," order. It provides the ability to read the latest change to your data across rows, regions and continents."),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"Spot Collections are only available on Enterprise customer accounts."),(0,o.kt)("p",{parentName:"admonition"},"Contact ",(0,o.kt)("a",{parentName:"p",href:"mailto:support@macrometa.com"},"support@macrometa.com")," if you have any questions.")),(0,o.kt)("h2",{id:"pre-requisite"},"Pre-requisite"),(0,o.kt)("p",null,"Let's assume your"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Tenant name is ",(0,o.kt)("inlineCode",{parentName:"li"},"nemo@nautilus.com")," and"),(0,o.kt)("li",{parentName:"ul"},"User password is ",(0,o.kt)("inlineCode",{parentName:"li"},"xxxxx"),".")),(0,o.kt)("h2",{id:"sdk-download"},"SDK download"),(0,o.kt)(i.Z,{groupId:"operating-systems",mdxType:"Tabs"},(0,o.kt)(r.Z,{value:"py",label:"Python",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-py"},"  pyC8 requires Python 3.5+. Python 3.6 or higher is recommended\n\n  To install pyC8, simply run\n\n      $ pip3 install pyC8\n\n  or, if you prefer to use conda:\n\n      conda install -c conda-forge pyC8\n\n  or pipenv:\n\n      pipenv install --pre pyC8\n\n  Once the installation process is finished, you can begin developing applications in Python.\n"))),(0,o.kt)(r.Z,{value:"js",label:"Javascript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"  With Yarn or NPM\n\n      yarn add jsc8\n      (or)\n      npm install jsc8\n\n  If you want to use the SDK outside of the current directory, you can also install it globally using the `--global` flag:\n\n      npm install --global jsc8\n\n  From source,\n\n      git clone https://github.com/macrometacorp/jsc8.git\n      cd jsC8\n      npm install\n      npm run dist\n")))),(0,o.kt)("h2",{id:"code-sample"},"Code Sample"),(0,o.kt)(i.Z,{groupId:"operating-systems",mdxType:"Tabs"},(0,o.kt)(r.Z,{value:"py",label:"Python",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-py"},'""" This file is a demo for spot collections """\nimport pprint\nfrom c8 import C8Client\n\n# Variables Access\nURL = "api-play.paas.macrometa.io"\nAPI_KEY = "my API key" #Change this to my API key\nAPI_KEY_ID = "my API key ID" #Change this to my API key ID\nGEO_FABRIC = "_system"\n\n# Variables - DB\ncollection_name = "accounts"\nread_query_name = "read_query"\nread_query = {"query": {"name": read_query_name, "value":\n    "FOR account IN accounts RETURN account"}}\naccounts_keys = "FOR k IN accounts RETURN k._key"\nspot_gf_name = "spot"\nregion_urls = [\n    "ap-northeast.paas.macrometa.io",\n    "eu-central.paas.macrometa.io",\n    "eu-west.paas.macrometa.io"\n]\n\n# Variables - Data\ndata = [\n    {"_key": "1", "firstname": "Peter", "lastname": "Parker", "City": "NewYork"},\n    {"_key": "2", "firstname": "Bruce", "lastname": "Wayne", "City": "Gotham"},\n    {"_key": "3", "firstname": "Clark", "lastname": "Kent", "City": "Manhatten"},\n    {"_key": "4", "firstname": "Ned", "lastname": "Stark", "City": "Winterfell"},\n    {"_key": "5", "firstname": "Tywin", "lastname": "Lannister", "City": "Kings Landing"}\n]\npp = pprint.PrettyPrinter(indent=4)\n\n\n# Step 1: Open connection to GDN. You will be routed to closest region.\nprint(f"1. CONNECT: federation: {URL},  user: {API_KEY}")\nclient = C8Client(protocol=\'https\', host=URL, port=443, apikey = API_KEY, geofabric=GEO_FABRIC)\n\n#print("The connection was successful:", client.get_collections())\n\n# Step 1.5: Assign a spot region.\nspot_region = client.tenant(apikey = API_KEY)\ndcl = spot_region.dclist(detail=False)\nfabric = spot_region.useFabric(GEO_FABRIC)\n\nif fabric.has_fabric(spot_gf_name):\n    print("Fabric", spot_gf_name, "already exists.")\nelse:\n    fabric.create_fabric(spot_gf_name, dclist=dcl,spot_creation_type=\n        fabric.SPOT_CREATION_TYPES.SPOT_REGION, spot_dc=\'eu-west.paas.macrometa.io\')\n    print("Fabric", spot_gf_name, "has been created successfully.")\n\nclient.set_database_access_level(API_KEY_ID, spot_gf_name, "rw")\n\n#print(fabric.properties())\nclient = spot_region.useFabric(spot_gf_name)\n#print(client.properties())\n\nspot_region_status = client.properties().get("options", {}).get("spotDc")\nif spot_region_status == "":\n    print("The fabric does not have a spot region registered.")\n    print("Please remove the fabric and create a new fabric with a spot region.")\n    print("Stopping program.")\n    exit()\nelse:\n    print("Spot region for the fabric", spot_gf_name, "is: ", spot_region_status)\n    print("Continuing...")\n\n\n# Step 2: Create or assign a spot collection.\n# getCollectionDetails\ndef isSpotCollection():\n    """ This function checks if the given collection already exists and if true,\n        returns the property \'isSpot\' """\n    for coll in client.collections():\n        if coll["name"] == collection_name:\n            return coll["isSpot"]\n\nprint(f"2. CREATE_COLLECTION: region: {URL},  collection: {collection_name}")\nif client.has_collection(collection_name):\n    if isSpotCollection():\n        print(collection_name, "is a spot collection.")\n        print("Continuing...")\n        collection = client.collection(collection_name)\n    else:\n        print(collection_name, "is not a spot collection")\n        print("Remove the collection and create a new one as a spot collection.")\n        print("Stopping program.")\n        exit()\nelse:\n    collection = client.create_collection(collection_name, spot_collection=True)\n    print(collection_name, "has been created successfully")\n\n\n# Step 3: Insert data into collection.\n#get_keys = client.execute_restql("accounts_keys")\nprint(f"3. INSERT_DATA: region: {URL}, collection: {collection_name}")\n#collection.insert_many(data)\nprint("Data has been inserted successfully inserted (duplicating data was avoided).")\n\n\n\n# Step 4: Create a new query worker or look for the existing one, then read data from the collection.\nprint(f"4. READ_DATA: region: {URL}, collection: {collection_name}")\nall_saved_queries = client.get_all_restql()\n\nquery_exists = False\nfor i in all_saved_queries:\n    if i["name"] == read_query_name:\n        query_exists = True\n        break\n\nif not query_exists:\n    client.save_restql(read_query)\n    print("The NEW query has been saved.")\nelse:\n    print("Query already exists.")\n\n\nprint(client.execute_restql(read_query_name))\n#print(client.execute_query("FOR account IN accounts RETURN account"))\n\n\n# Step 5: Read data from other regions.\nfor region_url in region_urls:\n    print(f"\\n5. DATA_MOBILITY: Reading from region: {region_url}")\n    #clientx = C8Client(protocol=\'https\', host=region_url, port=443, geofabric=\n        #spot_gf_name, apikey= API_KEY)\n    print(client.execute_restql(read_query_name))\n\n\n# Step 6: Delete data.\nprint(f"6. DELETE_DATA: fabric: {spot_gf_name}, collection: {collection_name}")\ntry:\n    collection.truncate()\n    client.delete_collection(collection_name)\n    client = spot_region.useFabric(GEO_FABRIC)\n    client.delete_fabric(spot_gf_name)\n    print("Spot collection and fabric have been deleted successfully.")\nexcept Exception as e:\n    print("There was an error while deleting the spot collection or fabric.")\n    print("Details:", e)\n'))),(0,o.kt)(r.Z,{value:"js",label:"Javascript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'const jsc8 = require("jsc8");\n\n// Variables - DB\nconst globalUrl = "https://play.paas.macrometa.io";\nconst geofabric = "_system";\nconst spotGfName = "spot";\nconst regionUrls = [\n  "gdn-us-west",\n  "gdn-ap-west",\n  "gdn-eu-central"\n];\n\n// Variables\nconst collectionName = "accounts";\nconst readQueryValue = "FOR account IN accounts RETURN account";\n\n// Variables - Data\nconst data = [\n  { firstname: "Peter", lastname: "Parker", City: "NewYork" },\n  { firstname: "Bruce", lastname: "Wayne", City: "Gotham" },\n  { firstname: "Clark", lastname: "Kent", City: "Manhatten" },\n  { firstname: "Ned", lastname: "Stark", City: "Winterfell" },\n  { firstname: "Tywin", lastname: "Lannister", City: "Kings Landing" }\n];\n\nconst sleep = (milliseconds) => {\n  return new Promise(resolve => setTimeout(resolve, milliseconds));\n};\n\nasync function main () {\n  // Create an authenticated instance with a token or API key\n  // const client = new jsc8({url: globalUrl, token: "XXXX", fabricName: \'_system\'});\n  // const client = new jsc8({url: globalUrl, apiKey: "XXXX", fabricName: \'_system\'});\n\n  // Or use email and password to authenticate a client instance\n  const client = new jsc8(globalUrl);\n  console.log(`1. Connecting to federation: ${globalUrl}`);\n  await client.login("nemo@nautilus.com", "xxxxxx");\n  console.log("The connection was successful");\n\n  // Step 1.5: Assign a spot region.\n  async function createSpotRegion () {\n    const dcl = "devsuccess2-us-east";\n    let fabric = await client.useFabric(spotGfName);\n\n    if (await fabric.exists()) {\n      console.log("Fabric", spotGfName, "already exists.");\n    } else {\n      fabric = await client.useFabric(geofabric);\n      try {\n        await fabric.createFabric(spotGfName, ["root"], {\n          dcList: regionUrls,\n          spotDc: dcl\n        });\n      }\n      catch (e) {\n        console.log("fabric creation failed: ", e.response.body);\n      }\n      console.log("Fabric", spotGfName, "has been created successfully.");\n      fabric = await client.useFabric(spotGfName);\n    }\n  }\n\n  async function createCollection () {\n    console.log("\\n 2. Create collection: ");\n\n    try {\n      console.log(`Creating the collection ${collectionName}...`);\n      const existsColl = await client.hasCollection(collectionName);\n      if (!existsColl) {\n        await client.createCollection(collectionName, { isSpot: true });\n        console.log("Collection created successfully");\n      } else {\n        console.log("Collection already exists");\n      }\n    } catch (e) {\n      await console.log("Collection creation did not succeed due to " + e);\n    }\n  }\n\n  async function insertData () {\n    console.log(`\\n 3. Inserting data`);\n    await client.insertDocumentMany(collectionName, data);\n  }\n\n  async function readData () {\n    console.log(`\\n 4. Reading data`);\n    const result = await client.executeQuery(readQueryValue);\n    console.log(result);\n  }\n\n  async function readDataFromAllRegions () {\n    try {\n      console.log(`\\n 5. Reading data from regions:`);\n\n      for (let i = 0; i < regionUrls.length; i++) {\n        // Crete a authenticated instance with Token / Apikey\n        // const regionclient = new jsc8({url: regionUrls[i], token: "XXXX", fabricName: \'_system\'});\n        // const regionclient = new jsc8({url: regionUrls[i], apiKey: "XXXX", fabricName: \'_system\'});\n        // await console.log("Authentication done!!...");\n\n        // Or use email and password to authenticate a client instance\n        console.log(regionUrls[i]);\n        const regionclient = new jsc8(`https://${regionUrls[i]}.paas.macrometa.io`);\n        await regionclient.login("nemo@nautilus.com", "xxxxxx");\n\n        console.log(`\\n Reading from region : ${regionUrls[i]}`);\n        const result = await client.executeQuery(readQueryValue);\n        console.log(result);\n      }\n    } catch (e) {\n      await console.log("Error caught while reading data from all regions: " + e);\n    }\n  }\n\n  async function deleteData () {\n    console.log("\\n 6. Delete data");\n    await client.deleteCollection(collectionName);\n  }\n\n  async function run () {\n    await createSpotRegion();\n    // Need to wait some time to get the spot region ready\n    await sleep(10000);\n    await createCollection();\n    await insertData();\n    await readData();\n    await readDataFromAllRegions();\n    await deleteData();\n  }\n\n  run();\n}\n\nmain();\n')))))}d.isMDXComponent=!0}}]);