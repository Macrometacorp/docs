"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[42548],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>m});var r=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),p=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=p(e.components);return r.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=p(n),m=a,N=d["".concat(l,".").concat(m)]||d[m]||u[m]||o;return n?r.createElement(N,i(i({ref:t},c),{},{components:n})):r.createElement(N,i({ref:t},c))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var p=2;p<o;p++)i[p]=n[p];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},99296:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>s,toc:()=>p});var r=n(87462),a=(n(67294),n(3905));const o={sidebar_position:13,title:"INSERT"},i=void 0,s={unversionedId:"queryworkers/c8ql/operations/insert",id:"queryworkers/c8ql/operations/insert",title:"INSERT",description:"The INSERT keyword can be used to insert new documents into a collection. On a single server, an insert operation is executed transactionally in an all-or-nothing fashion.",source:"@site/docs/queryworkers/c8ql/operations/insert.md",sourceDirName:"queryworkers/c8ql/operations",slug:"/queryworkers/c8ql/operations/insert",permalink:"/docs/queryworkers/c8ql/operations/insert",draft:!1,editUrl:"https://github.com/macrometacorp/docs/edit/main/docs/queryworkers/c8ql/operations/insert.md",tags:[],version:"current",sidebarPosition:13,frontMatter:{sidebar_position:13,title:"INSERT"},sidebar:"defaultSidebar",previous:{title:"REPLACE",permalink:"/docs/queryworkers/c8ql/operations/replace"},next:{title:"UPSERT",permalink:"/docs/queryworkers/c8ql/operations/upsert"}},l={},p=[{value:"Setting query options",id:"setting-query-options",level:2},{value:"Returning the inserted documents",id:"returning-the-inserted-documents",level:2}],c={toc:p};function u(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,r.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"INSERT")," keyword can be used to insert new documents into a collection. On a single server, an insert operation is executed transactionally in an all-or-nothing fashion. "),(0,a.kt)("p",null,"For sharded collections, the entire query and/or insert operation may not be transactional, especially if it involves different shards and/or DB-Servers."),(0,a.kt)("p",null,"Each ",(0,a.kt)("inlineCode",{parentName:"p"},"INSERT")," operation is restricted to a single collection, and the ",(0,a.kt)("a",{parentName:"p",href:"/docs/queryworkers/c8ql/operations/insert"},"collection name")," must not be dynamic. Only a single ",(0,a.kt)("inlineCode",{parentName:"p"},"INSERT")," statement per collection is allowed per C8QL query, and it cannot be followed by read or write operations that access the same collection, by traversal operations, or C8QL functions that can read documents."),(0,a.kt)("p",null,"The syntax for an insert operation is:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"INSERT document INTO collection [ OPTIONS options ]\n")),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},"The ",(0,a.kt)("inlineCode",{parentName:"p"},"IN")," keyword is allowed in place of ",(0,a.kt)("inlineCode",{parentName:"p"},"INTO")," and has the same meaning.")),(0,a.kt)("p",null,(0,a.kt)("em",{parentName:"p"},"collection")," must contain the name of the collection into which the documents should be inserted. ",(0,a.kt)("em",{parentName:"p"},"document")," is the document to be inserted, and it may or may not contain a ",(0,a.kt)("em",{parentName:"p"},"_key")," attribute. If no ",(0,a.kt)("em",{parentName:"p"},"_key")," attribute is provided, GDN will auto-generate a value for ",(0,a.kt)("em",{parentName:"p"},"_key")," value. Inserting a document will also auto-generate a document revision number for the document."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"FOR i IN 1..100\n  INSERT { value: i } INTO numbers\n")),(0,a.kt)("p",null,"An insert operation can also be performed without a ",(0,a.kt)("inlineCode",{parentName:"p"},"FOR")," loop to insert a single document:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"INSERT { value: 1 } INTO numbers\n")),(0,a.kt)("p",null,"When inserting into an ",(0,a.kt)("a",{parentName:"p",href:"/docs/queryworkers/c8ql/operations/insert"},"edge collection"),", it is mandatory to specify the attributes ",(0,a.kt)("em",{parentName:"p"},"_from")," and ",(0,a.kt)("em",{parentName:"p"},"_to")," in document:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"FOR u IN users\n  FOR p IN products\n    FILTER u._key == p.recommendedBy\n    INSERT { _from: u._id, _to: p._id } INTO recommendations\n")),(0,a.kt)("h2",{id:"setting-query-options"},"Setting query options"),(0,a.kt)("p",null,"The ",(0,a.kt)("em",{parentName:"p"},"OPTIONS")," keyword followed by an object with query options can optionally be provided in an ",(0,a.kt)("inlineCode",{parentName:"p"},"INSERT")," operation."),(0,a.kt)("p",null,"It can be used to suppress query errors that may occur when violating unique key constraints:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"FOR i IN 1..1000\n  INSERT {\n    _key: CONCAT('test', i),\n    name: \"test\",\n    foobar: true\n  } INTO users OPTIONS { ignoreErrors: true }\n")),(0,a.kt)("p",null,"To make sure data are durable when an insert query returns, there is the ",(0,a.kt)("em",{parentName:"p"},"waitForSync")," query option:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"FOR i IN 1..1000\n  INSERT {\n    _key: CONCAT('test', i),\n    name: \"test\",\n    foobar: true\n  } INTO users OPTIONS { waitForSync: true }\n")),(0,a.kt)("p",null,"If you want to replace existing documents with documents having the same key there is the ",(0,a.kt)("em",{parentName:"p"},"overwrite"),' query option. This will let you safely replace the documents instead of raising an "unique constraint violated error":'),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"FOR i IN 1..1000\n  INSERT {\n    _key: CONCAT('test', i),\n    name: \"test\",\n    foobar: true\n  } INTO users OPTIONS { overwrite: true }\n")),(0,a.kt)("p",null,"Different write operations on the same collection do not block each other, as long as there are no ",(0,a.kt)("em",{parentName:"p"},"write-write conficts")," on the same documents. From an application development perspective it can be desired to have exclusive write access on collections, to simplify the development. "),(0,a.kt)("p",null,"Use the ",(0,a.kt)("em",{parentName:"p"},"exclusive")," option to achieve this effect on a per query basis:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"FOR doc IN collection\n  INSERT { myval: doc.val + 1 } INTO users \n  OPTIONS { exclusive: true }\n")),(0,a.kt)("h2",{id:"returning-the-inserted-documents"},"Returning the inserted documents"),(0,a.kt)("p",null,"The inserted documents can also be returned by the query. In this case, the ",(0,a.kt)("inlineCode",{parentName:"p"},"INSERT")," statement can be a ",(0,a.kt)("inlineCode",{parentName:"p"},"RETURN")," statement (intermediate ",(0,a.kt)("inlineCode",{parentName:"p"},"LET")," statements are allowed, too). To refer to the inserted documents, the ",(0,a.kt)("inlineCode",{parentName:"p"},"INSERT")," statement introduces a pseudo-value named ",(0,a.kt)("inlineCode",{parentName:"p"},"NEW"),". "),(0,a.kt)("p",null,"The documents contained in ",(0,a.kt)("inlineCode",{parentName:"p"},"NEW")," will contain all attributes, even those auto-generated by the database (e.g. ",(0,a.kt)("inlineCode",{parentName:"p"},"_id"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"_key"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"_rev"),")."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"INSERT document INTO collection RETURN NEW\n")),(0,a.kt)("p",null,"Following is an example using a variable named ",(0,a.kt)("inlineCode",{parentName:"p"},"inserted")," to return the inserted documents. For each inserted document, the document key is returned:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"FOR i IN 1..100\n  INSERT { value: i }\n  INTO users\n  LET inserted = NEW\n  RETURN inserted._key\n")))}u.isMDXComponent=!0}}]);