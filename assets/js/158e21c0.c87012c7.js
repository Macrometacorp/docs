"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[72695],{3905:(e,t,n)=>{n.d(t,{Zo:()=>m,kt:()=>c});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},m=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,m=l(e,["components","mdxType","originalType","parentName"]),u=p(n),c=r,b=u["".concat(s,".").concat(c)]||u[c]||d[c]||o;return n?a.createElement(b,i(i({ref:t},m),{},{components:n})):a.createElement(b,i({ref:t},m))}));function c(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var p=2;p<o;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},27697:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>l,toc:()=>p});var a=n(87462),r=(n(67294),n(3905));const o={sidebar_position:100,title:"Store"},i=void 0,l={unversionedId:"cep/query-guide/store",id:"cep/query-guide/store",title:"Store",description:"Stream store queries are a set of on-demand queries that can be used to perform operations on Stream tables, windows, and aggregators.",source:"@site/docs/cep/query-guide/store.md",sourceDirName:"cep/query-guide",slug:"/cep/query-guide/store",permalink:"/docs/cep/query-guide/store",draft:!1,editUrl:"https://github.com/macrometacorp/docs/edit/main/docs/cep/query-guide/store.md",tags:[],version:"current",sidebarPosition:100,frontMatter:{sidebar_position:100,title:"Store"},sidebar:"defaultSidebar",previous:{title:"Script Functions",permalink:"/docs/cep/query-guide/script"},next:{title:"Error Handling",permalink:"/docs/cep/query-guide/error-handling"}},s={},p=[{value:"<em>(Table/Window)</em> Select",id:"tablewindow-select",level:3},{value:"<em>(Aggregation)</em> Select",id:"aggregation-select",level:3},{value:"Insert",id:"insert",level:3},{value:"Delete",id:"delete",level:3},{value:"Update",id:"update",level:3},{value:"Update or Insert",id:"update-or-insert",level:3},{value:"Event Playback",id:"event-playback",level:3}],m={toc:p};function d(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Stream store queries are a set of on-demand queries that can be used to perform operations on Stream tables, windows, and aggregators."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Purpose")),(0,r.kt)("p",null,"Store queries allow you to execute the following operations on stream tables, windows, and aggregators without the intervention of streams."),(0,r.kt)("p",null,"Queries supported for tables:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"INSERT"),(0,r.kt)("li",{parentName:"ul"},"SELECT"),(0,r.kt)("li",{parentName:"ul"},"DELETE"),(0,r.kt)("li",{parentName:"ul"},"UPDATE"),(0,r.kt)("li",{parentName:"ul"},"UPDATE OR INSERT")),(0,r.kt)("p",null,"Queries supported for windows and aggregators:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"SELECT")),(0,r.kt)("p",null,"This is be done by submitting the store query to the stream worker runtime using its ",(0,r.kt)("inlineCode",{parentName:"p"},"query()")," method."),(0,r.kt)("p",null,"In order to execute store queries, the stream worker of the stream worker runtime you are using, should have a store defined, which contains the table that needs to be queried."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Example")),(0,r.kt)("p",null,"If you need to query the table named ",(0,r.kt)("inlineCode",{parentName:"p"},"RoomTypeTable")," the it should have been defined in the stream worker."),(0,r.kt)("p",null,"In order to execute a store query on ",(0,r.kt)("inlineCode",{parentName:"p"},"RoomTypeTable"),", you need to submit the store query using ",(0,r.kt)("inlineCode",{parentName:"p"},"query()")," method."),(0,r.kt)("h3",{id:"tablewindow-select"},(0,r.kt)("em",{parentName:"h3"},"(Table/Window)")," Select"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"SELECT")," store query retrieves records from the specified table or window, based on the given condition."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Syntax")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"select <attribute name>, <attribute name>, ...\nfrom <table/window>\n<on condition>?\n<group by>?\n<having>?\n<order by>?\n<limit>?\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Example")),(0,r.kt)("p",null,"This query retrieves room numbers and types of the rooms starting from room no 10."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"select roomNo, type\nfrom roomTypeTable\non roomNo >= 10;\n")),(0,r.kt)("h3",{id:"aggregation-select"},(0,r.kt)("em",{parentName:"h3"},"(Aggregation)")," Select"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"SELECT")," store query retrieves records from the specified aggregation, based on the given condition, time range,\nand granularity."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Syntax")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"select <attribute name>, <attribute name>, ...\nfrom <aggregation>\n<on condition>?\nwithin <time range>\nper <time granularity>\n<group by>?\n<having>?\n<order by>?\n<limit>?\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Example")),(0,r.kt)("p",null,"Following aggregation definition will be used for the examples."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"CREATE STREAM TradeStream (symbol string, price double, volume long, timestamp long);\n\nCREATE AGGREGATION TradeAggregation\nselect symbol, avg(price) as avgPrice, sum(price) as total\nfrom TradeStream\n  group by symbol\n  aggregate by timestamp every sec ... year;\n")),(0,r.kt)("p",null,"This query retrieves daily aggregations within the time range ",(0,r.kt)("inlineCode",{parentName:"p"},'"2014-02-15 00:00:00 +05:30", "2014-03-16 00:00:00 +05:30"')," (Please note that +05:30 can be omitted if timezone is GMT)"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'select symbol, total, avgPrice \nfrom TradeAggregation\n  within "2014-02-15 00:00:00 +05:30", "2014-03-16 00:00:00 +05:30"\n  per "days";\n')),(0,r.kt)("p",null,'This query retrieves hourly aggregations of "FB" symbol within the day ',(0,r.kt)("inlineCode",{parentName:"p"},"2014-02-15"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'select symbol, total, avgPrice\nfrom TradeAggregation\n  on symbol == "FB"\n  within "2014-02-15 **:**:** +05:30"\n  per "hours";\n')),(0,r.kt)("h3",{id:"insert"},"Insert"),(0,r.kt)("p",null,"This allows you to insert a new record to the table with the attribute values you define in the ",(0,r.kt)("inlineCode",{parentName:"p"},"select")," section."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Syntax")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"insert into <table>\nselect <attribute name>, <attribute name>, ...;\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Example")),(0,r.kt)("p",null,"This store query inserts a new record to the table ",(0,r.kt)("inlineCode",{parentName:"p"},"RoomOccupancyTable"),", with the specified attribute values."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"insert into RoomOccupancyTable\nselect 10 as roomNo, 2 as people\n")),(0,r.kt)("h3",{id:"delete"},"Delete"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"DELETE")," store query deletes selected records from a specified table."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Syntax")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"<select>?  \ndelete <table>  \non <conditional expresssion>\n")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"condition")," element specifies the basis on which records are selected to be deleted."),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"Table attributes must always be referred to with the table name as shown below:\n",(0,r.kt)("inlineCode",{parentName:"p"},"<table name>.<attibute name>"),".")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Example")),(0,r.kt)("p",null,"In this example, query deletes a record in the table named ",(0,r.kt)("inlineCode",{parentName:"p"},"RoomTypeTable")," if it has value for the ",(0,r.kt)("inlineCode",{parentName:"p"},"roomNo")," attribute that matches the value for the ",(0,r.kt)("inlineCode",{parentName:"p"},"roomNumber")," attribute of the selection which has 10 as the actual value."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"select 10 as roomNumber\ndelete RoomTypeTable\non RoomTypeTable.roomNo == roomNumber;\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"delete RoomTypeTable\non RoomTypeTable.roomNo == 10;\n")),(0,r.kt)("h3",{id:"update"},"Update"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"UPDATE")," store query updates selected attributes stored in a specific table, based on a given condition."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Syntax")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"update <table>\n    set <table>.<attribute name> = (<attribute name>|<expression>)?, <table>.<attribute name> = (<attribute name>|<expression>)?, ...\n    on <condition>\nselect <attribute name>, <attribute name>, ...?\n")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"condition")," element specifies the basis on which records are selected to be updated. When specifying the ",(0,r.kt)("inlineCode",{parentName:"p"},"condition"),", table attributes must be referred to with the table name."),(0,r.kt)("p",null,"You can use the ",(0,r.kt)("inlineCode",{parentName:"p"},"set")," keyword to update selected attributes from the table. Here, for each assignment, the attribute specified in the left must be the table attribute, and the one specified in the right can be a stream/table attribute a mathematical operation, or other. When the ",(0,r.kt)("inlineCode",{parentName:"p"},"set")," clause is not provided, all the attributes in the table are updated."),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"Table attributes must always be referred to with the table name as shown below:\n",(0,r.kt)("inlineCode",{parentName:"p"},"<table name>.<attibute name>"),".")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Example")),(0,r.kt)("p",null,"The following query updates the room occupancy by declaring the value of ",(0,r.kt)("inlineCode",{parentName:"p"},"people"),", in the ",(0,r.kt)("inlineCode",{parentName:"p"},"RoomTypeTable")," table for each room number equal to 10."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"update RoomTypeTable\n   set RoomTypeTable.people = people\n    on RoomTypeTable.roomNo == roomNumber\nselect 10 as roomNumber, arrival - exit as people\n  from UpdateStream;\n")),(0,r.kt)("h3",{id:"update-or-insert"},"Update or Insert"),(0,r.kt)("p",null,"This allows you to update selected attributes if a record that meets the given conditions already exists in the specified  table.\nIf a matching record does not exist, the entry is inserted as a new record."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Syntax")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"update or insert into <table>\n    set <table>.<attribute name> = <expression>, <table>.<attribute name> = <expression>, ...\n    on <condition>\nselect <attribute name>, <attribute name>, ...\n")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"condition")," element specifies the basis on which records are selected for update. When specifying the ",(0,r.kt)("inlineCode",{parentName:"p"},"condition"),", table attributes should be referred to with the table name. If a record that matches the condition does not already exist in the table, the arriving event is inserted into the table."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"set")," clause is only used when an update is performed during the insert/update operation. When ",(0,r.kt)("inlineCode",{parentName:"p"},"set")," clause is used, the attribute to the left is always a table attribute, and the attribute to the right can be a stream/table attribute, mathematical operation or other. The attribute to the left (i.e., the attribute in the event table) is updated with the value of the attribute to the right if the given condition is met. When the ",(0,r.kt)("inlineCode",{parentName:"p"},"set")," clause is not provided, all the attributes in the table are updated."),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"Table attributes must always be referred to with the table name as shown below:\n",(0,r.kt)("inlineCode",{parentName:"p"},"<table name>.<attibute name>"),".")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Example")),(0,r.kt)("p",null,"The following query tries to update the records in the ",(0,r.kt)("inlineCode",{parentName:"p"},"RoomAssigneeTable")," table that have room numbers that match the same in the selection. If such records are not found, it inserts a new record based on the values provided in the selection."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'update or insert into RoomAssigneeTable\n    set RoomAssigneeTable.assignee = assignee\n    on RoomAssigneeTable.roomNo == roomNo\nselect 10 as roomNo, "single" as type, "abc" as assignee\nfrom RoomAssigneeStream;\n')),(0,r.kt)("h3",{id:"event-playback"},"Event Playback"),(0,r.kt)("p",null,"When ",(0,r.kt)("inlineCode",{parentName:"p"},"@app:playback")," annotation is added to the app, the timestamp of the event (specified via an attribute) is treated as the current time. This results in events being processed faster."),(0,r.kt)("p",null,"The following elements are configured with this annotation."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Annotation"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"idle.time")),(0,r.kt)("td",{parentName:"tr",align:null},"If no events are received during a time interval specified (in milliseconds) via this element, the Stream system time is incremented by a number of seconds specified via the ",(0,r.kt)("inlineCode",{parentName:"td"},"increment")," element.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"increment")),(0,r.kt)("td",{parentName:"tr",align:null},"The number of seconds by which the Stream system time must be incremented if no events are received during the time interval specified via the ",(0,r.kt)("inlineCode",{parentName:"td"},"idle.time")," element.")))),(0,r.kt)("p",null,"e.g., In the following example, the Stream system time is incremented by two seconds if no events arrive for a time interval of 100 milliseconds."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"@app:playback(idle.time = '100 millisecond', increment = '2 sec') \n")))}d.isMDXComponent=!0}}]);