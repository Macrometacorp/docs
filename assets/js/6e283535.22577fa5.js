"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[67040],{3905:(e,t,a)=>{a.d(t,{Zo:()=>m,kt:()=>u});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=n.createContext({}),d=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},m=function(e){var t=d(e.components);return n.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,m=s(e,["components","mdxType","originalType","parentName"]),c=d(a),u=r,g=c["".concat(l,".").concat(u)]||c[u]||p[u]||i;return a?n.createElement(g,o(o({ref:t},m),{},{components:a})):n.createElement(g,o({ref:t},m))}));function u(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,o=new Array(i);o[0]=c;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,o[1]=s;for(var d=2;d<i;d++)o[d]=a[d];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}c.displayName="MDXCreateElement"},16683:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>p,frontMatter:()=>i,metadata:()=>s,toc:()=>d});var n=a(87462),r=(a(67294),a(3905));const i={sidebar_position:10,title:"Stream Worker Query Guide"},o=void 0,s={unversionedId:"cep/query-guide/index",id:"cep/query-guide/index",title:"Stream Worker Query Guide",description:"Macrometa Stream QL is designed to process streams of events. It can be used to implement streaming data integration, streaming analytics, rule based and adaptive decision making use cases. It is an evolution of Complex Event Processing (CEP) and Stream Processing systems, hence it can also be used to process stateful computations, detecting of complex event patterns, and sending notifications in real-time.",source:"@site/docs/cep/query-guide/index.md",sourceDirName:"cep/query-guide",slug:"/cep/query-guide/",permalink:"/docs/cep/query-guide/",draft:!1,editUrl:"https://github.com/macrometacorp/docs/edit/main/docs/cep/query-guide/index.md",tags:[],version:"current",sidebarPosition:10,frontMatter:{sidebar_position:10,title:"Stream Worker Query Guide"},sidebar:"defaultSidebar",previous:{title:"Stream Workers",permalink:"/docs/cep/"},next:{title:"Functions",permalink:"/docs/cep/query-guide/functions/"}},l={},d=[{value:"Stream Worker Syntax",id:"stream-worker-syntax",level:2},{value:"High-Level Syntax",id:"high-level-syntax",level:3},{value:"Syntax Example",id:"syntax-example",level:3},{value:"Stream Worker Flow Diagram",id:"stream-worker-flow-diagram",level:2},{value:"Elements of a Stream Worker",id:"elements-of-a-stream-worker",level:2}],m={toc:d};function p(e){let{components:t,...i}=e;return(0,r.kt)("wrapper",(0,n.Z)({},m,i,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Macrometa Stream QL is designed to process streams of events. It can be used to implement streaming data integration, streaming analytics, rule based and adaptive decision making use cases. It is an evolution of Complex Event Processing (CEP) and Stream Processing systems, hence it can also be used to process stateful computations, detecting of complex event patterns, and sending notifications in real-time."),(0,r.kt)("p",null,"Stream QL uses SQL-like syntax, and annotations to consume events from diverse event sources with various data formats, process them using stateful and stateless operators, and send outputs to multiple endpoints according to their accepted event formats. It also supports exposing rule based and adaptive decision making as service endpoints so that external programs and systems can synchronously get decision support from streams.  "),(0,r.kt)("p",null,"The following sections explains how to write processing logic using Stream QL."),(0,r.kt)("h2",{id:"stream-worker-syntax"},"Stream Worker Syntax"),(0,r.kt)("p",null,"StreamApp is a collection of Stream QL elements composed together as a script. Here each stream query element must be separated by a semicolon ",(0,r.kt)("inlineCode",{parentName:"p"},";"),"."),(0,r.kt)("h3",{id:"high-level-syntax"},"High-Level Syntax"),(0,r.kt)("p",null,"High level syntax of StreamApp is as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"<stream worker>  :\n        <worker annotation> *\n        ( <stream definition> | <table definition> | ... ) +\n        ( <query> | <partition> ) +\n        ;\n")),(0,r.kt)("h3",{id:"syntax-example"},"Syntax Example"),(0,r.kt)("p",null,"For example, this stream application with the name ",(0,r.kt)("inlineCode",{parentName:"p"},"Temperature-Analytics")," creates a stream named ",(0,r.kt)("inlineCode",{parentName:"p"},"TempStream")," and a query named ",(0,r.kt)("inlineCode",{parentName:"p"},"5minAvgQuery"),"."),(0,r.kt)("p",null,"Stream workers are named by adding ",(0,r.kt)("inlineCode",{parentName:"p"},"@app:name('<name>')")," annotation on the top of the stream worker spec. When the annotation is not added, Macrometa assigns a random UUID as the name of the stream worker."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'@App:name("Temperature-Analytics")\n@App:description("This stream worker creates a stream and query.")\n@App:qlVersion("2")\n\nCREATE STREAM TempStream (deviceID long, roomNo int, temp double);\nCREATE SINK STREAM OutputStream (roomNo int, avgTemp double);\n\n@name(\'5minAvgQuery\')\ninsert into OutputStream\nselect roomNo, avg(temp) as avgTemp\nfrom TempStream window sliding_time(5 min)\ngroup by roomNo;\n')),(0,r.kt)("h2",{id:"stream-worker-flow-diagram"},"Stream Worker Flow Diagram"),(0,r.kt)("p",null,"The following diagram depicts some of the key Stream QL elements of Stream Application and how events flow through the elements."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Event Flow",src:a(40629).Z,title:"Event Flow",width:"1200",height:"655"})),(0,r.kt)("h2",{id:"elements-of-a-stream-worker"},"Elements of a Stream Worker"),(0,r.kt)("p",null,"The table below provides a brief description of a the potential parts of a stream worker."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Elements"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Event"),(0,r.kt)("td",{parentName:"tr",align:null},"An event is a single event object associated with a stream. All events of a stream contains a timestamp and an identical set of typed attributes based on the schema of the stream they belong to.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Inner Stream"),(0,r.kt)("td",{parentName:"tr",align:null},"A positionable stream that connects portioned queries with each other within the partition.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"/docs/cep/query-guide/named-aggregation"},"Named Aggregation")),(0,r.kt)("td",{parentName:"tr",align:null},"A structured representation of data that's incrementally aggregated and stored with a defined schema and aggregation granularity such as seconds, minutes, hours, etc. Aggregation data is stored in ",(0,r.kt)("inlineCode",{parentName:"td"},"database"),". Other stream processor elements can only query the values in windows at runtime but they cannot modify them.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"/docs/cep/query-guide/named-window"},"Named Window")),(0,r.kt)("td",{parentName:"tr",align:null},"A structured representation of data stored with a defined schema and eviction policy. Window data is stored ",(0,r.kt)("inlineCode",{parentName:"td"},"In-Memory")," and automatically cleared by the named window constrain. Other stream processor elements can only query the values in windows at runtime but they cannot modify them.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"/docs/cep/query-guide/partition"},"Partition")),(0,r.kt)("td",{parentName:"tr",align:null},"A logical container that isolates the processing of queries based on the partition keys derived from the events.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"/docs/cep/query-guide/query"},"Query")),(0,r.kt)("td",{parentName:"tr",align:null},"A logical construct that processes events in a streaming manner by consuming data from one or more streams, tables, windows and aggregations, and publishes output events into a stream, table or a window.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Sink"),(0,r.kt)("td",{parentName:"tr",align:null},"A construct that consumes events arriving at a stream, maps them to a predefined data format (such as ",(0,r.kt)("inlineCode",{parentName:"td"},"XML"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"JSON"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"binary"),", etc), and publishes them to external endpoints (such as ",(0,r.kt)("inlineCode",{parentName:"td"},"E-mail"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"TCP"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"Kafka"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"HTTP"),", etc).")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Source"),(0,r.kt)("td",{parentName:"tr",align:null},"A construct that consumes data from external sources (such as ",(0,r.kt)("inlineCode",{parentName:"td"},"database"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"stream"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"TCP"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"Kafka"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"HTTP"),", etc) with various event formats such as ",(0,r.kt)("inlineCode",{parentName:"td"},"XML"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"JSON"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"binary"),", etc, convert then to stream events, and passes into streams for processing.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"/docs/cep/query-guide/stream"},"Stream")),(0,r.kt)("td",{parentName:"tr",align:null},"A logical series of events ordered in time with a uniquely identifiable name, and a defined set of typed attributes defining its schema.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Stream/Query Callback"),(0,r.kt)("td",{parentName:"tr",align:null},"A mechanism to programmatically consume output events from streams or queries.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"/docs/cep/query-guide/table-collection"},"Table")),(0,r.kt)("td",{parentName:"tr",align:null},"A structured representation of data stored with a defined schema. Stored data is backed by C8DB. The tables (aka collections) can be ",(0,r.kt)("inlineCode",{parentName:"td"},"local")," or ",(0,r.kt)("inlineCode",{parentName:"td"},"geo-replicated"),". Similarly the tables can be ",(0,r.kt)("inlineCode",{parentName:"td"},"document")," or ",(0,r.kt)("inlineCode",{parentName:"td"},"graph")," collections. The tables can be accessed and manipulated at runtime.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"/docs/cep/query-guide/trigger"},"Trigger")),(0,r.kt)("td",{parentName:"tr",align:null},"Triggers allow events to be periodically generated based on time or other conditions.")))))}p.isMDXComponent=!0},40629:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/event-flow-e8b52d8c8b1d8e03215a1454e6684652.png"}}]);