"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[5318],{3905:(e,t,a)=>{a.d(t,{Zo:()=>m,kt:()=>d});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var p=n.createContext({}),l=function(e){var t=n.useContext(p),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},m=function(e){var t=l(e.components);return n.createElement(p.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},h=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,p=e.parentName,m=s(e,["components","mdxType","originalType","parentName"]),h=l(a),d=r,u=h["".concat(p,".").concat(d)]||h[d]||c[d]||o;return a?n.createElement(u,i(i({ref:t},m),{},{components:a})):n.createElement(u,i({ref:t},m))}));function d(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=h;var s={};for(var p in t)hasOwnProperty.call(t,p)&&(s[p]=t[p]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var l=2;l<o;l++)i[l]=a[l];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}h.displayName="MDXCreateElement"},96753:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>p,contentTitle:()=>i,default:()=>c,frontMatter:()=>o,metadata:()=>s,toc:()=>l});var n=a(87462),r=(a(67294),a(3905));const o={sidebar_position:20,title:"Enrich Data with Another Stream"},i=void 0,s={unversionedId:"cep/enrich-data/enrich-data-with-stream",id:"cep/enrich-data/enrich-data-with-stream",title:"Enrich Data with Another Stream",description:"This section explains how to enrich the data in a specific stream by joining it with another stream.",source:"@site/docs/cep/enrich-data/enrich-data-with-stream.md",sourceDirName:"cep/enrich-data",slug:"/cep/enrich-data/enrich-data-with-stream",permalink:"/docs/cep/enrich-data/enrich-data-with-stream",draft:!1,editUrl:"https://github.com/macrometacorp/docs/edit/main/docs/cep/enrich-data/enrich-data-with-stream.md",tags:[],version:"current",sidebarPosition:20,frontMatter:{sidebar_position:20,title:"Enrich Data with Another Stream"},sidebar:"defaultSidebar",previous:{title:"Enrich Data with a Collection",permalink:"/docs/cep/enrich-data/enrich-data-with-collection"},next:{title:"Enrich Data with External Services",permalink:"/docs/cep/enrich-data/enrich-data-external-services"}},p={},l=[],m={toc:l};function c(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},m,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"This section explains how to enrich the data in a specific stream by joining it with another stream."),(0,r.kt)("p",null,"To understand how this is done, consider a scenario where you receive information about cash withdrawals and cash deposits at different bank branches from two separate applications. Therefore, this two types of information are captured via two separate streams. To compare the withdrawals with deposits and observe whether enough deposits are being made to manage the withdrawals, you need to join both these streams. To do this, follow the procedure below."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Open the GUI. Click the ",(0,r.kt)("strong",{parentName:"p"},"Stream Worker")," tab.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Click ",(0,r.kt)("strong",{parentName:"p"},"New")," to define a new stream worker.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Type a ",(0,r.kt)("strong",{parentName:"p"},"Name")," for the stream worker. For example, ",(0,r.kt)("inlineCode",{parentName:"p"},"BankTransactionsApp"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Type a ",(0,r.kt)("strong",{parentName:"p"},"Description"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Define the two input streams via which you are receiving information about withdrawals and deposits."),(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Create a stream named ",(0,r.kt)("inlineCode",{parentName:"p"},"CashWithdrawalStream")," to capture information about withdrawals as follows."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE STREAM CashWithdrawalStream(branchID int, amount long);\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Create a stream named ",(0,r.kt)("inlineCode",{parentName:"p"},"CashDepositsStream")," to capture information about deposits as follows."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE STREAM CashDepositsStream(branchID int, amount long);\n"))))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Now let's define an output stream to which the combined information from both the input streams need to be directed after the join."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE SINK CashFlowStream WITH (type='stream', stream.list='CashFlowStream') (branchID int, withdrawalAmount long, depositAmount long);\n")),(0,r.kt)("p",{parentName:"li"},"!!!info\nA sink annotation is connected to the output stream to publish the output events. For more information about adding sinks to publish events, see the ",(0,r.kt)("a",{parentName:"p",href:"/docs/cep/tutorials/publishing-data"},"Publishing Data guide"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"To specify how the join is performed, and how to use the combined information, write a query to a stream as follows."),(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"To perform the join, add the ",(0,r.kt)("inlineCode",{parentName:"p"},"from")," clause as follows."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"from CashWithdrawalStream window sliding_time(1 min) as w \njoin CashDepositsStream window sliding_time(1 min) as d \non w.branchID == d.branchID\n")),(0,r.kt)("admonition",{parentName:"li",type:"info"},(0,r.kt)("pre",{parentName:"admonition"},(0,r.kt)("code",{parentName:"pre"},"Observe the following about the above `from` clause:\n\n* Both the input streams have attributes of the same name. To identify each name, you must specify a reference\n for each stream. In this example, the reference for the `CashWithdrawalStream` is `w`, and the reference for the `CashDepositsStream` stream is `d`.\n* You need to use `join` as the keyword to join two streams. The join condition is ` w.branchID == d.branchID` \n  where branch IDs are matched. An event in the `CashWithdrawalStream` stream is directed to the `CashFlowStream` if there are events with the same branch ID in the `CashDepositStream` and vice versa.\n")))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"To specify how the value for each attribute is derived, add a ",(0,r.kt)("inlineCode",{parentName:"p"},"select")," statement as follows."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"select w.branchID as branchID, w.amount as withdrawalAmount, d.amount as depositAmount\n")),(0,r.kt)("admonition",{parentName:"li",type:"info"},(0,r.kt)("pre",{parentName:"admonition"},(0,r.kt)("code",{parentName:"pre"},"The `branchID` attribute name is common to both input streams. Therefore, you can also specify `d.branchID as branchID` instead of `w.branchId as branchId`.\n")))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"To filter only events where total cash withdrawals are greater than 95% of the cash deposits, add a ",(0,r.kt)("inlineCode",{parentName:"p"},"having")," clause as follows."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"having w.amount > d.amount * 0.95 \n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"To insert the results into the ",(0,r.kt)("inlineCode",{parentName:"p"},"CashFlowStream")," output stream, add the ",(0,r.kt)("inlineCode",{parentName:"p"},"insert into")," clause as follows."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"insert into CashFlowStream;\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"The completed stream worker is as follows:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"@App:name(\"BankTransactionsApp\")\n@App:qlVersion(\"2\")\n\nCREATE STREAM CashWithdrawalStream(branchID int, amount long);\n\nCREATE STREAM CashDepositsStream(branchID int, amount long);\n\nCREATE SINK CashFlowStream WITH (type='stream', stream='CashFlowStream') (branchID int, withdrawalAmount long, depositAmount long);\n\ninsert into CashFlowStream\nselect w.branchID as branchID, w.amount as withdrawalAmount, d.amount as depositAmount\nfrom CashWithdrawalStream window sliding_time(1 min) as w \n    join CashDepositsStream window sliding_time(1 min) as d \n    on w.branchID == d.branchID\n    having w.amount > d.amount * 0.95;\n")))))),(0,r.kt)("p",null,"For the different types of joins you can perform via streams, see ",(0,r.kt)("a",{parentName:"p",href:"/docs/cep/query-guide/query#join-stream"},"Stream Query Guide - Join")))}c.isMDXComponent=!0}}]);