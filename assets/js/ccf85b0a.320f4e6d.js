"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[38040],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>m});var r=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var c=r.createContext({}),s=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},u=function(e){var t=s(e.components);return r.createElement(c.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,c=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),d=s(n),m=o,h=d["".concat(c,".").concat(m)]||d[m]||p[m]||a;return n?r.createElement(h,l(l({ref:t},u),{},{components:n})):r.createElement(h,l({ref:t},u))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,l=new Array(a);l[0]=d;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i.mdxType="string"==typeof e?e:o,l[1]=i;for(var s=2;s<a;s++)l[s]=n[s];return r.createElement.apply(null,l)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},85162:(e,t,n)=>{n.d(t,{Z:()=>l});var r=n(67294),o=n(34334);const a="tabItem_Ymn6";function l(e){let{children:t,hidden:n,className:l}=e;return r.createElement("div",{role:"tabpanel",className:(0,o.Z)(a,l),hidden:n},t)}},65488:(e,t,n)=>{n.d(t,{Z:()=>m});var r=n(87462),o=n(67294),a=n(34334),l=n(72389),i=n(67392),c=n(7094),s=n(12466);const u="tabList__CuJ",p="tabItem_LNqP";function d(e){const{lazy:t,block:n,defaultValue:l,values:d,groupId:m,className:h}=e,f=o.Children.map(e.children,(e=>{if((0,o.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})),b=d??f.map((e=>{let{props:{value:t,label:n,attributes:r}}=e;return{value:t,label:n,attributes:r}})),y=(0,i.l)(b,((e,t)=>e.value===t.value));if(y.length>0)throw new Error(`Docusaurus error: Duplicate values "${y.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`);const g=null===l?l:l??f.find((e=>e.props.default))?.props.value??f[0].props.value;if(null!==g&&!b.some((e=>e.value===g)))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${g}" but none of its children has the corresponding value. Available values are: ${b.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);const{tabGroupChoices:v,setTabGroupChoices:w}=(0,c.U)(),[k,T]=(0,o.useState)(g),x=[],{blockElementScrollPositionUntilNextRender:N}=(0,s.o5)();if(null!=m){const e=v[m];null!=e&&e!==k&&b.some((t=>t.value===e))&&T(e)}const j=e=>{const t=e.currentTarget,n=x.indexOf(t),r=b[n].value;r!==k&&(N(t),T(r),null!=m&&w(m,String(r)))},E=e=>{let t=null;switch(e.key){case"ArrowRight":{const n=x.indexOf(e.currentTarget)+1;t=x[n]??x[0];break}case"ArrowLeft":{const n=x.indexOf(e.currentTarget)-1;t=x[n]??x[x.length-1];break}}t?.focus()};return o.createElement("div",{className:(0,a.Z)("tabs-container",u)},o.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.Z)("tabs",{"tabs--block":n},h)},b.map((e=>{let{value:t,label:n,attributes:l}=e;return o.createElement("li",(0,r.Z)({role:"tab",tabIndex:k===t?0:-1,"aria-selected":k===t,key:t,ref:e=>x.push(e),onKeyDown:E,onFocus:j,onClick:j},l,{className:(0,a.Z)("tabs__item",p,l?.className,{"tabs__item--active":k===t})}),n??t)}))),t?(0,o.cloneElement)(f.filter((e=>e.props.value===k))[0],{className:"margin-top--md"}):o.createElement("div",{className:"margin-top--md"},f.map(((e,t)=>(0,o.cloneElement)(e,{key:t,hidden:e.props.value!==k})))))}function m(e){const t=(0,l.Z)();return o.createElement(d,(0,r.Z)({key:String(t)},e))}},11041:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>c,default:()=>m,frontMatter:()=>i,metadata:()=>s,toc:()=>p});var r=n(87462),o=(n(67294),n(3905)),a=n(65488),l=n(85162);const i={sidebar_position:70,title:"Retrieving Data"},c=void 0,s={unversionedId:"collections/returning-collection-data",id:"collections/returning-collection-data",title:"Retrieving Data",description:"This page describes how to retrieve larger result sets from a collection with the default limit of 1,000 documents per query.",source:"@site/docs/collections/returning-collection-data.md",sourceDirName:"collections",slug:"/collections/returning-collection-data",permalink:"/docs/collections/returning-collection-data",draft:!1,editUrl:"https://github.com/macrometacorp/docs/edit/main/docs/collections/returning-collection-data.md",tags:[],version:"current",sidebarPosition:70,frontMatter:{sidebar_position:70,title:"Retrieving Data"},sidebar:"defaultSidebar",previous:{title:"Delete Collections",permalink:"/docs/collections/delete-collection"},next:{title:"Document Store",permalink:"/docs/collections/documents/"}},u={},p=[{value:"SDK download",id:"sdk-download",level:3},{value:"Cursor",id:"cursor",level:3},{value:"Collection Export",id:"collection-export",level:3}],d={toc:p};function m(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,r.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"This page describes how to retrieve larger result sets from a collection with the default limit of 1,000 documents per query."),(0,o.kt)("p",null,"There are two recommended approaches depending on the volume of data being returned. The ",(0,o.kt)("a",{parentName:"p",href:"https://macrometa.com/docs/api#/operations/createQueryCursor"},"Cursor")," endpoint from Macrometa API can be used to fetch up to 30,000 records, this is an approximation based on platform limits. Attempting to return more than 30,000 from the endpoint may cause the query to exceed the query execution time limit and raise an error. The ",(0,o.kt)("a",{parentName:"p",href:"https://macrometa.com/docs/api#/operations/ExportCollectionData"},"Collection Export")," endpoint from Macrometa API is the recommended approach when retrieving an entire collection."),(0,o.kt)("p",null,"Create a connection to the GDN using the jsc8 SDK. You will need an API key, JWT, or Email/Password to complete authentication. For more information, refer to ",(0,o.kt)("a",{parentName:"p",href:"/docs/account-management/auth/"},"Authentication"),"."),(0,o.kt)("h3",{id:"sdk-download"},"SDK download"),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"This solution is not currently supported in the pyc8 SDK")),(0,o.kt)(a.Z,{groupId:"operating-systems",mdxType:"Tabs"},(0,o.kt)(l.Z,{value:"js",label:"Javascript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"With Yarn or NPM\n\n    yarn add jsc8@beta\n    (or)\n    npm install jsc8@beta\n\nIf you want to use the SDK outside of the current directory, you can also install it globally using the `--global` flag:\n\n    npm install --global jsc8@beta\n\nFrom source,\n\n    git clone https://github.com/macrometacorp/jsc8.git\n    cd jsC8\n    npm install\n    npm run dist\n")))),(0,o.kt)("h3",{id:"cursor"},"Cursor"),(0,o.kt)("p",null,"We can create a cursor to receive the results from our request. A cursor details where we left off when reading a stream of responses from API, so we can continue to read the batch of required data. When calling the ",(0,o.kt)("inlineCode",{parentName:"p"},"query")," method request options are provided as key/value pairs. For a detailed explanation of options visit the ",(0,o.kt)("a",{parentName:"p",href:"https://macrometa.com/docs/api#/operations/createQueryCursor"},"API reference"),". Set the ",(0,o.kt)("inlineCode",{parentName:"p"},"batchSize")," to the required value (code ex. 1000) and the ",(0,o.kt)("inlineCode",{parentName:"p"},"stream")," value to true. This will permit the results from the query to be returned as a stream, allowing us to return subsequent batches of data. In response, the entire result set is loaded into the cursor (code ex. ",(0,o.kt)("inlineCode",{parentName:"p"},"cursor"),"). Therefore we must be mindful of client-side memory capacity when running queries that can potentially return a large result set."),(0,o.kt)(a.Z,{groupId:"operating-systems",mdxType:"Tabs"},(0,o.kt)(l.Z,{value:"js",label:"Javascript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'const jsc8 = require("jsc8");\nclient = new jsc8({\n  url: "https://play.paas.macrometa.io",\n  apiKey: "[apiKey]",\n  fabricName: "_system",\n});\n\n(async function () {\n  let query = "FOR i IN collection RETURN i";\n  let result = "";\n  try {\n    const cursor = await client.query(\n      query,\n      {},\n      { batchSize: 1000, count: true, stream: true }\n    );\n    result = await cursor.all();\n  } catch (e) {\n    console.log(e.response.body);\n  }\n  console.log("Results:", result);\n})();\n')))),(0,o.kt)("h3",{id:"collection-export"},"Collection Export"),(0,o.kt)("p",null,"The Collection Export example should be used when retrieving the entire collection with out filtering the results. Entire collections can also be exported from the GDN web application. Get the collection document count to determine the necessary number of iterations to retrieve all documents. After each iteration the offset will increment by the batch size and return the next set of results."),(0,o.kt)(a.Z,{groupId:"operating-systems",mdxType:"Tabs"},(0,o.kt)(l.Z,{value:"js",label:"Javascript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'const jsc8 = require("jsc8");\nclient = new jsc8({\n  url: "https://play.paas.macrometa.io",\n  apiKey: "[apiKey]",\n  fabricName: "_system",\n});\n\nconst coll = "[collection-name]"\nconst batchSize = 1000;\n\nlet data = [];\n(async function () {\n    try {\n        const { count } = await client.collection(coll).count();\n        const num = Math.ceil(count / batchSize);\n        for (let i = 0; i < num; i++) {\n            let offset = i * batchSize;\n            let cursor = await client.exportDataByCollectionName(coll, {\n                offset: offset,\n                limit: batchSize,\n            });\n            console.log(\n                `Data pulled from source fabric, collection ${coll}, ${i + 1\n                } of ${num}, server code: ${cursor.code}`\n             );\n            data.push.apply(data, cursor.result);\n        }\n        console.log(data);\n    } catch (e) {\n        console.log(e);\n    }\n})();\n')))))}m.isMDXComponent=!0}}]);