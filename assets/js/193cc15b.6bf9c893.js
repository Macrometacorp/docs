"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[27475],{3905:(e,t,s)=>{s.d(t,{Zo:()=>u,kt:()=>h});var r=s(67294);function a(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function n(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}function i(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?n(Object(s),!0).forEach((function(t){a(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):n(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function o(e,t){if(null==e)return{};var s,r,a=function(e,t){if(null==e)return{};var s,r,a={},n=Object.keys(e);for(r=0;r<n.length;r++)s=n[r],t.indexOf(s)>=0||(a[s]=e[s]);return a}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(r=0;r<n.length;r++)s=n[r],t.indexOf(s)>=0||Object.prototype.propertyIsEnumerable.call(e,s)&&(a[s]=e[s])}return a}var l=r.createContext({}),c=function(e){var t=r.useContext(l),s=t;return e&&(s="function"==typeof e?e(t):i(i({},t),e)),s},u=function(e){var t=c(e.components);return r.createElement(l.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var s=e.components,a=e.mdxType,n=e.originalType,l=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),d=c(s),h=a,p=d["".concat(l,".").concat(h)]||d[h]||m[h]||n;return s?r.createElement(p,i(i({ref:t},u),{},{components:s})):r.createElement(p,i({ref:t},u))}));function h(e,t){var s=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var n=s.length,i=new Array(n);i[0]=d;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o.mdxType="string"==typeof e?e:a,i[1]=o;for(var c=2;c<n;c++)i[c]=s[c];return r.createElement.apply(null,i)}return r.createElement.apply(null,s)}d.displayName="MDXCreateElement"},14741:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>m,frontMatter:()=>n,metadata:()=>o,toc:()=>c});var r=s(87462),a=(s(67294),s(3905));const n={sidebar_position:40,title:"Subscriptions"},i=void 0,o={unversionedId:"streams/stream-basics/subscriptions",id:"streams/stream-basics/subscriptions",title:"Subscriptions",description:"A subscription is a named configuration rule that determines how messages are delivered to consumers. There are three available subscription modes in GDN streams: exclusive, shared, and failover. These modes are illustrated in the figure below.",source:"@site/docs/streams/stream-basics/subscriptions.md",sourceDirName:"streams/stream-basics",slug:"/streams/stream-basics/subscriptions",permalink:"/docs/streams/stream-basics/subscriptions",draft:!1,editUrl:"https://github.com/macrometacorp/docs/edit/main/docs/streams/stream-basics/subscriptions.md",tags:[],version:"current",sidebarPosition:40,frontMatter:{sidebar_position:40,title:"Subscriptions"},sidebar:"defaultSidebar",previous:{title:"Consumers",permalink:"/docs/streams/stream-basics/consumers"},next:{title:"Stream Tasks",permalink:"/docs/streams/stream-tasks/"}},l={},c=[{value:"Exclusive",id:"exclusive",level:2},{value:"Shared",id:"shared",level:2},{value:"Limitations of Shared Mode",id:"limitations-of-shared-mode",level:3},{value:"Failover",id:"failover",level:2},{value:"Key_Shared",id:"key_shared",level:2},{value:"Limitations of Key_Shared Subscriptions",id:"limitations-of-key_shared-subscriptions",level:3},{value:"Multi-stream Subscriptions",id:"multi-stream-subscriptions",level:2},{value:"No Ordering Guarantees",id:"no-ordering-guarantees",level:3}],u={toc:c};function m(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"A subscription is a named configuration rule that determines how messages are delivered to consumers. There are three available subscription modes in GDN streams: ",(0,a.kt)("a",{parentName:"p",href:"#exclusive"},"exclusive"),", ",(0,a.kt)("a",{parentName:"p",href:"#shared"},"shared"),", and ",(0,a.kt)("a",{parentName:"p",href:"#failover"},"failover"),". These modes are illustrated in the figure below."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"stream-subscription-modes",src:s(2741).Z,width:"1652",height:"1212"})),(0,a.kt)("h2",{id:"exclusive"},"Exclusive"),(0,a.kt)("p",null,"In ",(0,a.kt)("em",{parentName:"p"},"exclusive")," mode, only a single consumer is allowed to attach to the subscription. If more than one consumer attempts to subscribe to a stream using the same subscription, then the consumer receives an error."),(0,a.kt)("p",null,"In the diagram below, only Consumer-A is allowed to consume messages."),(0,a.kt)("p",null,"Exclusive mode is the default subscription mode."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"stream-exclusive-subscriptions",src:s(54639).Z,width:"2010",height:"730"})),(0,a.kt)("h2",{id:"shared"},"Shared"),(0,a.kt)("p",null,"In ",(0,a.kt)("em",{parentName:"p"},"shared")," or ",(0,a.kt)("em",{parentName:"p"},"round robin")," mode, multiple consumers can attach to the same subscription. Messages are delivered in a round robin distribution across consumers, and any given message is delivered to only one consumer."),(0,a.kt)("p",null,"When a consumer disconnects, all the messages that were sent to it and not acknowledged are rescheduled for sending to the remaining consumers."),(0,a.kt)("p",null,"In the diagram below, Consumer-B-1 and Consumer-B-2 can subscribe to the stream, but Consumer-C-1 and others could as well."),(0,a.kt)("h3",{id:"limitations-of-shared-mode"},"Limitations of Shared Mode"),(0,a.kt)("p",null,"There are two important things to be aware of when using shared mode:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Message ordering is not guaranteed."),(0,a.kt)("li",{parentName:"ul"},"You cannot use cumulative acknowledgment with shared mode.")),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"stream-shared-subscriptions",src:s(80540).Z,width:"1848",height:"780"})),(0,a.kt)("h2",{id:"failover"},"Failover"),(0,a.kt)("p",null,"In ",(0,a.kt)("em",{parentName:"p"},"failover")," mode, multiple consumers can attach to the same subscription. A master consumer is picked for the stream to receives messages. When the master consumer disconnects, all non-acknowledged and subsequent messages are delivered to the next consumer in line."),(0,a.kt)("p",null,"In the diagram below, Consumer-C-1 is the master consumer while Consumer-C-2 would be the next in line to receive messages if Consumer-C-1 disconnected."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"stream-failover-subscriptions",src:s(62847).Z,width:"1834",height:"734"})),(0,a.kt)("h2",{id:"key_shared"},"Key_Shared"),(0,a.kt)("p",null,"In ",(0,a.kt)("em",{parentName:"p"},"key_shared")," mode, multiple consumers can attach to the same subscription. Messages are delivered in a distribution across consumers and messages with the same key or same ordering key are delivered to only one consumer. No matter how many times the message is re-delivered, it is delivered to the same consumer. When a consumer connected or disconnected will cause served consumer change for some key of message."),(0,a.kt)("p",null,"Note that when the consumers are using the Key_Shared subscription type, you need to disable batching or use key-based batching for the producers. There are two reasons why the key-based batching is necessary for Key_Shared subscription type:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"The broker dispatches messages according to the keys of the messages, but the default batching approach might fail to pack the messages with the same key to the same batch."),(0,a.kt)("li",{parentName:"ul"},"Because it is the consumers instead of the broker that dispatch the messages from the batches, the key of the first message in one batch is considered the key of all messages in this batch, thereby leading to context errors.")),(0,a.kt)("p",null,"The key-based batching aims at resolving the above-mentioned issues. This batching method ensures that the producers pack the messages with the same key to the same batch. The messages without a key are packed into one batch and this batch has no key. When the broker dispatches messages from this batch, it uses NON_KEY as the key. In addition, each consumer is associated with only one key and should receive only one message batch for the connected key. By default, you can limit batching by configuring the number of messages that producers are allowed to send."),(0,a.kt)("p",null,"Below is an example of enabling the key-based batching under the key_shared subscription type."),(0,a.kt)("h3",{id:"limitations-of-key_shared-subscriptions"},"Limitations of Key_Shared Subscriptions"),(0,a.kt)("p",null,"When you use key_shared subscriptions, be aware that:"),(0,a.kt)("p",null,"-You need to specify a key or orderingKey for messages.\n-You cannot use cumulative acknowledgment with key_shared subscriptions."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"stream-key-shared-subscriptions",src:s(53907).Z,width:"1478",height:"640"})),(0,a.kt)("h2",{id:"multi-stream-subscriptions"},"Multi-stream Subscriptions"),(0,a.kt)("p",null,"When a consumer subscribes to a GDN stream, by default it subscribes to one specific stream, such as ",(0,a.kt)("inlineCode",{parentName:"p"},"persistent://tenant1/fabric1/my-stream"),". GDN stream consumers can simultaneously subscribe to multiple streams. You can define a list of streams in two ways:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"On the basis of a ",(0,a.kt)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/Regular_expression"},(0,a.kt)("strong",{parentName:"a"},"reg"),"ular ",(0,a.kt)("strong",{parentName:"a"},"ex"),"pression")," (regex), for example ",(0,a.kt)("inlineCode",{parentName:"li"},"persistent://tenant1/fabric1/finance-.*")),(0,a.kt)("li",{parentName:"ul"},"By explicitly defining a list of streams")),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},"When subscribing to multiple streams by regex, all streams must be in the same ",(0,a.kt)("inlineCode",{parentName:"p"},"geofabric"),".")),(0,a.kt)("p",null,"When subscribing to multiple streams, the GDN stream client will automatically make a call to the GDN API to discover the streams that match the regex pattern/list and then subscribe to all of them. If any of the streams don't currently exist, the consumer will auto-subscribe to them once the streams are created."),(0,a.kt)("h3",{id:"no-ordering-guarantees"},"No Ordering Guarantees"),(0,a.kt)("p",null,"When a consumer subscribes to multiple streams, all ordering guarantees normally provided by GDN on single stream do not hold. If your use case for GDN involves any strict ordering requirements, then we strongly recommend against using this feature."))}m.isMDXComponent=!0},54639:(e,t,s)=>{s.d(t,{Z:()=>r});const r=s.p+"assets/images/stream-exclusive-subscriptions-14a3026a4d166b4d5d90ea18a4628f36.png"},62847:(e,t,s)=>{s.d(t,{Z:()=>r});const r=s.p+"assets/images/stream-failover-subscriptions-8fca08ff42b1ef0ff53ef383f5be42be.png"},53907:(e,t,s)=>{s.d(t,{Z:()=>r});const r=s.p+"assets/images/stream-key-shared-subscriptions-032fc461cef7568bbc1e2ce697e18310.png"},80540:(e,t,s)=>{s.d(t,{Z:()=>r});const r=s.p+"assets/images/stream-shared-subscriptions-72441c09d01cd35f451cd4b41b247639.png"},2741:(e,t,s)=>{s.d(t,{Z:()=>r});const r=s.p+"assets/images/stream-subscription-modes-bf8623b1c26420647ab27a5c27e4c97b.png"}}]);