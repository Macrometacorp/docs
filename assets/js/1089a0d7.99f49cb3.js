"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[51145],{3905:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>u});var a=t(67294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,o=function(e,n){if(null==e)return{};var t,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var l=a.createContext({}),p=function(e){var n=a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},c=function(e){var n=p(e.components);return a.createElement(l.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef((function(e,n){var t=e.components,o=e.mdxType,r=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),m=p(t),u=o,y=m["".concat(l,".").concat(u)]||m[u]||d[u]||r;return t?a.createElement(y,i(i({ref:n},c),{},{components:t})):a.createElement(y,i({ref:n},c))}));function u(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var r=t.length,i=new Array(r);i[0]=m;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s.mdxType="string"==typeof e?e:o,i[1]=s;for(var p=2;p<r;p++)i[p]=t[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},20714:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>r,metadata:()=>s,toc:()=>p});var a=t(87462),o=(t(67294),t(3905));const r={sidebar_position:40,title:"AWS Javascript SDK (Node)"},i=void 0,s={unversionedId:"collections/dynamo/using-aws-js-nodejs",id:"collections/dynamo/using-aws-js-nodejs",title:"AWS Javascript SDK (Node)",description:"Macrometa GDN can be used as the data store for apps written for AWS DynamoDB. Switch to using GDN by just changing the connection URL, accessKey and secretKey. You can continue using aws dynamodb sdk and cli you are familiar with.",source:"@site/docs/collections/dynamo/using-aws-js-nodejs.md",sourceDirName:"collections/dynamo",slug:"/collections/dynamo/using-aws-js-nodejs",permalink:"/docs/collections/dynamo/using-aws-js-nodejs",draft:!1,editUrl:"https://github.com/macrometacorp/docs/edit/main/docs/collections/dynamo/using-aws-js-nodejs.md",tags:[],version:"current",sidebarPosition:40,frontMatter:{sidebar_position:40,title:"AWS Javascript SDK (Node)"},sidebar:"defaultSidebar",previous:{title:"AWS Javascript SDK (browser)",permalink:"/docs/collections/dynamo/using-aws-js-browser"},next:{title:"Using AWS Boto3",permalink:"/docs/collections/dynamo/using-aws-boto3"}},l={},p=[{value:"Prerequistes",id:"prerequistes",level:2},{value:"Create Global Table",id:"create-global-table",level:2},{value:"Load Sample Data",id:"load-sample-data",level:2},{value:"Create a New Item",id:"create-a-new-item",level:2},{value:"Read an Item",id:"read-an-item",level:2},{value:"Update an Item",id:"update-an-item",level:2},{value:"Increment an Atomic Counter",id:"increment-an-atomic-counter",level:2},{value:"Update an Item (Conditionally)",id:"update-an-item-conditionally",level:2},{value:"Delete an Item",id:"delete-an-item",level:2},{value:"Query the Data",id:"query-the-data",level:2},{value:"Query - All Movies Released in a Year",id:"query---all-movies-released-in-a-year",level:3},{value:"Query - All Movies Released in a Year with Certain Titles",id:"query---all-movies-released-in-a-year-with-certain-titles",level:3},{value:"Scan Table",id:"scan-table",level:2},{value:"Delete Table",id:"delete-table",level:2}],c={toc:p};function d(e){let{components:n,...r}=e;return(0,o.kt)("wrapper",(0,a.Z)({},c,r,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"Macrometa GDN can be used as the data store for apps written for AWS DynamoDB. Switch to using GDN by just changing the ",(0,o.kt)("inlineCode",{parentName:"p"},"connection URL"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"accessKey")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"secretKey"),". You can continue using aws dynamodb sdk and cli you are familiar with."),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"Macrometa GDN provides aws dynamo db ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("em",{parentName:"strong"},"global tables"))," as the ",(0,o.kt)("inlineCode",{parentName:"p"},"default")," option. ")),(0,o.kt)("p",null,"This enables you to deliver low-latency data access to your users no matter where they are located. GDN performs all of the necessary tasks to create identical tables in all the regions around the globe and propagate ongoing data changes to all of them."),(0,o.kt)("p",null,"Similarly GDN provides better data consistency guarantees i.e., ",(0,o.kt)("inlineCode",{parentName:"p"},"strong consistency")," within a region and ",(0,o.kt)("inlineCode",{parentName:"p"},"strong eventual consistency")," across regions utilizing CRDTs and partially ordered logs."),(0,o.kt)("p",null,"In this tutorial, you use the AWS SDK for JavaScript to write simple applications to perform the following Amazon DynamoDB operations:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Create a table named Movies and load sample data in JSON format."),(0,o.kt)("li",{parentName:"ul"},"Perform create, read, update, and delete operations on the table."),(0,o.kt)("li",{parentName:"ul"},"Run simple queries.")),(0,o.kt)("h2",{id:"prerequistes"},"Prerequistes"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Create an API Key"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"Login to your tenant account on ",(0,o.kt)("a",{parentName:"li",href:"https://play.paas.macrometa.io"},"https://play.paas.macrometa.io")),(0,o.kt)("li",{parentName:"ul"},"Create an API key via REST API. Make a copy of the key.")),(0,o.kt)("admonition",{parentName:"li",type:"tip"},(0,o.kt)("pre",{parentName:"admonition"},(0,o.kt)("code",{parentName:"pre"},"Following api key is created under `demo@macrometa.io/_system` on https://play.paas.macrometa.io with `rw` permissions.\n```bash\n    demo.demok1.1a1aad0f4b000ca4d2d3bdb505298cbb9467b65526b0f79364e61e5f00000000\n```\n")))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Set up the AWS SDK for JavaScript. "),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"Install ",(0,o.kt)("a",{parentName:"li",href:"http://nodejs.org/"},"Node.js")),(0,o.kt)("li",{parentName:"ul"},"Install the ",(0,o.kt)("a",{parentName:"li",href:"https://aws.amazon.com/sdk-for-node-js"},"AWS SDK for JavaScript"))))),(0,o.kt)("h2",{id:"create-global-table"},"Create Global Table"),(0,o.kt)("p",null,"Macrometa GDN provides aws dynamo db ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("em",{parentName:"strong"},"global tables"))," as the ",(0,o.kt)("inlineCode",{parentName:"p"},"default")," option. In this step, you create a table named ",(0,o.kt)("inlineCode",{parentName:"p"},"Movies"),". The primary key for the table is composed of the following attributes:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"year")," \u2013 The partition key. The AttributeType is ",(0,o.kt)("inlineCode",{parentName:"li"},"N")," for number."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"title")," \u2013 The sort key. The AttributeType is ",(0,o.kt)("inlineCode",{parentName:"li"},"S")," for string.")),(0,o.kt)("p",null,"Create following file - ",(0,o.kt)("inlineCode",{parentName:"p"},"MoviesCreateTable.js"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'    var AWS = require("aws-sdk");\n\n    const dcName = "play.paas.macrometa.io";\n\n    const host = "https://api-" + dcName;\n    const apiKey =\n    "<your-api-key>";\n    const region = "us-east-1";\n    const endpoint = host + "/_api/dynamo";\n    // secretAccessKey is a required parameter for aws-sdk we recommend you to pass "c8"\n    const secretAccessKey = "c8";\n    const accessKeyId = "apikey " + apiKey;\n    AWS.config.update({\n        region,\n        endpoint,\n        accessKeyId,\n        secretAccessKey,\n    });\n\n    var dynamodb = new AWS.DynamoDB();\n\n    var params = {\n        TableName : "Movies",\n        KeySchema: [       \n            { AttributeName: "year", KeyType: "HASH"},  //Partition key\n            { AttributeName: "title", KeyType: "RANGE" }  //Sort key\n        ],\n        AttributeDefinitions: [       \n            { AttributeName: "year", AttributeType: "N" },\n            { AttributeName: "title", AttributeType: "S" }\n        ],\n        ProvisionedThroughput: {       \n            ReadCapacityUnits: 10, \n            WriteCapacityUnits: 10\n        }\n    };\n\n    dynamodb.createTable(params, function(err, data) {\n        if (err) {\n            console.error("Unable to create table. Error JSON:", JSON.stringify(err, null, 2));\n        } else {\n            console.log("Created table. Table description JSON:", JSON.stringify(data, null, 2));\n        }\n    });\n\n')),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("pre",{parentName:"admonition"},(0,o.kt)("code",{parentName:"pre"},"* You set the endpoint to indicate that you are connecting to macrometa gdn.\n* For `accessKeyId` and `secretKey`, you can specify either Macrometa `api key` or `jwt token` of your account.\n* In the `createTable` call, you specify table name, primary key attributes, and its data types.\n* The ProvisionedThroughput parameter is ignored.\n"))),(0,o.kt)("p",null,"To run the program, enter the following command."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"    node MoviesCreateTable.js\n")),(0,o.kt)("h2",{id:"load-sample-data"},"Load Sample Data"),(0,o.kt)("p",null,"This scenario uses a sample data file that contains information about a few thousand movies from the Internet Movie Database (IMDb). The movie data is in JSON format, as shown in the following example. For each movie, there is a year, a title, and a JSON map named info."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'[\n   {\n      "year" : ... ,\n      "title" : ... ,\n      "info" : { ... }\n   },\n   {\n      "year" : ...,\n      "title" : ...,\n      "info" : { ... }\n   },\n\n    ...\n\n]\n')),(0,o.kt)("p",null,"In the JSON data, note the following:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"The year and title are used as the primary key attribute values for the Movies table."),(0,o.kt)("li",{parentName:"ul"},"The rest of the info values are stored in a single attribute called info. This program illustrates how you can store JSON in an Amazon DynamoDB attribute.")),(0,o.kt)("p",null,"The following is an example of movie data:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "year" : 2013,\n    "title" : "Turn It Down, Or Else!",\n    "info" : {\n        "directors" : [\n            "Alice Smith",\n            "Bob Jones"\n        ],\n        "release_date" : "2013-01-18T00:00:00Z",\n        "rating" : 6.2,\n        "genres" : [\n            "Comedy",\n            "Drama"\n        ],\n        "image_url" : "http://ia.media-imdb.com/images/N/O9ERWAU7FS797AJ7LU8HN09AMUP908RLlo5JF90EWR7LJKQ7@@._V1_SX400_.jpg",\n        "plot" : "A rock band plays their music at high volumes, annoying the neighbors.",\n        "rank" : 11,\n        "running_time_secs" : 5215,\n        "actors" : [\n            "David Matthewman",\n            "Ann Thomas",\n            "Jonathan G. Neff"\n       ]\n    }\n}\n')),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Download the sample data archive: ",(0,o.kt)("a",{target:"_blank",href:t(7860).Z},"moviedata.zip"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Extract the data file i.e., ",(0,o.kt)("inlineCode",{parentName:"p"},"moviedata.json")," from the archive.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Copy and paste the ",(0,o.kt)("inlineCode",{parentName:"p"},"moviedata.json")," file into your current directory.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Copy the following program and paste it into a file named ",(0,o.kt)("inlineCode",{parentName:"p"},"MoviesLoadData.js")," to populate ",(0,o.kt)("inlineCode",{parentName:"p"},"Movies")," table."))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'   \n    var AWS = require("aws-sdk");\n    var fs = require(\'fs\');\n\n\n    const dcName = "play.paas.macrometa.io";\n\n    const host = "https://api-" + dcName;\n    const apiKey =\n    "<your-api-key>";\n    const region = "us-east-1";\n    const endpoint = host + "/_api/dynamo";\n    // secretAccessKey is a required parameter for aws-sdk we recommend you to pass "c8"\n    const secretAccessKey = "c8";\n    const accessKeyId = "apikey " + apiKey;\n    AWS.config.update({\n        region,\n        endpoint,\n        accessKeyId,\n        secretAccessKey,\n    });\n\n    var docClient = new AWS.DynamoDB.DocumentClient();\n\n    console.log("Importing movies into DynamoDB. Please wait.");\n\n    var allMovies = JSON.parse(fs.readFileSync(\'moviedata.json\', \'utf8\'));\n    allMovies.forEach(function(movie) {\n        var params = {\n            TableName: "Movies",\n            Item: {\n                "year":  movie.year,\n                "title": movie.title,\n                "info":  movie.info\n            }\n        };\n\n        docClient.put(params, function(err, data) {\n        if (err) {\n            console.error("Unable to add movie", movie.title, ". Error JSON:", JSON.stringify   (err, null, 2));\n        } else {\n            console.log("PutItem succeeded:", movie.title);\n        }\n        });\n    });\n\n')),(0,o.kt)("ol",{start:5},(0,o.kt)("li",{parentName:"ol"},"To run the program, enter the following command.")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"    node MoviesLoadData.js\n")),(0,o.kt)("h2",{id:"create-a-new-item"},"Create a New Item"),(0,o.kt)("p",null,"In this step, you add a new item to the ",(0,o.kt)("inlineCode",{parentName:"p"},"Movies")," table."),(0,o.kt)("p",null,"Copy the following program and paste it into a file named ",(0,o.kt)("inlineCode",{parentName:"p"},"MoviesItemOps01.js")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'    var AWS = require("aws-sdk");\n    var fs = require(\'fs\');\n\n\n    const dcName = "play.paas.macrometa.io";\n\n    const host = "https://api-" + dcName;\n    const apiKey =\n    "<your-api-key>";\n    const region = "us-east-1";\n    const endpoint = host + "/_api/dynamo";\n    // secretAccessKey is a required parameter for aws-sdk we recommend you to pass "c8"\n    const secretAccessKey = "c8";\n    const accessKeyId = "apikey " + apiKey;\n    AWS.config.update({\n        region,\n        endpoint,\n        accessKeyId,\n        secretAccessKey,\n    });\n\n    var docClient = new AWS.DynamoDB.DocumentClient();\n\n    var table = "Movies";\n\n    var year = 2015;\n    var title = "The Big New Movie";\n\n    var params = {\n        TableName:table,\n        Item:{\n            "year": year,\n            "title": title,\n            "info":{\n                "plot": "Nothing happens at all.",\n                "rating": 0\n            }\n        }\n    };\n\n    console.log("Adding a new item...");\n    docClient.put(params, function(err, data) {\n        if (err) {\n            console.error("Unable to add item. Error JSON:", JSON.stringify(err, null, 2));\n        } else {\n            console.log("Added item:", JSON.stringify(data, null, 2));\n        }\n    });\n\n')),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"The primary key is required. This code adds an item that has a primary key ",(0,o.kt)("inlineCode",{parentName:"p"},"(year, title)")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"info")," attributes. The ",(0,o.kt)("inlineCode",{parentName:"p"},"info")," attribute stores sample JSON that provides more information about the movie.")),(0,o.kt)("p",null,"To run the program, enter the following command."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"    node MoviesItemOps01.js\n")),(0,o.kt)("h2",{id:"read-an-item"},"Read an Item"),(0,o.kt)("p",null,"You can use the ",(0,o.kt)("inlineCode",{parentName:"p"},"get")," method to read the item from the Movies table. You must specify the primary key values, so you can read any item from Movies if you know its year and title."),(0,o.kt)("p",null,"Copy the following program and paste it into a file named ",(0,o.kt)("inlineCode",{parentName:"p"},"MoviesItemOps02.js"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'\n    var AWS = require("aws-sdk");\n\n    AWS.config.update({\n    region: "us-west-2",\n    endpoint: "http://localhost:8000"\n    });\n\n    var docClient = new AWS.DynamoDB.DocumentClient();\n\n    var table = "Movies";\n\n    var year = 2015;\n    var title = "The Big New Movie";\n\n    var params = {\n        TableName: table,\n        Key:{\n            "year": year,\n            "title": title\n        }\n    };\n\n    docClient.get(params, function(err, data) {\n        if (err) {\n            console.error("Unable to read item. Error JSON:", JSON.stringify(err, null, 2));\n        } else {\n            console.log("GetItem succeeded:", JSON.stringify(data, null, 2));\n        }\n    });\n')),(0,o.kt)("p",null,"To run the program, enter the following command."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"    node MoviesItemOps02.js\n")),(0,o.kt)("h2",{id:"update-an-item"},"Update an Item"),(0,o.kt)("p",null,"You can use the ",(0,o.kt)("inlineCode",{parentName:"p"},"update")," method to modify an item. You can update values of existing attributes, add new attributes, or remove attributes."),(0,o.kt)("p",null,"In this example, you perform the following updates:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Change the value of the existing attributes (",(0,o.kt)("inlineCode",{parentName:"li"},"rating"),", ",(0,o.kt)("inlineCode",{parentName:"li"},"plot"),")."),(0,o.kt)("li",{parentName:"ul"},"Add a new list attribute (",(0,o.kt)("inlineCode",{parentName:"li"},"actors"),") to the existing ",(0,o.kt)("inlineCode",{parentName:"li"},"info")," map.")),(0,o.kt)("p",null,"The item changes from the following:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'{\n   year: 2015,\n   title: "The Big New Movie",\n   info: {\n        plot: "Nothing happens at all.",\n        rating: 0\n   }\n}\n')),(0,o.kt)("p",null,"to:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'{\n   year: 2015,\n   title: "The Big New Movie",\n   info: {\n           plot: "Everything happens all at once.",\n           rating: 5.5,\n           actors: ["Larry", "Moe", "Curly"]\n   }\n}\n')),(0,o.kt)("p",null,"Copy the following program and paste it into a file named ",(0,o.kt)("inlineCode",{parentName:"p"},"MoviesItemOps03.js"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'\n    var AWS = require("aws-sdk");\n    var fs = require(\'fs\');\n\n\n    const dcName = "play.paas.macrometa.io";\n\n    const host = "https://api-" + dcName;\n    const apiKey =\n    "<your-api-key>";\n    const region = "us-east-1";\n    const endpoint = host + "/_api/dynamo";\n    // secretAccessKey is a required parameter for aws-sdk we recommend you to pass "c8"\n    const secretAccessKey = "c8";\n    const accessKeyId = "apikey " + apiKey;\n    AWS.config.update({\n        region,\n        endpoint,\n        accessKeyId,\n        secretAccessKey,\n    });\n\n    var docClient = new AWS.DynamoDB.DocumentClient()\n\n    var table = "Movies";\n\n    var year = 2015;\n    var title = "The Big New Movie";\n\n    // Update the item, unconditionally,\n\n    var params = {\n        TableName:table,\n        Key:{\n            "year": year,\n            "title": title\n        },\n        UpdateExpression: "set info.rating = :r, info.plot=:p, info.actors=:a",\n        ExpressionAttributeValues:{\n            ":r": 6.5,\n            ":p": "Everything happens all at once.",\n            ":a": ["Larry", "Moe", "Curly"],\n        },\n        ReturnValues:"ALL_NEW"\n    };\n\n    console.log("Updating the item...");\n    docClient.update(params, function(err, data) {\n        if (err) {\n            console.error("Unable to update item. Error JSON:", JSON.stringify(err, null, 2));\n        } else {\n            console.log("UpdateItem succeeded:", JSON.stringify(data, null, 2));\n        }\n    }); \n')),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("ul",{parentName:"admonition"},(0,o.kt)("li",{parentName:"ul"},"This program uses ",(0,o.kt)("inlineCode",{parentName:"li"},"UpdateExpression")," to describe all updates you want to perform on the specified item."),(0,o.kt)("li",{parentName:"ul"},"The ",(0,o.kt)("inlineCode",{parentName:"li"},"ReturnValues"),' parameter instructs Amazon DynamoDB to return all the attributes of the item, as they appear after the update operation ("ALL_NEW").'))),(0,o.kt)("p",null,"To run the program, enter the following command."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"    node MoviesItemOps03.js\n")),(0,o.kt)("h2",{id:"increment-an-atomic-counter"},"Increment an Atomic Counter"),(0,o.kt)("p",null,"DynamoDB supports atomic counters, where you use the update method to increment or decrement the value of an attribute without interfering with other write requests. (All write requests are applied in the order in which they are received.)"),(0,o.kt)("p",null,"The following program shows how to increment the rating for a movie. Each time you run it, the program increments this attribute by one."),(0,o.kt)("p",null,"Copy the following program and paste it into a file named ",(0,o.kt)("inlineCode",{parentName:"p"},"MoviesItemOps04.js"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},' \n    var AWS = require("aws-sdk");\n    var fs = require(\'fs\');\n\n\n    const dcName = "play.paas.macrometa.io";\n\n    const host = "https://api-" + dcName;\n    const apiKey =\n    "<your-api-key>";\n    const region = "us-east-1";\n    const endpoint = host + "/_api/dynamo";\n    // secretAccessKey is a required parameter for aws-sdk we recommend you to pass "c8"\n    const secretAccessKey = "c8";\n    const accessKeyId = "apikey " + apiKey;\n    AWS.config.update({\n        region,\n        endpoint,\n        accessKeyId,\n        secretAccessKey,\n    });\n\n    var docClient = new AWS.DynamoDB.DocumentClient()\n\n    var table = "Movies";\n\n    var year = 2015;\n    var title = "The Big New Movie";\n\n    // Increment an atomic counter\n\n    var params = {\n        TableName:table,\n        Key:{\n            "year": year,\n            "title": title\n        },\n        UpdateExpression: "set info.rating = info.rating + :val",\n        ExpressionAttributeValues:{\n            ":val": 1\n        },\n        ReturnValues:"ALL_NEW"\n    };\n\n    console.log("Updating the item...");\n    docClient.update(params, function(err, data) {\n        if (err) {\n            console.error("Unable to update item. Error JSON:", JSON.stringify(err, null, 2));\n        } else {\n            console.log("UpdateItem succeeded:", JSON.stringify(data, null, 2));\n        }\n    });\n')),(0,o.kt)("p",null,"To run the program, enter the following command."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"    node MoviesItemOps04.js\n")),(0,o.kt)("h2",{id:"update-an-item-conditionally"},"Update an Item (Conditionally)"),(0,o.kt)("p",null,"The following program shows how to use ",(0,o.kt)("inlineCode",{parentName:"p"},"UpdateItem")," with a condition. If the condition evaluates to true, the update succeeds; otherwise, the update is not performed."),(0,o.kt)("p",null,"In this case, the item is updated only if there are more than three actors in the movie."),(0,o.kt)("p",null,"Copy the following program and paste it into a file named ",(0,o.kt)("inlineCode",{parentName:"p"},"MoviesItemOps05.js"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'\n    var AWS = require("aws-sdk");\n    var fs = require(\'fs\');\n\n\n    const dcName = "play.paas.macrometa.io";\n\n    const host = "https://api-" + dcName;\n    const apiKey =\n    "<your-api-key>";\n    const region = "us-east-1";\n    const endpoint = host + "/_api/dynamo";\n    // secretAccessKey is a required parameter for aws-sdk we recommend you to pass "c8"\n    const secretAccessKey = "c8";\n    const accessKeyId = "apikey " + apiKey;\n    AWS.config.update({\n        region,\n        endpoint,\n        accessKeyId,\n        secretAccessKey,\n    });\n\n    var docClient = new AWS.DynamoDB.DocumentClient()\n\n    var table = "Movies";\n\n    var year = 2015;\n    var title = "The Big New Movie";\n\n    // Conditional update (will fail)\n\n    var params = {\n        TableName:table,\n        Key:{\n            "year": year,\n            "title": title\n        },\n        UpdateExpression: "remove info.actors[0]",\n        ConditionExpression: "size(info.actors) > :num",\n        ExpressionAttributeValues:{\n            ":num": 3\n        },\n        ReturnValues:"ALL_NEW"\n    };\n\n    console.log("Attempting a conditional update...");\n    docClient.update(params, function(err, data) {\n        if (err) {\n            console.error("Unable to update item. Error JSON:", JSON.stringify(err, null, 2));\n        } else {\n            console.log("UpdateItem succeeded:", JSON.stringify(data, null, 2));\n        }\n    });\n \n')),(0,o.kt)("p",null,"To run the program, enter the following command."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"    node MoviesItemOps05.js\n")),(0,o.kt)("p",null,"The program should fail with the following message:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"The conditional update failed\n")),(0,o.kt)("p",null,"This is because the movie has three actors in it, but the condition is checking for ",(0,o.kt)("inlineCode",{parentName:"p"},"greater than three")," actors."),(0,o.kt)("p",null,"Modify the program so that the ",(0,o.kt)("inlineCode",{parentName:"p"},"ConditionExpression")," looks like the following."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'ConditionExpression: "size(info.actors) >= :num", \n')),(0,o.kt)("p",null,"The condition is now greater than or equal to 3 instead of greater than 3."),(0,o.kt)("p",null,"Run the program again. The ",(0,o.kt)("inlineCode",{parentName:"p"},"updateItem")," operation should now succeed."),(0,o.kt)("h2",{id:"delete-an-item"},"Delete an Item"),(0,o.kt)("p",null,"You can use the ",(0,o.kt)("inlineCode",{parentName:"p"},"delete")," method to delete one item by specifying its primary key. You can optionally provide a ",(0,o.kt)("inlineCode",{parentName:"p"},"ConditionExpression")," to prevent the item from being deleted if the condition is not met."),(0,o.kt)("p",null,"In the following example, you try to delete a specific movie item if its rating is 5 or less."),(0,o.kt)("p",null,"Copy the following program and paste it into a file named ",(0,o.kt)("inlineCode",{parentName:"p"},"MoviesItemOps06.js"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'    var AWS = require("aws-sdk");\n    var fs = require(\'fs\');\n\n\n    const dcName = "play.paas.macrometa.io";\n\n    const host = "https://api-" + dcName;\n    const apiKey =\n    "<your-api-key>";\n    const region = "us-east-1";\n    const endpoint = host + "/_api/dynamo";\n    // secretAccessKey is a required parameter for aws-sdk we recommend you to pass "c8"\n    const secretAccessKey = "c8";\n    const accessKeyId = "apikey " + apiKey;\n    AWS.config.update({\n        region,\n        endpoint,\n        accessKeyId,\n        secretAccessKey,\n    });\n\n    var docClient = new AWS.DynamoDB.DocumentClient();\n\n    var table = "Movies";\n\n    var year = 2015;\n    var title = "The Big New Movie";\n\n    var params = {\n        TableName:table,\n        Key:{\n            "year": year,\n            "title": title\n        },\n        ConditionExpression:"info.rating <= :val",\n        ExpressionAttributeValues: {\n            ":val": 5.0\n        }\n    };\n\n    console.log("Attempting a conditional delete...");\n    docClient.delete(params, function(err, data) {\n        if (err) {\n            console.error("Unable to delete item. Error JSON:", JSON.stringify(err, null, 2));\n        } else {\n            console.log("DeleteItem succeeded:", JSON.stringify(data, null, 2));\n        }\n    }); \n \n')),(0,o.kt)("p",null,"To run the program, enter the following command."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"    node MoviesItemOps06.js\n")),(0,o.kt)("p",null,"The program should fail with the following message:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"    The conditional delete failed\n")),(0,o.kt)("p",null,"This is because the rating for this particular movie is ",(0,o.kt)("inlineCode",{parentName:"p"},"greater than 5"),"."),(0,o.kt)("p",null,"Modify the program to remove the condition from ",(0,o.kt)("inlineCode",{parentName:"p"},"params"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'var params = {\n    TableName:table,\n    Key:{\n        "title":title,\n        "year":year\n    }\n};\n')),(0,o.kt)("p",null,"Run the program again. The delete succeeds because you removed the condition."),(0,o.kt)("h2",{id:"query-the-data"},"Query the Data"),(0,o.kt)("p",null,"You can use the query method to retrieve data from a table. You must specify a partition key value; the sort key is optional."),(0,o.kt)("p",null,"The primary key for the Movies table is composed of the following:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"year")," \u2013 The partition key. The attribute type is number. "),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"title")," \u2013 The sort key. The attribute type is string.")),(0,o.kt)("p",null,'To find all movies released during a year, you need to specify only the year. You can also provide the title to retrieve a subset of movies based on some condition (on the sort key); for example, to find movies released in 2014 that have a title starting with the letter "A".'),(0,o.kt)("p",null,"In addition to the ",(0,o.kt)("inlineCode",{parentName:"p"},"query")," method, you can use the ",(0,o.kt)("inlineCode",{parentName:"p"},"scan")," method to retrieve all the table data."),(0,o.kt)("h3",{id:"query---all-movies-released-in-a-year"},"Query - All Movies Released in a Year"),(0,o.kt)("p",null,"The program included in this step retrieves all movies released in the year 1985."),(0,o.kt)("p",null,"Copy the following program and paste it into a file named ",(0,o.kt)("inlineCode",{parentName:"p"},"MoviesQuery01.js"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'    \n    var AWS = require("aws-sdk");\n    var fs = require(\'fs\');\n\n\n    const dcName = "play.paas.macrometa.io";\n\n    const host = "https://api-" + dcName;\n    const apiKey =\n    "<your-api-key>";\n    const region = "us-east-1";\n    const endpoint = host + "/_api/dynamo";\n    // secretAccessKey is a required parameter for aws-sdk we recommend you to pass "c8"\n    const secretAccessKey = "c8";\n    const accessKeyId = "apikey " + apiKey;\n    AWS.config.update({\n        region,\n        endpoint,\n        accessKeyId,\n        secretAccessKey,\n    });\n\n    var docClient = new AWS.DynamoDB.DocumentClient();\n\n    console.log("Querying for movies from 1985.");\n\n    var params = {\n        TableName : "Movies",\n        KeyConditionExpression: "#yr = :yyyy",\n        ExpressionAttributeNames:{\n            "#yr": "year"\n        },\n        ExpressionAttributeValues: {\n            ":yyyy": 1985\n        }\n    };\n\n    docClient.query(params, function(err, data) {\n        if (err) {\n            console.error("Unable to query. Error:", JSON.stringify(err, null, 2));\n        } else {\n            console.log("Query succeeded.");\n            data.Items.forEach(function(item) {\n                console.log(" -", item.year + ": " + item.title);\n            });\n        }\n    });\n  \n')),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("pre",{parentName:"admonition"},(0,o.kt)("code",{parentName:"pre"},"* `ExpressionAttributeNames` provides name substitution. This is used because year is a reserved word in Amazon DynamoDB. You can't use it directly in any expression, including `KeyConditionExpression`. For this reason, you use the expression attribute name `#yr`.\n\n* `ExpressionAttributeValues` provides value substitution. This is used because you can't use literals in any expression, including `KeyConditionExpression`. For this reason, you use the expression attribute value `:yyyy`.\n"))),(0,o.kt)("p",null,"To run the program, enter the following command."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"    node MoviesQuery01.js\n")),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"The preceding program shows how to query a table by its primary key attributes. In DynamoDB, you can optionally create one or more secondary indexes on a table, and query those indexes in the same way that you query a table. Secondary indexes give your applications additional flexibility by allowing queries on non-key attributes. ")),(0,o.kt)("h3",{id:"query---all-movies-released-in-a-year-with-certain-titles"},"Query - All Movies Released in a Year with Certain Titles"),(0,o.kt)("p",null,'The program included in this step retrieves all movies released in year 1992, with title beginning with the letter "A" through the letter "L".'),(0,o.kt)("p",null,"Copy the following program and paste it into a file named ",(0,o.kt)("inlineCode",{parentName:"p"},"MoviesQuery02.js")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'   \n    var AWS = require("aws-sdk");\n    var fs = require(\'fs\');\n\n\n    const dcName = "play.paas.macrometa.io";\n\n    const host = "https://api-" + dcName;\n    const apiKey =\n    "<your-api-key>";\n    const region = "us-east-1";\n    const endpoint = host + "/_api/dynamo";\n    // secretAccessKey is a required parameter for aws-sdk we recommend you to pass "c8"\n    const secretAccessKey = "c8";\n    const accessKeyId = "apikey " + apiKey;\n    AWS.config.update({\n        region,\n        endpoint,\n        accessKeyId,\n        secretAccessKey,\n    });\n\n    var docClient = new AWS.DynamoDB.DocumentClient();\n\n    console.log("Querying for movies from 1992 - titles A-L, with genres and lead actor");\n\n    var params = {\n        TableName : "Movies",\n        ProjectionExpression:"#yr, title, info.genres, info.actors[0]",\n        KeyConditionExpression: "#yr = :yyyy and title between :letter1 and :letter2",\n        ExpressionAttributeNames:{\n            "#yr": "year"\n        },\n        ExpressionAttributeValues: {\n            ":yyyy": 1992,\n            ":letter1": "A",\n            ":letter2": "L"\n        }\n    };\n\n    docClient.query(params, function(err, data) {\n        if (err) {\n            console.log("Unable to query. Error:", JSON.stringify(err, null, 2));\n        } else {\n            console.log("Query succeeded.");\n            data.Items.forEach(function(item) {\n                console.log(" -", item.year + ": " + item.title\n                + " ... " + item.info.genres\n                + " ... " + item.info.actors[0]);\n            });\n        }\n    });\n \n')),(0,o.kt)("p",null,"To run the program, enter the following command."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"    node MoviesQuery02.js\n")),(0,o.kt)("h2",{id:"scan-table"},"Scan Table"),(0,o.kt)("p",null,"The scan method reads every item in the entire table, and returns all the data in the table. You can provide an optional filter_expression, so that only the items matching your criteria are returned. However, the filter is applied only after the entire table has been scanned."),(0,o.kt)("p",null,"The following program scans the entire Movies table, which contains approximately 5,000 items. The scan specifies the optional filter to retrieve only the movies from the 1950s (approximately 100 items), and discard all the others."),(0,o.kt)("p",null,"Copy the following program and paste it into a file named ",(0,o.kt)("inlineCode",{parentName:"p"},"MoviesScan.js"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},' \n    var AWS = require("aws-sdk");\n\n    AWS.config.update({\n        region: "us-west-2",\n        endpoint: "http://localhost:8000"\n    });\n\n    var docClient = new AWS.DynamoDB.DocumentClient();\n\n    var params = {\n        TableName: "Movies",\n        ProjectionExpression: "#yr, title, info.rating",\n        FilterExpression: "#yr between :start_yr and :end_yr",\n        ExpressionAttributeNames: {\n            "#yr": "year",\n        },\n        ExpressionAttributeValues: {\n            ":start_yr": 1950,\n            ":end_yr": 1959 \n        }\n    };\n\n    console.log("Scanning Movies table.");\n    docClient.scan(params, onScan);\n\n    function onScan(err, data) {\n        if (err) {\n            console.error("Unable to scan the table. Error JSON:", JSON.stringify(err, null, 2));\n        } else {\n            // print all the movies\n            console.log("Scan succeeded.");\n            data.Items.forEach(function(movie) {\n            console.log(\n                    movie.year + ": ",\n                    movie.title, "- rating:", movie.info.rating);\n            });\n\n            // continue scanning if we have more movies, because\n            // scan can retrieve a maximum of 1MB of data\n            if (typeof data.LastEvaluatedKey != "undefined") {\n                console.log("Scanning for more...");\n                params.ExclusiveStartKey = data.LastEvaluatedKey;\n                docClient.scan(params, onScan);\n            }\n        }\n    }\n')),(0,o.kt)("p",null,"In the code, note the following:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"ProjectionExpression")," specifies the attributes you want in the scan result."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"FilterExpression")," specifies a condition that returns only items that satisfy the condition. All other items are discarded.")),(0,o.kt)("p",null,"To run the program, enter the following command."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"    node MoviesScan.js\n")),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"You can also use the ",(0,o.kt)("inlineCode",{parentName:"p"},"Scan")," operation with any ",(0,o.kt)("inlineCode",{parentName:"p"},"secondary indexes")," that you have created on the table.")),(0,o.kt)("h2",{id:"delete-table"},"Delete Table"),(0,o.kt)("p",null,"To delete the Movies table, copy the following program and paste it into a file named ",(0,o.kt)("inlineCode",{parentName:"p"},"MoviesDeleteTable.js"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'   \n    var AWS = require("aws-sdk");\n    var fs = require(\'fs\');\n\n\n    const dcName = "play.paas.macrometa.io";\n\n    const host = "https://api-" + dcName;\n    const apiKey =\n    "<your-api-key>";\n    const region = "us-east-1";\n    const endpoint = host + "/_api/dynamo";\n    // secretAccessKey is a required parameter for aws-sdk we recommend you to pass "c8"\n    const secretAccessKey = "c8";\n    const accessKeyId = "apikey " + apiKey;\n    AWS.config.update({\n        region,\n        endpoint,\n        accessKeyId,\n        secretAccessKey,\n    });\n\n    var dynamodb = new AWS.DynamoDB();\n\n    var params = {\n        TableName : "Movies"\n    };\n\n    dynamodb.deleteTable(params, function(err, data) {\n        if (err) {\n            console.error("Unable to delete table. Error JSON:", JSON.stringify(err, null, 2));\n        } else {\n            console.log("Deleted table. Table description JSON:", JSON.stringify(data, null, 2));\n        }\n    });\n\n')),(0,o.kt)("p",null,"To run the program, enter the following command."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"    node MoviesDeleteTable.js\n")))}d.isMDXComponent=!0},7860:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/files/moviedata-17dd93d477fef568b47e9bb0b5abf09c.zip"}}]);