"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[62173],{3905:(e,t,a)=>{a.d(t,{Zo:()=>m,kt:()=>c});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var p=n.createContext({}),s=function(e){var t=n.useContext(p),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},m=function(e){var t=s(e.components);return n.createElement(p.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,p=e.parentName,m=l(e,["components","mdxType","originalType","parentName"]),u=s(a),c=r,N=u["".concat(p,".").concat(c)]||u[c]||d[c]||o;return a?n.createElement(N,i(i({ref:t},m),{},{components:a})):n.createElement(N,i({ref:t},m))}));function c(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=u;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var s=2;s<o;s++)i[s]=a[s];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},67128:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>p,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>l,toc:()=>s});var n=a(87462),r=(a(67294),a(3905));const o={sidebar_position:6},i="Filtering Data",l={unversionedId:"cep/tutorials/filtering-data",id:"cep/tutorials/filtering-data",title:"Filtering Data",description:"Introduction",source:"@site/docs/cep/tutorials/filtering-data.md",sourceDirName:"cep/tutorials",slug:"/cep/tutorials/filtering-data",permalink:"/docs/cep/tutorials/filtering-data",draft:!1,editUrl:"https://github.com/macrometacorp/docs/edit/main/docs/cep/tutorials/filtering-data.md",tags:[],version:"current",sidebarPosition:6,frontMatter:{sidebar_position:6},sidebar:"defaultSidebar",previous:{title:"Transforming Data",permalink:"/docs/cep/tutorials/transforming-data"},next:{title:"Summarizing Data",permalink:"/docs/cep/tutorials/summarizing-data"}},p={},s=[{value:"Introduction",id:"introduction",level:2},{value:"Filtering data based on Conditions",id:"filtering-data-based-on-conditions",level:2},{value:"Filtering based on exact match of attribute",id:"filtering-based-on-exact-match-of-attribute",level:3},{value:"Filtering based on regex pattern",id:"filtering-based-on-regex-pattern",level:3},{value:"Filtering based on multiple criteria",id:"filtering-based-on-multiple-criteria",level:3},{value:"Modifying, removing and replacing attributes",id:"modifying-removing-and-replacing-attributes",level:2},{value:"Handling attributes with <code>null</code> values",id:"handling-attributes-with-null-values",level:2}],m={toc:s};function d(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},m,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"filtering-data"},"Filtering Data"),(0,r.kt)("h2",{id:"introduction"},"Introduction"),(0,r.kt)("p",null,"When you receive input data, it may consist of data that is not required to generate the required output, null values for certain attributes, etc.  You can filter data to refine the received data. "),(0,r.kt)("h2",{id:"filtering-data-based-on-conditions"},"Filtering data based on Conditions"),(0,r.kt)("p",null,"To understand the different ways you can filter the specific data you need to transform and enrich in order to generate the required output, follow the procedures below:"),(0,r.kt)("h3",{id:"filtering-based-on-exact-match-of-attribute"},"Filtering based on exact match of attribute"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Start creating a new stream worker. For more information, see ",(0,r.kt)("a",{parentName:"p",href:"/docs/cep/tutorials/create-stream-app"},"Creating a Stream Worker"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Enter a name for the stream worker via the ",(0,r.kt)("inlineCode",{parentName:"p"},"@App:name")," annotation. In this example, let's name it ",(0,r.kt)("inlineCode",{parentName:"p"},"TemperatureApp"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Define an input stream to specify the schema based on which events are selected."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE STREAM InputTempStream (deviceID long, roomNo string, temp double);\n")),(0,r.kt)("blockquote",{parentName:"li"},(0,r.kt)("ul",{parentName:"blockquote"},(0,r.kt)("li",{parentName:"ul"},"For more information about defining input streams to receive events, see the ",(0,r.kt)("a",{parentName:"li",href:"/docs/cep/tutorials/consuming-data"},"Consuming Data"),".")))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Define an output stream ",(0,r.kt)("inlineCode",{parentName:"p"},"Room2233Stream")," to emit the result"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"  CREATE SINK Room2233Stream WITH (type='stream', stream='Room2233Stream', map.type='json') (deviceID long, roomNo string, temp double);\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Add a query to generate filtered temperature readings as follows. For this example, let's assume that you want to filter only temperature readings for a specific room number (e.g., room no ",(0,r.kt)("inlineCode",{parentName:"p"},"2233"),")."),(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Add the ",(0,r.kt)("inlineCode",{parentName:"p"},"from")," clause and enter ",(0,r.kt)("inlineCode",{parentName:"p"},"InputTempStream")," as the input stream from which the input data. However, because you only need to extract readings for room no ",(0,r.kt)("inlineCode",{parentName:"p"},"2233"),", include a filter in the ",(0,r.kt)("inlineCode",{parentName:"p"},"from")," clause as shown below:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"FROM InputTempStream [roomNo=='2233']\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Add the ",(0,r.kt)("inlineCode",{parentName:"p"},"select")," clause with ",(0,r.kt)("inlineCode",{parentName:"p"},"*")," to indicate that all the attributes should be selected without any changes."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT *\nFROM InputTempStream [roomNo=='2233']\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Add the ",(0,r.kt)("inlineCode",{parentName:"p"},"insert into")," clause and direct the output to a stream named ",(0,r.kt)("inlineCode",{parentName:"p"},"Room2233Stream"),"."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"INSERT INTO Room2233Stream\nSELECT *\nFROM InputTempStream [roomNo=='2233']\n")),(0,r.kt)("admonition",{parentName:"li",type:"tip"},(0,r.kt)("pre",{parentName:"admonition"},(0,r.kt)("code",{parentName:"pre"},"As a best practice, name your queries using the `@info` annotation. In this example, you can name the query `Filtering` as follows.\n"))),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"@info(name = 'Get temperature for roomNo: 2233')\nINSERT INTO Room2233Stream\nSELECT *\nFROM InputTempStream [roomNo=='2233']\n"))))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"The saved stream worker is as follows:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"@App:name(\"TemperatureApp\")\n@App:description(\"This stream worker receives an object with properties 'deviceID', 'roomNo', and 'temp' in InputTempStream, if the roomNo is '2233', the query will send the object to Room2233Stream\")\n@App:qlVersion(\"2\")\n\nCREATE STREAM InputTempStream (deviceID long, roomNo string, temp double);\n\nCREATE SINK Room2233Stream WITH (type='stream', stream='Room2233Stream', map.type='json') (deviceID long, roomNo string, temp double);\n\n@info(name = 'Get temperature for roomNo: 2233')\nINSERT INTO Room2233Stream\nSELECT *\nFROM InputTempStream [roomNo=='2233'];\n")))),(0,r.kt)("h3",{id:"filtering-based-on-regex-pattern"},"Filtering based on regex pattern"),(0,r.kt)("p",null,"You can filter events by providing a condition where only events that match a specific Regex pattern are taken for further processing."),(0,r.kt)("p",null,"For this purpose, you can use the ",(0,r.kt)("inlineCode",{parentName:"p"},"TemperatureApp")," stream worker that you created in the previous example. However, instead of filtering the readings for a specific room no, you can filter the readings for many rooms of which the room number matches a specific regex pattern."),(0,r.kt)("p",null,"Assume that you want to filter the temperature readings for a specific rage of rooms located in the Southern wing and used for purpose B. Also assume that this can be derived from the room number because the first three characters of the room no represent the wing, and the eighth character represents the purpose. e.g., in room no ",(0,r.kt)("inlineCode",{parentName:"p"},"SOU5438B765"),", the first three characters ",(0,r.kt)("inlineCode",{parentName:"p"},"SOU")," represent the Southern wing, and the eighth character ",(0,r.kt)("inlineCode",{parentName:"p"},"B")," represents purpose B."),(0,r.kt)("p",null,"To filter events as described, follow the procedure below."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Open the ",(0,r.kt)("inlineCode",{parentName:"p"},"TemperatureApp")," stream worker.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Create a new query named ",(0,r.kt)("inlineCode",{parentName:"p"},"FilteredRoomRange")," as follows:"),(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Add ",(0,r.kt)("inlineCode",{parentName:"p"},"select")," statement to project the fields:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT deviceID, roomNo, temp\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Add a ",(0,r.kt)("inlineCode",{parentName:"p"},"from")," clause as follows to get the required events from the ",(0,r.kt)("inlineCode",{parentName:"p"},"InputTempStream")," stream."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"FROM InputTempStream[regex:matches('SOU(.*)B(.*)', roomNo)];\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Add the ",(0,r.kt)("inlineCode",{parentName:"p"},"insert to")," clause as follows to insert the results into a stream named ",(0,r.kt)("inlineCode",{parentName:"p"},"FilteredResultsStream"),"."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"INSERT INTO FilteredResultsStream\n")),(0,r.kt)("p",{parentName:"li"},"The completed query is as follows."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"@info(name = 'Southern wing room range filter')\nINSERT INTO FilteredResultsStream\nSELECT deviceID, roomNo, temp\nFROM InputTempStream[regex:matches('SOU(.*)B(.*)', roomNo)];\n"))))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Save the stream worker.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"The completed stream worker looks as follows."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"@App:name(\"TemperatureApp1\")\n@App:description(\"Streams Room2233Stream and FilteredResultsStream are waiting for results from queries 'Get temperature for roomNo: 2233' and 'Southern wing room range filter'\")\n@App:qlVersion(\"2\")\n\n/*\n\nPart-1: This stream worker receives an object with properties 'deviceID', 'roomNo', and 'temp' in InputTempStream. If the roomNo is '2233', the query will send the object to Room2233Stream \n\nPart 2: The FilteredRoomRange query will filter values using a regular expression. In this case, any roomNo starting with 'SOU' with some random characters plus a 'B' plus some random character will match the pattern, and the object that matches that expression will be sent to 'FilteredResultsStream'\n\n*/\n\nCREATE STREAM InputTempStream (deviceID long, roomNo string, temp double);\n\nCREATE SINK Room2233Stream WITH (type='stream', stream='Room2233Stream', map.type='json') (deviceID long, roomNo string, temp double);\n\nCREATE SINK FilteredResultsStream WITH (type='stream', stream='FilteredResultsStream', map.type='json') (deviceID long, roomNo string, temp double);\n\n@info(name = 'Get temperature for roomNo: 2233')\nINSERT INTO Room2233Stream\nSELECT *\nFROM InputTempStream [roomNo=='2233'];\n\n@info(name = 'Southern wing room range filter')\nINSERT INTO FilteredResultsStream\nSELECT deviceID, roomNo, temp\nFROM InputTempStream[regex:matches('SOU(.*)B(.*)', roomNo)];\n")))),(0,r.kt)("h3",{id:"filtering-based-on-multiple-criteria"},"Filtering based on multiple criteria"),(0,r.kt)("p",null,"For this purpose, you can use the ",(0,r.kt)("inlineCode",{parentName:"p"},"TemperatureApp")," stream worker that you created in the example under ",(0,r.kt)("strong",{parentName:"p"},"Filtering based on exact match of attribute")," section. However, instead of filtering only readings for room No ",(0,r.kt)("inlineCode",{parentName:"p"},"2233"),", assume that you need to filter the readings for a range of rooms (e.g., rooms 100-210) where the temperature is greater than 40. For this, you can update the filter as follows."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"@App:name(\"TemperatureApp2\")\n@App:description(\"This stream worker receives a object with properties 'deviceID', 'roomNo', and 'temp' in InputTempStream, If roomNo is 2233, and temperature is more than 20 and less than 50 degrees, and where deviceID is more than 1 and less than 9, send the object to the stream\")\n@App:qlVersion(\"2\")\n\nCREATE STREAM InputTempStream (deviceID long, roomNo string, temp double);\n    \nCREATE SINK Room2233Stream WITH (type='stream', stream='Room2233Stream', map.type='json') (deviceID long, roomNo string, temp double);\n    \n@info(name = 'Get temperature for roomNo: 2233')\nINSERT INTO Room2233Stream\nSELECT *\nFROM InputTempStream [(temp > 20 AND temp < 50) AND (deviceID > 1 AND deviceID < 9) AND roomNo == \"2233\"];\n")),(0,r.kt)("p",null,"Here, the ",(0,r.kt)("inlineCode",{parentName:"p"},"AND")," logical expression is used to indicate that both the filter conditions provided need to be considered."),(0,r.kt)("h2",{id:"modifying-removing-and-replacing-attributes"},"Modifying, removing and replacing attributes"),(0,r.kt)("p",null,"The input data may include attributes that are not required in order to generate the required output, attributes with values that need to be updated or replaced before further processing. "),(0,r.kt)("p",null,"Assume that in the previous example, you do not need the device ID for further processing, and you need to remove some unnecessary white spaces from the ",(0,r.kt)("inlineCode",{parentName:"p"},"roomNo")," before sending the input data for further processing. To do this, follow the procedure below:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Open the ",(0,r.kt)("inlineCode",{parentName:"p"},"TemperatureApp")," stream worker that you previously created in the ",(0,r.kt)("a",{parentName:"p",href:"##filtering-data-based-on-conditions"},"Filtering data based on conditions")," section and start adding a new query. You can name it as ",(0,r.kt)("inlineCode",{parentName:"p"},"CleaningData")," as shown below."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"@info(name = 'CleaningData')\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Add the ",(0,r.kt)("inlineCode",{parentName:"p"},"from")," clause and enter ",(0,r.kt)("inlineCode",{parentName:"p"},"FilteredResultsStream")," as the input stream from which the input data is taken."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"FROM FilteredResultsStream\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Let's create the ",(0,r.kt)("inlineCode",{parentName:"p"},"select")," statement as follows."),(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"To select only the ",(0,r.kt)("inlineCode",{parentName:"p"},"roomNo")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"temp")," attributes for further processing and remove the ",(0,r.kt)("inlineCode",{parentName:"p"},"deviceID")," attribute, add them as follows."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT str:trim(roomNo) AS roomNo, temp\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"To remove the unnecessary white spaces from the room number, add the ",(0,r.kt)("inlineCode",{parentName:"p"},"trim()")," function as shown below."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"str:trim(roomNo) AS roomNo\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Now the completed ",(0,r.kt)("inlineCode",{parentName:"p"},"select")," statement is as follows."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT str:trim(roomNo) AS roomNo, temp\n"))))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Insert the results into an output stream as follows."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"INSERT INTO CleansedDataStream\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"The completed query is as follows:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"@info(name = 'CleaningData')\nINSERT INTO CleansedDataStream\nSELECT str:trim(roomNo) AS roomNo, temp\nFROM FilteredResultsStream;\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"The complete stream worker looks as follows"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"@App:name(\"TemperatureApp3\")\n@App:description(\"\")\n@App:qlVersion(\"2\")\n\n/*\n\nPart 1: The  'Southern wing room range filter' query will filter values using a regular expression. In this case, any roomNo starting with 'SOU' with some random characters plus a 'B' plus some random character will match the pattern, and the object that matches that expression will be sent to 'FilteredResultsStream'\n\nPart 2: The query 'CleaningData' eliminates the deviceID property and any unnecessary white spaces\n\n*/\n\nCREATE STREAM InputTempStream (deviceID long, roomNo string, temp double);\n\nCREATE SINK FilteredResultsStream WITH (type='stream', stream='FilteredResultsStream', map.type='json') (deviceID long, roomNo string, temp double);\n\nCREATE SINK CleansedDataStream WITH (type='stream', stream='CleansedDataStream', map.type='json') (roomNo string, temp double);\n\n@info(name = 'Southern wing room range filter')\nINSERT INTO FilteredResultsStream\nSELECT deviceID, roomNo, temp\nFROM InputTempStream[regex:matches('SOU(.*)B(.*)', roomNo)];\n\n@info(name = 'CleaningData')\nINSERT INTO CleansedDataStream\nSELECT str:trim(roomNo) AS roomNo, temp\nFROM FilteredResultsStream;\n")))),(0,r.kt)("p",null,"Modifying and replacing is also demonstrated in the ",(0,r.kt)("a",{parentName:"p",href:"/docs/cep/enrich-data/"},"Enrich Data")," and ",(0,r.kt)("a",{parentName:"p",href:"/docs/cep/tutorials/transforming-data"},"Transforming Data")," pages."),(0,r.kt)("h2",{id:"handling-attributes-with-null-values"},"Handling attributes with ",(0,r.kt)("inlineCode",{parentName:"h2"},"null")," values"),(0,r.kt)("p",null,"To understand this section, you can reuse the ",(0,r.kt)("inlineCode",{parentName:"p"},"TemperatureApp")," stream worker that you created in the ",(0,r.kt)("a",{parentName:"p",href:"##filtering-data-based-on-conditions"},"Filtering data based on conditions"),"."),(0,r.kt)("p",null,"Assume that some events arrive with null values for the ",(0,r.kt)("inlineCode",{parentName:"p"},"roomNo")," attribute, and you want to assign the value ",(0,r.kt)("inlineCode",{parentName:"p"},"unknown")," in such scenarios."),(0,r.kt)("p",null,"To do this, follow the procedure below:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Start adding a new query to the ",(0,r.kt)("inlineCode",{parentName:"p"},"TemperatureApp")," stream worker. You can name it ",(0,r.kt)("inlineCode",{parentName:"p"},"AddingMissingValues")," as follows."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"@info(name = 'AddingMissingValues')\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Add the ",(0,r.kt)("inlineCode",{parentName:"p"},"from")," clause and enter ",(0,r.kt)("inlineCode",{parentName:"p"},"FilteredResultsStream")," as the input stream from which the input data is taken."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"FROM FilteredResultsStream\n")))),(0,r.kt)("blockquote",null,(0,r.kt)("ul",{parentName:"blockquote"},(0,r.kt)("li",{parentName:"ul"},"Here, we are using the inferred output stream of the previous query as the input stream for this query. As a\nresult, the changes made via this query are applied to the filtered data."))),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Add the ",(0,r.kt)("inlineCode",{parentName:"p"},"select")," clause. To assign ",(0,r.kt)("inlineCode",{parentName:"p"},"unknown")," as the value for the ",(0,r.kt)("inlineCode",{parentName:"p"},"roomNo")," attribute when it has a null value, you\nneed to use the ",(0,r.kt)("inlineCode",{parentName:"p"},"ifThenElse")," function as shown below."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},'ifThenElse(roomNo is null, "UNKNOWN", str:trim(roomNo)) as roomNo\n')),(0,r.kt)("p",{parentName:"li"}," Select the ",(0,r.kt)("inlineCode",{parentName:"p"},"deviceID")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"temp")," attributes can be selected without any changes. The query updated with the ",(0,r.kt)("inlineCode",{parentName:"p"},"select")," clause now looks as follows."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},'SELECT deviceID, ifThenElse(roomNo is null, "UNKNOWN", str:trim(roomNo)) AS roomNo, temp\n'))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Insert the results into an output stream as follows. ",(0,r.kt)("inlineCode",{parentName:"p"},"insert into CleansedDataStream"),". The completed query now looks as follows."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"@info(name = 'AddingMissingValues')\nINSERT INTO CleansedDataStream\nSELECT ifThenElse(roomNo is null, \"UNKNOWN\", str:trim(roomNo)) as roomNo, temp\nFROM FilteredResultsStream;\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"The complete stream worker looks as follows."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"@App:name(\"TemperatureApp3\")\n@App:description(\"\")\n@App:qlVersion(\"2\")\n\n/*\n\nPart 1: The  'Southern wing room range filter' query will filter values using a regular expression. In this case, any roomNo starting with 'SOU' with some random characters plus a 'B' plus some random character will match the pattern, and the object that matches that expression will be sent to 'FilteredResultsStream'\n\nPart 2: The query 'CleaningData' eliminates the deviceID property and any unnecessary white spaces\n\n*/\n\nCREATE STREAM InputTempStream (deviceID long, roomNo string, temp double);\n\nCREATE SINK FilteredResultsStream WITH (type='stream', stream='FilteredResultsStream', map.type='json') (deviceID long, roomNo string, temp double);\n\nCREATE SINK CleansedDataStream WITH (type='stream', stream='CleansedDataStream', map.type='json') (roomNo string, temp double);\n\n@info(name = 'Southern wing room range filter')\nINSERT INTO FilteredResultsStream\nSELECT deviceID, roomNo, temp\nFROM InputTempStream[regex:matches('SOU(.*)B(.*)', roomNo)];\n\n@info(name = 'AddingMissingValues')\nINSERT INTO CleansedDataStream\nSELECT ifThenElse(roomNo is null, \"UNKNOWN\", str:trim(roomNo)) as roomNo, temp\nFROM FilteredResultsStream;\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Save the stream worker."))))}d.isMDXComponent=!0}}]);