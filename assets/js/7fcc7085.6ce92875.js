"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[33104],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>y});var r=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=r.createContext({}),c=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=c(e.components);return r.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=c(n),y=o,h=d["".concat(s,".").concat(y)]||d[y]||u[y]||a;return n?r.createElement(h,i(i({ref:t},p),{},{components:n})):r.createElement(h,i({ref:t},p))}));function y(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,i=new Array(a);i[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,i[1]=l;for(var c=2;c<a;c++)i[c]=n[c];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},72738:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>u,frontMatter:()=>a,metadata:()=>l,toc:()=>c});var r=n(87462),o=(n(67294),n(3905));const a={sidebar_position:15,title:"WITH"},i=void 0,l={unversionedId:"queryworkers/c8ql/operations/with",id:"queryworkers/c8ql/operations/with",title:"WITH",description:"A C8QL query can optionally start with a WITH statement and the list of collections used by the query. All collections specified in WITH will be read-locked at query start, in addition to the other collections the query uses and that are detected by the C8QL query parser.",source:"@site/docs/queryworkers/c8ql/operations/with.md",sourceDirName:"queryworkers/c8ql/operations",slug:"/queryworkers/c8ql/operations/with",permalink:"/docs/queryworkers/c8ql/operations/with",draft:!1,editUrl:"https://github.com/macrometacorp/docs/edit/main/docs/queryworkers/c8ql/operations/with.md",tags:[],version:"current",sidebarPosition:15,frontMatter:{sidebar_position:15,title:"WITH"},sidebar:"defaultSidebar",previous:{title:"UPSERT",permalink:"/docs/queryworkers/c8ql/operations/upsert"},next:{title:"Functions",permalink:"/docs/queryworkers/c8ql/functions/"}},s={},c=[],p={toc:c};function u(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"A C8QL query can optionally start with a ",(0,o.kt)("inlineCode",{parentName:"p"},"WITH")," statement and the list of collections used by the query. All collections specified in ",(0,o.kt)("inlineCode",{parentName:"p"},"WITH")," will be read-locked at query start, in addition to the other collections the query uses and that are detected by the C8QL query parser."),(0,o.kt)("p",null,"Specifying further collections in ",(0,o.kt)("inlineCode",{parentName:"p"},"WITH")," can be useful for queries that dynamically access collections (e.g. via traversals or via dynamic document access functions such as ",(0,o.kt)("inlineCode",{parentName:"p"},"DOCUMENT()"),"). Such collections may be invisible to the C8QL query parser at query compile time, and thus will not be read-locked automatically at query start. "),(0,o.kt)("p",null,"In this case, the C8QL execution engine will lazily lock these collections whenever they are used, which can lead to deadlock with other queries. In case such deadlock is detected, the query will automatically be aborted and changes will be rolled back. In this case the client application can try sending the query again."),(0,o.kt)("p",null,"However, if client applications specify the list of used collections for all their queries using ",(0,o.kt)("inlineCode",{parentName:"p"},"WITH"),", then no deadlocks will happen and no queries will be aborted due to deadlock situations."),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},(0,o.kt)("inlineCode",{parentName:"p"},"WITH")," is required for traversals in a clustered environment in order to avoid deadlocks.")),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"For queries that access only a single collection or that have all collection names specified somewhere else in the query string, there is no need to use ",(0,o.kt)("inlineCode",{parentName:"p"},"WITH"),".")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"WITH")," is only useful when the C8QL query parser cannot automatically figure out which collections are going to be used by the query. ",(0,o.kt)("inlineCode",{parentName:"p"},"WITH")," is only useful for queries that dynamically access collections, e.g. via traversals, shortest path operations or the ",(0,o.kt)("inlineCode",{parentName:"p"},"DOCUMENT()")," function."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"WITH managers, usersHaveManagers\nFOR v, e, p IN OUTBOUND 'users/1' GRAPH 'userGraph'\n  RETURN { v, e, p }\n")),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"Constant ",(0,o.kt)("inlineCode",{parentName:"p"},"WITH")," is also a keyword that is used in other contexts, for example in ",(0,o.kt)("inlineCode",{parentName:"p"},"UPDATE")," statements. If ",(0,o.kt)("inlineCode",{parentName:"p"},"WITH")," is used to specify the extra list of collections, then it must be placed at the very start of the query string.")))}u.isMDXComponent=!0}}]);