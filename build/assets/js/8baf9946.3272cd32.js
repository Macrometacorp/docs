"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[9349],{3905:function(e,n,t){t.d(n,{Zo:function(){return m},kt:function(){return d}});var a=t(67294);function s(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){s(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,a,s=function(e,n){if(null==e)return{};var t,a,s={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(s[t]=e[t]);return s}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(s[t]=e[t])}return s}var l=a.createContext({}),c=function(e){var n=a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},m=function(e){var n=c(e.components);return a.createElement(l.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},p=a.forwardRef((function(e,n){var t=e.components,s=e.mdxType,o=e.originalType,l=e.parentName,m=i(e,["components","mdxType","originalType","parentName"]),p=c(t),d=s,g=p["".concat(l,".").concat(d)]||p[d]||u[d]||o;return t?a.createElement(g,r(r({ref:n},m),{},{components:t})):a.createElement(g,r({ref:n},m))}));function d(e,n){var t=arguments,s=n&&n.mdxType;if("string"==typeof e||s){var o=t.length,r=new Array(o);r[0]=p;var i={};for(var l in n)hasOwnProperty.call(n,l)&&(i[l]=n[l]);i.originalType=e,i.mdxType="string"==typeof e?e:s,r[1]=i;for(var c=2;c<o;c++)r[c]=t[c];return a.createElement.apply(null,r)}return a.createElement.apply(null,t)}p.displayName="MDXCreateElement"},58215:function(e,n,t){t.d(n,{Z:function(){return s}});var a=t(67294);function s(e){var n=e.children,t=e.hidden,s=e.className;return a.createElement("div",{role:"tabpanel",hidden:t,className:s},n)}},9877:function(e,n,t){t.d(n,{Z:function(){return m}});var a=t(87462),s=t(67294),o=t(72389),r=t(17984),i=t(86010),l="tabItem_LplD";function c(e){var n,t,o,c=e.lazy,m=e.block,u=e.defaultValue,p=e.values,d=e.groupId,g=e.className,h=s.Children.map(e.children,(function(e){if((0,s.isValidElement)(e)&&void 0!==e.props.value)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),b=null!=p?p:h.map((function(e){var n=e.props;return{value:n.value,label:n.label,attributes:n.attributes}})),y=(0,r.lx)(b,(function(e,n){return e.value===n.value}));if(y.length>0)throw new Error('Docusaurus error: Duplicate values "'+y.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.');var f=null===u?u:null!=(n=null!=u?u:null==(t=h.find((function(e){return e.props.default})))?void 0:t.props.value)?n:null==(o=h[0])?void 0:o.props.value;if(null!==f&&!b.some((function(e){return e.value===f})))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+f+'" but none of its children has the corresponding value. Available values are: '+b.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");var v=(0,r.UB)(),k=v.tabGroupChoices,w=v.setTabGroupChoices,N=(0,s.useState)(f),_=N[0],x=N[1],S=[],C=(0,r.o5)().blockElementScrollPositionUntilNextRender;if(null!=d){var T=k[d];null!=T&&T!==_&&b.some((function(e){return e.value===T}))&&x(T)}var E=function(e){var n=e.currentTarget,t=S.indexOf(n),a=b[t].value;a!==_&&(C(n),x(a),null!=d&&w(d,a))},O=function(e){var n,t=null;switch(e.key){case"ArrowRight":var a=S.indexOf(e.currentTarget)+1;t=S[a]||S[0];break;case"ArrowLeft":var s=S.indexOf(e.currentTarget)-1;t=S[s]||S[S.length-1]}null==(n=t)||n.focus()};return s.createElement("div",{className:"tabs-container"},s.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.Z)("tabs",{"tabs--block":m},g)},b.map((function(e){var n=e.value,t=e.label,o=e.attributes;return s.createElement("li",(0,a.Z)({role:"tab",tabIndex:_===n?0:-1,"aria-selected":_===n,key:n,ref:function(e){return S.push(e)},onKeyDown:O,onFocus:E,onClick:E},o,{className:(0,i.Z)("tabs__item",l,null==o?void 0:o.className,{"tabs__item--active":_===n})}),null!=t?t:n)}))),c?(0,s.cloneElement)(h.filter((function(e){return e.props.value===_}))[0],{className:"margin-vert--md"}):s.createElement("div",{className:"margin-vert--md"},h.map((function(e,n){return(0,s.cloneElement)(e,{key:n,hidden:e.props.value!==_})}))))}function m(e){var n=(0,o.Z)();return s.createElement(c,(0,a.Z)({key:String(n)},e))}},300:function(e,n,t){t.r(n),t.d(n,{assets:function(){return p},contentTitle:function(){return m},default:function(){return h},frontMatter:function(){return c},metadata:function(){return u},toc:function(){return d}});var a=t(87462),s=t(63366),o=(t(67294),t(3905)),r=t(9877),i=t(58215),l=["components"],c={sidebar_position:1,title:"Quickstart"},m="Quickstart with Streams",u={unversionedId:"streams/quickstart",id:"streams/quickstart",title:"Quickstart",description:"Overview",source:"@site/docs/streams/quickstart.md",sourceDirName:"streams",slug:"/streams/quickstart",permalink:"/docs/streams/quickstart",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,title:"Quickstart"},sidebar:"tutorialSidebar",previous:{title:"Concepts",permalink:"/docs/streams/concepts"},next:{title:"Using Rest API",permalink:"/docs/streams/tutorials/using_rest_api"}},p={},d=[{value:"Overview",id:"overview",level:2},{value:"Pre-requisite",id:"pre-requisite",level:2},{value:"Installation",id:"installation",level:2},{value:"Connect to GDN",id:"connect-to-gdn",level:2},{value:"Get GeoFabric Details",id:"get-geofabric-details",level:2},{value:"Create Global &amp; Local Streams",id:"create-global--local-streams",level:2},{value:"Publish Messages",id:"publish-messages",level:2},{value:"Subscribe to Stream",id:"subscribe-to-stream",level:2},{value:"Auto Reconnect streams",id:"auto-reconnect-streams",level:2},{value:"Pub-Sub with streams in browser",id:"pub-sub-with-streams-in-browser",level:2}],g={toc:d};function h(e){var n=e.components,t=(0,s.Z)(e,l);return(0,o.kt)("wrapper",(0,a.Z)({},g,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"quickstart-with-streams"},"Quickstart with Streams"),(0,o.kt)("h2",{id:"overview"},"Overview"),(0,o.kt)("p",null,"Globally distributed applications need a geo distributed fast data platform that can transparently replicate the data anywhere in the world to enable the applications to operate on a copy of the data that's close to its users. Similarly the applications need geo-replicated as well as local streams to handle pub-sub, ETL and real-time updates from the fast data platform."),(0,o.kt)("p",null,"Macrometa global data network (GDN) is a fully managed realtime materialzed view engine that provides access to data instantly to Apps & APIs in a simple & single interface.  "),(0,o.kt)("p",null,"This article is an introduction to using streams with ",(0,o.kt)("a",{parentName:"p",href:"https://pyc8.readthedocs.io/en/latest/"},"pyC8")," and ",(0,o.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/jsc8"},"jsC8")," drivers."),(0,o.kt)("p",null,"GDN streams are a high-performance solution for server-to-server messaging. It provides,"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Seamless geo-replication of messages across regions,"),(0,o.kt)("li",{parentName:"ul"},"Very low publish and end-to-end latency,"),(0,o.kt)("li",{parentName:"ul"},"Seamless scalability to over a million topics."),(0,o.kt)("li",{parentName:"ul"},"Multiple subscription modes (",(0,o.kt)("inlineCode",{parentName:"li"},"exclusive"),", ",(0,o.kt)("inlineCode",{parentName:"li"},"shared"),", and ",(0,o.kt)("inlineCode",{parentName:"li"},"failover"),") for streams."),(0,o.kt)("li",{parentName:"ul"},"Guaranteed message delivery with persistent message storage.")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"Streams")," are built on the ",(0,o.kt)("em",{parentName:"p"},"publish-subscribe")," pattern, aka pub-sub. In this pattern, producers publish messages to streams. Consumers can then subscribe to those streams, process incoming messages, and send an acknowledgement when processing is complete."),(0,o.kt)("p",null,"Once a subscription has been created, all messages will be retained by Streams, even if the consumer gets disconnected Retained messages will be discarded only when a consumer acknowledges that they've been successfully processed."),(0,o.kt)("p",null,'Messages are the basic "unit" of Streams. They\'re what producers publish to streams and what consumers then consume from streams (and acknowledge when the message has been processed). Messages are the analogue of letters in a postal service system.'),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"Component"),(0,o.kt)("th",{parentName:"tr",align:null},"Purpose"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"Value / data payload"),(0,o.kt)("td",{parentName:"tr",align:null},"The data carried by the message. All messages carry raw bytes.")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"Key"),(0,o.kt)("td",{parentName:"tr",align:null},"Messages can optionally be tagged with keys, which can be useful for things like streams compaction")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"Properties"),(0,o.kt)("td",{parentName:"tr",align:null},"An optional key/value map of user-defined properties")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"Producer Name"),(0,o.kt)("td",{parentName:"tr",align:null},"The name of the producer that produced the message (producers are automatically given default names, but you can apply your own explicitly as well)")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"Sequence ID"),(0,o.kt)("td",{parentName:"tr",align:null},"Each message belongs to an ordered sequence on its stream. A message's sequence ID is its ordering in that sequence.")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"Publish Time"),(0,o.kt)("td",{parentName:"tr",align:null},"The timestamp of when the message was published (automatically applied by the producer)")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"Event Time"),(0,o.kt)("td",{parentName:"tr",align:null},"An optional timestamp that applications can attach to the message representing when something happened, e.g. when the message was processed. The event time of a message is 0 if none is explicitly set.")))),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"If you are new to Macrometa GDN, we strongly recommend reading ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("a",{parentName:"strong",href:"/docs/essentials/overview"},"Essentials"))," of Macrometa GDN."))),(0,o.kt)("h2",{id:"pre-requisite"},"Pre-requisite"),(0,o.kt)("p",null,"Let's assume your"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"tenant name is ",(0,o.kt)("inlineCode",{parentName:"li"},"nemo@nautilus.com")," and"),(0,o.kt)("li",{parentName:"ul"},"user password is ",(0,o.kt)("inlineCode",{parentName:"li"},"xxxxxx"),".")),(0,o.kt)("h2",{id:"installation"},"Installation"),(0,o.kt)(r.Z,{groupId:"operating-systems",mdxType:"Tabs"},(0,o.kt)(i.Z,{value:"js",label:"Javascript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"With Yarn or NPM\n\n    yarn add jsc8\n    (or)\n    npm install jsc8\n\nIf you want to use the driver outside of the current directory, you can also install it globally using the `--global` flag:\n\n    npm install --global jsc8\n\nFrom source,\n\n    git clone https://github.com/macrometacorp/jsc8.git\n    cd jsC8\n    npm install\n    npm run dist\n"))),(0,o.kt)(i.Z,{value:"py",label:"Python",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-py"},"pyC8 requires Python 3.5+. Python 3.6 or higher is recommended\n\nTo install pyC8, simply run\n\n    $ pip3 install pyC8\n\nor, if you prefer to use conda:\n\n    conda install -c conda-forge pyC8\n\nor pipenv:\n\n    pipenv install --pre pyC8\n\nOnce the installation process is finished, you can begin developing applications in Python.\n")))),(0,o.kt)("h2",{id:"connect-to-gdn"},"Connect to GDN"),(0,o.kt)("p",null,"The first step in using GDN is to establish a connection to a local region. When this code executes, it initializes the server connection to the region URL you sepcified."),(0,o.kt)(r.Z,{groupId:"operating-systems",mdxType:"Tabs"},(0,o.kt)(i.Z,{value:"js",label:"Javascript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'const jsc8 = require("jsc8");\n// Simple Way\nconst client = new jsc8({url: "https://gdn.paas.macrometa.io", token: "XXXX", fabricName: \'_system\'});\n// ----- OR -----\nconst client = new jsc8({url: "https://gdn.paas.macrometa.io", apiKey: "XXXX", fabricName: \'_system\'});\n\n\n// To use advanced options\nconst client = new jsc8("https://gdn.paas.macrometa.io");\n'))),(0,o.kt)(i.Z,{value:"py",label:"Python",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-py"},"from c8 import C8Client\n\nprint(\"--- Connecting to C8\")\n# Simple Way\nclient = C8Client(protocol='https', host='gdn.paas.macrometa.io', port=443,\n                        email='nemo@nautilus.com', password='xxxxx',\n                        geofabric='_system')\n\n# To use advanced options\nclient = C8Client(protocol='https', host='gdn.paas.macrometa.io', port=443)\n")))),(0,o.kt)("h2",{id:"get-geofabric-details"},"Get GeoFabric Details"),(0,o.kt)("p",null,"To get details of fabric,"),(0,o.kt)(r.Z,{groupId:"operating-systems",mdxType:"Tabs"},(0,o.kt)(i.Z,{value:"js",label:"Javascript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'const jsc8 = require("jsc8");\n\n// Crete a authenticated instance with Token / Apikey\n// const client = new jsc8({url: "https://gdn.paas.macrometa.io", token: "XXXX", fabricName: \'_system\'});\n// const client = new jsc8({url: "https://gdn.paas.macrometa.io", apiKey: "XXXX", fabricName: \'_system\'});\n// await console.log("Authentication done!!...");\n\n// Or use Email & Password to Authenticate client instance\nconst client = new jsc8("https://gdn.paas.macrometa.io");\n\nawait client.login("nemo@nautilus.com", "xxxxxx");\n\nasync function getFabric() {\n  try {\n    await console.log("Getting the fabric details...");\n    let result = await client.get();\n\n    await console.log("result is: ", result);\n  } catch(e){\n    await console.log("Fabric details could not be fetched because "+ e);\n  }\n}\n\ngetFabric();\n'))),(0,o.kt)(i.Z,{value:"py",label:"Python",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-py"},"from c8 import C8Client\nclient = C8Client(protocol='https', host='gdn.paas.macrometa.io', port=443,\n                        email='nemo@nautilus.com', password='xxxxx',\n                        geofabric='_system')\nprint(\"Get geo fabric details...\")\nprint(client.get_fabric_details())\n")))),(0,o.kt)("h2",{id:"create-global--local-streams"},"Create Global & Local Streams"),(0,o.kt)("p",null,"The streams in GDN can be either a local stream or could be a geo-replicated stream."),(0,o.kt)(r.Z,{groupId:"operating-systems",mdxType:"Tabs"},(0,o.kt)(i.Z,{value:"js",label:"Javascript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'const jsc8 = require("jsc8");\n\n// Crete a authenticated instance with Token / Apikey\n// const client = new jsc8({url: "https://gdn.paas.macrometa.io", token: "XXXX", fabricName: \'_system\'});\n// const client = new jsc8({url: "https://gdn.paas.macrometa.io", apiKey: "XXXX", fabricName: \'_system\'});\n// await console.log("Authentication done!!...");\n\n// Or use Email & Password to Authenticate client instance\nconst client = new jsc8("https://gdn.paas.macrometa.io");\n\nawait client.login("nemo@nautilus.com", "xxxxxx");\n\nasync function streams() {\n    try{\n      await console.log("Creating local stream...");\n      const stream_local = await client.createStream("testStream-local", true);\n\n      await console.log("Creating global stream...");\n      const stream_global = await client.createStream("testStream-global", false);\n\n      // FOR ADVANCED USER\n      // await console.log("Creating local stream...");\n      // const stream_local = client.stream("testStream-local", true);\n      // await stream.createStream();\n\n      // await console.log("Creating global stream...");\n      // const stream_global = client.stream("testStream-global", false);\n      // await stream.createStream();\n\n    } catch(e){\n      await console.log("Streams could not be fetched because "+ e);\n    }\n}\n\nstreams();\n'))),(0,o.kt)(i.Z,{value:"py",label:"Python",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-py"},"from c8 import C8Client\n\nprint(\"--- Connecting to C8\")\nclient = C8Client(protocol='https', host='gdn.paas.macrometa.io', port=443,\n                        email='nemo@nautilus.com', password='xxxxx',\n                        geofabric='_system')\n\ndemo_stream = 'demostream'  #Name of the Stream\n\nprint(client.create_stream(demo_stream, local=False))\nprint(client.create_stream(demo_stream, local=True))\n\nprint(\"Get Streams: \", client.get_streams())\n")))),(0,o.kt)("h2",{id:"publish-messages"},"Publish Messages"),(0,o.kt)("p",null,"Example to publish documents to a stream. The stream can be either a local stream or could be a geo-replicated stream."),(0,o.kt)(r.Z,{groupId:"operating-systems",mdxType:"Tabs"},(0,o.kt)(i.Z,{value:"js",label:"Javascript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'const jsc8 = require("jsc8")\n\n// Crete a authenticated instance with Token / Apikey\n// const client = new jsc8({url: "https://gdn.paas.macrometa.io", token: "XXXX", fabricName: \'_system\'});\n// const client = new jsc8({url: "https://gdn.paas.macrometa.io", apiKey: "XXXX", fabricName: \'_system\'});\n// await console.log("Authentication done!!...");\n\n// Or use Email & Password to Authenticate client instance\nconst client = new jsc8("https://gdn.paas.macrometa.io");\n\nawait client.login("nemo@nautilus.com", "xxxxxx");\n\nasync function streams() {\n    try {\n\n      await console.log("Creating local stream...");\n      await client.createStream("my-stream", true);\n\n      const stream = await client.getStream("my-stream", true);\n      await stream.publishMessage("Hello World");\n\n      /*\n\n      // FOR ADVANCED USER\n      const stream = client.stream("my-stream", true);\n      await stream.createStream();\n\n      const producer = stream.producer("test.macrometa.io");\n\n      producer.on("open", () => {\n        // If you message is an object, convert the obj to string.\n        // e.g. const message = JSON.stringify({message:\'Hello World\'});\n        const message = "Hello World";\n        const payloadObj = { payload: Buffer.from(str).toString("base64") };\n        producer.send(JSON.stringify(payloadObj));\n      });\n\n      producer.on("message", (msg) => {\n        console.log(msg, "Sent Successfully");\n      });\n\n      */\n\n    } catch(e) {\n      await console.log("Publishing could not be done because "+ e);\n    }\n}\n\nstreams()\n'))),(0,o.kt)(i.Z,{value:"py",label:"Python",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-py"},'from c8 import C8Client\nimport time\nimport base64\nimport six\nimport json\nimport warnings\nwarnings.filterwarnings("ignore")\n\nprint("--- Connecting to C8")\nclient = C8Client(protocol=\'https\', host=\'gdn.paas.macrometa.io\', port=443,\n                        email=\'nemo@nautilus.com\', password=\'xxxxx\',\n                        geofabric=\'_system\')\n#--------------------------------------------------------------\nprint("publish messages to stream...")\nproducer = client.create_stream_producer("demostream", local=False)\n\nfor i in range(10):\n      msg1 = "Persistent: Hello from " + "("+ str(i) +")"\n      data = {\n        "payload" : base64.b64encode(six.b(msg1)).decode("utf-8")\n      }\n      producer.send(json.dumps(data))\n')))),(0,o.kt)("h2",{id:"subscribe-to-stream"},"Subscribe to Stream"),(0,o.kt)("p",null,"Example to subscribe documents from a stream. The stream can be either a local stream or could be a geo-replicated stream."),(0,o.kt)(r.Z,{groupId:"operating-systems",mdxType:"Tabs"},(0,o.kt)(i.Z,{value:"js",label:"Javascript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'const jsc8 = require(\'jsc8\');\n\n// Crete a authenticated instance with Token / Apikey\n// const client = new jsc8({url: "https://gdn.paas.macrometa.io", token: "XXXX", fabricName: \'_system\'});\n// const client = new jsc8({url: "https://gdn.paas.macrometa.io", apiKey: "XXXX", fabricName: \'_system\'});\n// await console.log("Authentication done!!...");\n\n// Or use Email & Password to Authenticate client instance\nconst client = new jsc8("https://gdn.paas.macrometa.io");\n\nawait client.login("nemo@nautilus.com", "xxxxxx");\n\nasync function getDCList() {\n  let dcListAll = await client.listUserFabrics();\n  let dcListObject = await dcListAll.find(function(o) { return o.name === geo_fabric; });\n  return dcListObject.options.dcList.split(",");\n}\n\n(async function() {\n  const dcList = await getDCList();\n  await console.log("dcList: ", dcList);\n  await client.createStream("my-stream", true);\n  //Here the last boolean value tells if the stream is local or global. false means that it is global.\n  // publishing streams\n  const consumer = await client.createStreamReader("my-stream", "my-subscription", true);\n  consumer.on("message", (msg) => {\n    const { payload, messageId } = JSON.parse(msg);\n    // logging received message payload(ASCII encoded) to decode use atob()\n    console.log(payload);\n    // Send message acknowledgement\n    consumer.send(JSON.stringify({ messageId }));\n  });\n\n})();\n'))),(0,o.kt)(i.Z,{value:"py",label:"Python",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-py"},"  from c8 import C8Client\n  import time\n  import base64\n  import six\n  import json\n  import warnings\n  warnings.filterwarnings(\"ignore\")\n\n  print(\"--- Connecting to C8\")\n  # Simple Way\n  client = C8Client(protocol='https', host='gdn.paas.macrometa.io', port=443,\n                          email='nemo@nautilus.com', password='xxxxx',\n                          geofabric='_system')\n  #--------------------------------------------------------------\n\n  subscriber = client.subscribe(stream=\"demostream\", local=False, subscription_name=\"test-subscription-1\")\n  for i in range(10):\n      print(\"In \",i)\n      m1 = json.loads(subscriber.recv())  #Listen on stream for any receiving msg's\n      msg1 = base64.b64decode(m1[\"payload\"])\n      print(\"Received message '{}' id='{}'\".format(msg1, m1[\"messageId\"])) #Print the received msg over stream\n      subscriber.send(json.dumps({'messageId': m1['messageId']}))#Acknowledge the received msg.\n")))),(0,o.kt)("h2",{id:"auto-reconnect-streams"},"Auto Reconnect streams"),(0,o.kt)("p",null,"Write a wrapper class to keep the connection alive.\nFollowing is an example for the wrapper class"),(0,o.kt)(r.Z,{groupId:"operating-systems",mdxType:"Tabs"},(0,o.kt)(i.Z,{value:"js",label:"Javascript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'/* -------------------------------------------------------------------------- */\n/*                            Stream Wrapper Class                            */\n/* -------------------------------------------------------------------------- */\n\n/*\n  ...\n  // Consumer websocket example\n  const connection = new StreamWebsocket(()=>stream.consumer(name,url))\n  ...\n  ...\n  ...\n  // Producer websocket example -\n  const connection = new StreamWebsocket(()=>stream.producer(url))\n  ...\n\n*/\n\nclass StreamWebsocket {\n  constructor(ws) {\n    /*  Map for Websocket events */\n    this._listeners = {\n      error: [],\n      message: [],\n      open: [],\n      close: [],\n    };\n\n    /* Determines connection should try to reconnect */\n    this._shouldReconnect = true;\n\n    /* Countet to keep track for the Number for Retries for the connection */\n    this._retryCount = -1;\n\n    /* Number of time it will try to reconnect if error */\n    this._maxRetries = Infinity;\n\n    /* Configuration variables for waiting before re-opening the connection */\n    this._maxReconnectionDelay = 10000;\n    this._minReconnectionDelay = 1000 + Math.random() * 4000;\n    this._reconnectionDelayGrowFactor = 1.3;\n\n    this._connectLock = false;\n    this._ws;\n\n    this._getConnection = ws;\n    this._connect();\n  }\n\n  /* --------------------------------- Helpers -------------------------------- */\n\n  /* Encodes a string in base-64. */\n  _btoa(str) {\n    return Buffer.from(str).toString("base64");\n  }\n\n  /* Method to calculate delay before re-opening the connection */\n  _getNextDelay() {\n    let delay = 0;\n\n    if (this._retryCount > 0) {\n      delay =\n        this._minReconnectionDelay *\n        Math.pow(this._reconnectionDelayGrowFactor, this._retryCount - 1);\n      if (delay > this._maxReconnectionDelay) {\n        delay = this._maxReconnectionDelay;\n      }\n    }\n\n    return delay;\n  }\n  /* Method implements delay by returning a promise to resolve when delay completes   */\n  _wait() {\n    return new Promise((resolve) => {\n      setTimeout(resolve, this._getNextDelay());\n    });\n  }\n\n  /* Method triggers callback function attached to sockets events   */\n  _callEventListener(event, listener) {\n    if (typeof listener === \'function\') {\n      listener(event);\n    }\n  }\n\n  /* Attaching callbacks function sockets events   */\n  _addListeners() {\n    if (!this._ws) {\n      return;\n    }\n\n    this._ws.on("open", this._handleOpen.bind(this));\n    this._ws.on("close", this._handleClose.bind(this));\n    this._ws.on("message", this._handleMessage.bind(this));\n    this._ws.on("error", this._handleError.bind(this));\n  }\n\n  /* Method to be triggered on websocket close  */\n  _handleClose(event) {\n    if (this._shouldReconnect) {\n      this._connect();\n    }\n\n    this._listeners.close.forEach((listener) =>\n      this._callEventListener(event, listener)\n    );\n  }\n\n  /* Method to be triggered on websocket message  */\n  _handleMessage(msg) {\n    const parsedMsg = JSON.parse(msg);\n    this._listeners.message.forEach((listener) =>\n      this._callEventListener(parsedMsg, listener)\n    );\n  }\n\n  /* Method to be triggered on websocket error  */\n  _handleError(event) {\n    this._listeners.error.forEach((listener) =>\n      this._callEventListener(event, listener)\n    );\n  }\n\n  /* Method to be triggered on websocket open  */\n  _handleOpen(event) {\n    this._listeners.open.forEach((listener) =>\n      this._callEventListener(event, listener)\n    );\n  }\n\n  /* Method to open a websocket connection  */\n  _connect() {\n    if ((this._connectLock || !this._shouldReconnect) && this._retryCount > 0) {\n      return;\n    }\n\n    this._connectLock = true;\n\n    this._wait().then(() => {\n      if (this._retryCount >= this._maxRetries) {\n        return;\n      }\n      this._ws = this._getConnection();\n      this._connectLock = false;\n      this._retryCount++;\n      this._addListeners();\n    });\n  }\n\n  /* -------------------------------------------------------------------------- */\n\n  /* Method to attach a callback events to connection */\n  on(type, cb) {\n    if (this._listeners[type]) {\n      this._listeners[type].push(cb);\n    }\n  }\n\n  /* Method to send data to websocket */\n  send(msg) {\n    const msgToSend = JSON.stringify({ payload: this._btoa(msg) });\n    this._ws.send(msgToSend);\n  }\n\n  /* Method to send acknowledgment to websocket */\n  ack(messageId) {\n    this._ws.send(JSON.stringify({ messageId }));\n  }\n\n  /* Method to close a websocket */\n  close() {\n    this._shouldReconnect = false;\n    this._ws.close();\n  }\n}\n\nmodule.exports = StreamWebsocket;\n')))),(0,o.kt)("p",null,"Using the above wrapper we will create a producer and consumer, which has auto reconnect mechanism. Following is a sample code for how to handle keep connection alive"),(0,o.kt)(r.Z,{groupId:"operating-systems",mdxType:"Tabs"},(0,o.kt)(i.Z,{value:"js",label:"Javascript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'const jsc8 = require("jsc8");\nconst atob = require("atob");\nconst StreamWebsocket = require("./streamWebsocketWrapper");\n\nvar consumer;\nvar producer;\n\n(async function () {\n  try {\n    const client = new jsc8("URL");\n    await client.login("EMAIL", "PASSWORD");\n\n    const stream = client.stream("STREAM_NAME", "IS_GLOBAL_OR_LOCAL_BOOLEAN");\n\n    // -------------------- CONSUMERS --------------------------\n\n    const initConsumer = () => {\n      return new Promise((resolve, reject) => {\n        consumer = new StreamWebsocket(() =>\n          stream.consumer("CONSUMER_NAME", "DC_NAME")\n        );\n\n        consumer.on("close", () => {\n          console.log("consumer-close", new Date());\n        });\n\n        consumer.on("open", () => {\n          console.log("consumer-open", new Date());\n          resolve();\n        });\n\n        consumer.on("message", (msg) => {\n          const payload = atob(msg.payload);\n            consumer.ack(msg.messageId);\n        });\n\n        consumer.on("error", (e) => {\n          console.log("error", e.message);\n        });\n      });\n    };\n\n    // -------------------- PRODUCERS --------------------------\n\n    const initProducer = () => {\n      producer = new StreamWebsocket(() =>\n        stream.producer("DC_NAME")\n      );\n\n      producer.on("open", () => {\n        console.log("producer-open", new Date());\n      });\n\n      producer.on("close", () => {\n        console.log("producer-close", new Date());\n      });\n\n      producer.on("error", (e) => {\n        console.log("error", e.message);\n      });\n    };\n\n    // ----------------- INIT ---------------------------\n\n    initConsumer().then(() => {\n      initProducer();\n    });\n\n  } catch (e) {\n    console.log(e);\n  }\n})();\n')))),(0,o.kt)("h2",{id:"pub-sub-with-streams-in-browser"},"Pub-Sub with streams in browser"),(0,o.kt)("p",null,"Example to publish messages on a stream and subscribe to that stream to receive messages, with a simple UI"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},'<!DOCTYPE html>\n<html lang="en">\n  <head>\n    <meta charset="UTF-8" />\n    <meta name="viewport" content="width=device-width, initial-scale=1.0" />\n    <title>Pub-Sub demo</title>\n    <link\n      href="https://fonts.googleapis.com/css2?family=Overpass+Mono&display=swap"\n      rel="stylesheet"\n    />\n    <link\n      rel="stylesheet"\n      href="//cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.css"\n    />\n    <link\n      rel="stylesheet"\n      href="//cdnjs.cloudflare.com/ajax/libs/milligram/1.3.0/milligram.css"\n    />\n    <style rel="stylesheet">\n      #console {\n        font-family: "Roboto Mono", monospace !important;\n      }\n    </style>\n  </head>\n\n  <body class="container" style="max-width: none;">\n    <div class="row">\n      <div class="column column-40" style="padding: 20px; height: 100vh;">\n        <h1>Pub Sub Demo</h1>\n\n        <textarea\n          rows="10"\n          style="resize: vertical; height: 200px;"\n          placeholder="Enter your message here..."\n          id="messageBox"\n          disabled\n        ></textarea>\n        <div style="display: flex;">\n          <div style="flex-grow: 1;">\n            <button onclick="init()" class="button-outline" id="startButton">\n              Start\n            </button>\n\n            <button\n              onclick="closeConnection()"\n              class="button-clear"\n              disabled\n              id="closeButton"\n            >\n              Close\n            </button>\n          </div>\n\n          <button onclick="publish()" id="publishButton" disabled>\n            Publish\n          </button>\n        </div>\n      </div>\n      <div\n        id="console"\n        class="column column-60"\n        style="padding: 20px; height: 100vh; background: black; overflow: auto;"\n      ></div>\n    </div>\n  </body>\n  <script type="text/javascript">\n    /* ------------------- API MIDDLEWARE TO MANAGE API CALLS ------------------- */\n\n    class APIRequest {\n      _headers = {\n        Accept: "application/json",\n        "Content-Type": "application/json",\n      };\n\n      constructor(url) {\n        this._url = url;\n      }\n\n      login(email, password) {\n        const endpoint = "/_open/auth";\n\n        const self = this;\n\n        return new Promise(function (resolve, reject) {\n          self\n            .req(endpoint, {\n              body: { email, password },\n              method: "POST",\n            })\n            .then(({ jwt, ...data }) => {\n              self._headers.authorization = `bearer ${jwt}`;\n              resolve(data);\n            })\n            .catch(reject);\n        });\n      }\n\n      _handleResponse(response, resolve, reject) {\n        if (response.ok) {\n          resolve(response.json());\n        } else {\n          reject(response);\n        }\n      }\n\n      req(endpoint, { body, ...options } = {}) {\n        const self = this;\n        return new Promise(function (resolve, reject) {\n          fetch(self._url + endpoint, {\n            headers: self._headers,\n            body: body ? JSON.stringify(body) : undefined,\n            ...options,\n          }).then((response) =>\n            self._handleResponse(response, resolve, reject)\n          );\n        });\n      }\n    }\n\n    /* ---------------------------- PUB-SUB TUTORIAL ---------------------------- */\n\n    const EMAIL = "nemo@nautilus.com";\n    const PASSWORD = "xxxxxx";\n\n    const FEDERATION_NAME = "api-gdn.paas.macrometa.io";\n    const FEDERATION_URL = `https://${FEDERATION_NAME}`;\n\n    const STREAM_NAME = "api_tutorial_streams";\n    const CONSUMER_NAME = "api_tutorial_streams_consumer";\n    const IS_GLOBAL = true;\n\n    /* ------------------------------ UI References ----------------------------- */\n\n    const consoleElement = document.getElementById("console");\n    const input = document.getElementById("messageBox");\n    const startButton = document.getElementById("startButton");\n    const closeButton = document.getElementById("closeButton");\n    const publishButton = document.getElementById("publishButton");\n\n    /* ---------------------------- Global Variables ---------------------------- */\n\n    var consumer;\n    var producer;\n\n    /* ---------------------------- Helpers Functions --------------------------- */\n\n    function checkTime(i) {\n      if (i < 10) {\n        i = "0" + i;\n      }\n      return i;\n    }\n\n    function getTime() {\n      var today = new Date();\n      var h = today.getHours();\n      var m = today.getMinutes();\n      var s = today.getSeconds();\n      // add a zero in front of numbers<10\n      m = checkTime(m);\n      s = checkTime(s);\n      return h + ":" + m + ":" + s;\n    }\n\n    function print(msg) {\n      var node = document.createElement("small");\n\n      node.style =\n        "display:block; font-weight:400;color:white;word-break:break-all;position:relative;padding-left:100px";\n      var span = document.createElement("span");\n      span.style = "position:absolute;left:0";\n\n      var time = document.createTextNode(`> ${getTime()} : `);\n\n      span.appendChild(time);\n\n      var textnode = document.createTextNode(`${msg}`);\n      node.appendChild(span);\n      node.appendChild(textnode);\n      consoleElement.appendChild(node);\n      consoleElement.scrollTop = consoleElement.scrollHeight;\n    }\n\n    function toggleUIButtons(\n      skip = { start: false, publish: false, close: false }\n    ) {\n      if (!skip.start) startButton.disabled = !startButton.disabled;\n      if (!skip.publish) publishButton.disabled = !publishButton.disabled;\n      if (!skip.close) closeButton.disabled = !closeButton.disabled;\n      if (!skip.publish) input.disabled = !input.disabled;\n    }\n\n    /* -------------------------------------------------------------------------- */\n\n    const connection = new APIRequest(FEDERATION_URL);\n\n    const init = async function () {\n      try {\n        toggleUIButtons({ publish: true, close: true });\n\n        /* -------------------- Login (nemo@nautilus.com/xxxxxx) -------------------- */\n\n        const { tenant } = await connection.login(EMAIL, PASSWORD);\n\n        print("Login Successfully using");\n        /* ------------------------------ Create Stream ----------------------------- */\n\n        const stream = await connection.req(\n          `/_fabric/_system/streams/${STREAM_NAME}?global=${IS_GLOBAL}`,\n          {\n            body: { name: STREAM_NAME },\n            method: "POST",\n          }\n        );\n\n        print("STREAM CREATED SUCCESSFULLY");\n\n        /* ----------------- Publish and Subscribe message to stream ---------------- */\n\n        const region = IS_GLOBAL ? "c8global" : "c8local";\n        const streamName = `${region}s.${STREAM_NAME}`;\n\n        // FOR gdn use the below snippet\n        // const url = IS_GLOBAL\n        // ? FEDERATION_NAME;\n        // : `api-${streamApp.streamApps[0].regions[0]}.prod.macrometa.io`\n\n        // #URL_REVIEW : If you have changed your FEDERATION_NAME please review the below code and make required changes to the URL\n        const url = IS_GLOBAL\n          ? FEDERATION_NAME;\n          : `api-${streamApp.streamApps[0].regions[0]}.macrometa.io`\n\n        const consumerUrl = `wss://${url}/_ws/ws/v2/consumer/persistent/${tenant}/${region}._system/${streamName}/${CONSUMER_NAME}`;\n\n        const producerUrl = `wss://${url}/_ws/ws/v2/producer/persistent/${tenant}/${region}._system/${streamName}`;\n\n        /* -------------------------- Initalizing Consumer -------------------------- */\n\n        const initConsumer = () => {\n          return new Promise((resolve) => {\n            consumer = new WebSocket(consumerUrl);\n\n            consumer.onopen = function () {\n              print("Consumer is open now for " + streamName);\n              resolve();\n            };\n\n            consumer.onerror = function () {\n              print(\n                "Failed to establish Consumer connection for " + streamName\n              );\n            };\n\n            consumer.onclose = function () {\n              print("Closed Consumer connection for " + streamName);\n            };\n\n            consumer.onmessage = function (message) {\n              var receivedMsg = message.data && JSON.parse(message.data);\n              print(\n                "------------------ Consumer Message Received -----------------"\n              );\n              print(atob(receivedMsg.payload));\n              print(\n                "--------------------------------------------------------------"\n              );\n\n              const ackMsg = { messageId: receivedMsg.messageId };\n              consumer.send(JSON.stringify(ackMsg));\n            };\n          });\n        };\n\n        /* -------------------------- Initalizing Producer -------------------------- */\n\n        const initProducer = () => {\n          producer = new WebSocket(producerUrl);\n\n          producer.onopen = function () {\n            print("Producer is open now for " + streamName);\n          };\n\n          producer.onclose = function (e) {\n            print("Closed Producer connection for " + streamName);\n          };\n\n          producer.onerror = function (e) {\n            print("Failed to establish Producer connection for " + streamName);\n          };\n        };\n\n        initConsumer().then(() => {\n          initProducer();\n          toggleUIButtons({ start: true });\n          print(\n            "--------------------------------------------------------------"\n          );\n          print(\n            "----------YOU CAN NOW START PUBLISHING YOUR MESSAGES----------"\n          );\n          print(\n            "--------------------------------------------------------------"\n          );\n        });\n      } catch (e) {\n        console.error(e);\n      }\n    };\n\n    function publish() {\n      try {\n        const value = input.value.trim().replace(/(\\r\\n|\\n|\\r)/gm, "");\n        let msgToSend = value;\n\n        if (value[0] === "{" && value.slice(-1) === "}") {\n          msgToSend = JSON.stringify(JSON.parse(input.value));\n        }\n\n        producer.send(JSON.stringify({ payload: btoa(msgToSend) }));\n        print(`Sending message....  : ${msgToSend}`);\n        print(`Producer message sent`);\n      } catch (e) {\n        print(e);\n      }\n    }\n\n    async function closeConnection() {\n      toggleUIButtons();\n\n      consumer.close();\n      print("CONSUMER CLOSING...");\n      producer.close();\n      print("PRODUCER CLOSING...");\n\n      await new Promise((resolve) => setTimeout(resolve, 5000));\n\n      /* ------------------------ Unsubscribe from stream. ------------------------ */\n\n      await connection.req(\n        `/_fabric/_system/_api/streams/unsubscribe/${CONSUMER_NAME}`,\n        {\n          method: "POST",\n        }\n      );\n\n      print(`${CONSUMER_NAME} UNSUBSCRIBED SUCCESSFULLY`);\n    }\n  <\/script>\n</html>\n')))}h.isMDXComponent=!0}}]);