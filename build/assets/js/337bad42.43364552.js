"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[4524],{3905:function(e,t,a){a.d(t,{Zo:function(){return m},kt:function(){return h}});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=n.createContext({}),p=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},m=function(e){var t=p(e.components);return n.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,m=s(e,["components","mdxType","originalType","parentName"]),c=p(a),h=r,u=c["".concat(l,".").concat(h)]||c[h]||d[h]||i;return a?n.createElement(u,o(o({ref:t},m),{},{components:a})):n.createElement(u,o({ref:t},m))}));function h(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,o=new Array(i);o[0]=c;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,o[1]=s;for(var p=2;p<i;p++)o[p]=a[p];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}c.displayName="MDXCreateElement"},4361:function(e,t,a){a.r(t),a.d(t,{assets:function(){return m},contentTitle:function(){return l},default:function(){return h},frontMatter:function(){return s},metadata:function(){return p},toc:function(){return d}});var n=a(87462),r=a(63366),i=(a(67294),a(3905)),o=["components"],s={sidebar_position:5},l="Enriching Data",p={unversionedId:"cep/tutorials/enriching-data",id:"cep/tutorials/enriching-data",title:"Enriching Data",description:"Introduction",source:"@site/docs/cep/tutorials/enriching-data.md",sourceDirName:"cep/tutorials",slug:"/cep/tutorials/enriching-data",permalink:"/docs/cep/tutorials/enriching-data",tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"Transforming Data",permalink:"/docs/cep/tutorials/transforming-data"},next:{title:"Filtering Data",permalink:"/docs/cep/tutorials/filtering-data"}},m={},d=[{value:"Introduction",id:"introduction",level:2},{value:"Enrich data with a Collection",id:"enrich-data-with-a-collection",level:2},{value:"Enrich data with another Stream",id:"enrich-data-with-another-stream",level:2},{value:"Enrich data with External Services",id:"enrich-data-with-external-services",level:2},{value:"Enrich data using built-in Plugins",id:"enrich-data-using-built-in-plugins",level:2}],c={toc:d};function h(e){var t=e.components,a=(0,r.Z)(e,o);return(0,i.kt)("wrapper",(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"enriching-data"},"Enriching Data"),(0,i.kt)("h2",{id:"introduction"},"Introduction"),(0,i.kt)("p",null,"Enriching data involves integrating the data received in the stream with data from c8db or another data stream, or an external service to derive an expected result. To understand the different ways in which this is done, follow the sections below."),(0,i.kt)("h2",{id:"enrich-data-with-a-collection"},"Enrich data with a Collection"),(0,i.kt)("p",null,"This section explains how to enrich the data in a specific stream by joining it with c8db collection. For this purpose, consider\na scenario where you receive sales records generated from multiple locations as events via a system. "),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Open the GUI. Click the ",(0,i.kt)("strong",{parentName:"p"},"Stream Apps")," tab.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Click ",(0,i.kt)("strong",{parentName:"p"},"New")," to define a new stream application.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Type a ",(0,i.kt)("strong",{parentName:"p"},"Name")," for the stream application. For example, ",(0,i.kt)("inlineCode",{parentName:"p"},"EnrichingTransactionsApp"),".")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Type a ",(0,i.kt)("strong",{parentName:"p"},"Description"),".")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Add the following sample stream application.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Define the input stream and the c8db collection that need to be joined as follows."),(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"Define the stream as follows.",(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE STREAM TrasanctionStream (userId long, transactionAmount double, location string);\n"))),(0,i.kt)("li",{parentName:"ol"},"Define the table as follows.",(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE TABLE UserTable (userId long, firstName string, lastName string);\n"))))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Then define the stream query to join the stream and the table, and handle the result as required."),(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Add the ",(0,i.kt)("inlineCode",{parentName:"p"},"from")," clause as follows with the ",(0,i.kt)("inlineCode",{parentName:"p"},"join")," keyword to join the table and the stream."),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"from TransactionStream as t join UserTable as u on t.userId == u.userId\n")),(0,i.kt)("div",{parentName:"li",className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("pre",{parentName:"div"},(0,i.kt)("code",{parentName:"pre"},"Note the following about the `from` clause:\n\n* In this example, the input data is taken from both a stream and a table. You need to assign a unique reference for each of them to allow the query to differentiate between the common attributes. In this example, `TransactionStream` stream is referred to as `t`, and the `UserTable` table is referred to as `u`.\n* The `join ` keyword joins the stream and the table together while specifying the unique references.\n* The condition for the stream and the table to be joined is `t.userId == u.userId `, which means that for an event to be taken from the `TransactionStream` for the join, one or more events that have the same value for the `userId` must exist in the `UserTable` table and vice versa.\n"))))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"To specify how the value for each attribute in the output stream is derived, add a ",(0,i.kt)("inlineCode",{parentName:"p"},"select")," clause as follows."),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-sql"},'select t.userId, str:concat( u.firstName, " ", u.lastName) as userName, transactionAmount, location\n')),(0,i.kt)("div",{parentName:"li",className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("pre",{parentName:"div"},(0,i.kt)("code",{parentName:"pre"},"Note the following in the `select` statement:\n\n* The `userId` attribute name is common to both the stream and the table. Therefore, you need to specify from where this attribute needs gto be taken. Here, you can also specify `u.userId` instead of `t.userId`.\n* You are specifying the output generated to include an attribute named `userName`. The value for that is derived\nby concatenating the values of two attributes in the `UserTable` table (i.e., `firstName` and `lastName` attributes)\nby applying the `str:concat()` function. \n* Similarly, you can apply any of the range of streams functions available to further enrich the joined output.\n"))))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"To infer an output stream into which the enriched data must be directed, add the ",(0,i.kt)("inlineCode",{parentName:"p"},"insert into")," clause as follows.\n",(0,i.kt)("inlineCode",{parentName:"p"},"insert into EnrichedTrasanctionStream;"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"The completed stream application is as follows."),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-sql"},'@App:name("EnrichingTransactionsApp")\n@App:qlVersion("2")\n')))))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'    CREATE STREAM TrasanctionStream (userId long, transactionAmount double, location string);\n\n    CREATE TABLE UserTable (userId long, firstName string, lastName string);\n\n    CREATE STREAM EnrichedTrasanctionStream WITH (type=\'stream\', stream=\'EnrichedTrasanctionStream\', map.type=\'json\') (userId long, userName string, transactionAmount double, location string);\n\n    insert into EnrichedTrasanctionStream\n    select t.userId, str:concat( u.firstName, " ", u.lastName) as userName, transactionAmount, location\n    from TrasanctionStream as t join UserTable as u on t.userId == u.userId ;\n    ```\n\n5. To check whether the above stream application works as expected follow below steps\n\n    1. Load `UserTable` Collection with User Data\n\n        ```json\n        {"userId":1200001,"firstName":"Raleigh","lastName":"McGilvra"}\n        {"userId":1200002,"firstName":"Marty","lastName":"Mueller"}\n        {"userId":1200003,"firstName":"Kelby","lastName":"Mattholie"}\n        ```\n\n    2. Publish events on the `TrasanctionStream`\n\n        ```json\n        {"userId":1200002,"transactionAmount":803,"location":"Chicago"}\n        {"userId":1200001,"transactionAmount":1023,"location":"New York"}\n        ```\n\n    3. You can observe the following events on `EnrichedTrasanctionStream`\n\n        ```json\n        {"event":{"userId":1200002,"userName":"Marty Mueller","transactionAmount":803.0,"location":"Chicago"}}\n        {"event":{"userId":1200001,"userName":"Raleigh McGilvra","transactionAmount":1023.0,"location":"New York"}}\n        ```\n')),(0,i.kt)("h2",{id:"enrich-data-with-another-stream"},"Enrich data with another Stream"),(0,i.kt)("p",null,"This section explains how to enrich the data in a specific stream by joining it with another stream."),(0,i.kt)("p",null,"To understand how this is done, consider a scenario where you receive information about cash withdrawals and cash deposits at different bank branches from two separate applications. Therefore, this two types of information are captured via two separate streams. To compare the withdrawals with deposits and observe whether enough deposits are being made to manage the withdrawals, you need to join both these streams. To do this, follow the procedure below."),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Open the GUI. Click the ",(0,i.kt)("strong",{parentName:"p"},"Stream Apps")," tab.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Click ",(0,i.kt)("strong",{parentName:"p"},"New")," to define a new stream application.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Type a ",(0,i.kt)("strong",{parentName:"p"},"Name")," for the stream application. For example, ",(0,i.kt)("inlineCode",{parentName:"p"},"BankTransactionsApp"),".")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Type a ",(0,i.kt)("strong",{parentName:"p"},"Description"),".")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Define the two input streams via which you are receiving information about withdrawals and deposits."),(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Create a stream named ",(0,i.kt)("inlineCode",{parentName:"p"},"CashWithdrawalStream")," to capture information about withdrawals as follows."),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE STREAM CashWithdrawalStream(branchID int, amount long);\n"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Create a stream named ",(0,i.kt)("inlineCode",{parentName:"p"},"CashDepositsStream")," to capture information about deposits as follows."),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE STREAM CashDepositsStream(branchID string, amount long);\n"))))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Now let's define an output stream to which the combined information from both the input streams need to be directed after the join."),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE STREAM CashFlowStream WITH (type='stream', stream.list='CashFlowStream') (branchID string, withdrawalAmount long, depositAmount long);\n")),(0,i.kt)("p",{parentName:"li"},"!!!info\nA sink annotation is connected to the output stream to publish the output events. For more information about adding sinks to publish events, see the ",(0,i.kt)("a",{parentName:"p",href:"/docs/cep/tutorials/publishing-data"},"Publishing Data guide"),".\n")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"To specify how the join is performed, and how to use the combined information, write a stream query as follows."),(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"To perform the join, add the ",(0,i.kt)("inlineCode",{parentName:"p"},"from")," clause as follows."),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"from CashWithdrawalStream as w\n    join CashDepositStream as d\n    on w.branchID == d.branchID\n")),(0,i.kt)("div",{parentName:"li",className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("pre",{parentName:"div"},(0,i.kt)("code",{parentName:"pre"},"Observe the following about the above `from` clause:\n\n* Both the input streams have attributes of the same name. To identify each name, you must specify a reference\n for each stream. In this example, the reference for the `CashWithdrawalStream` is `w`, and the reference for the `CashDepositsStream` stream is `d`.\n* You need to use `join` as the keyword to join two streams. The join condition is ` w.branchID == d.branchID` \n  where branch IDs are matched. An event in the `CashWithdrawalStream` stream is directed to the `CashFlowStream` if there are events with the same branch ID in the `CashDepositStream` and vice versa.\n"))))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"To specify how the value for each attribute is derived, add a ",(0,i.kt)("inlineCode",{parentName:"p"},"select")," statement as follows."),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"select w.branchID as branchID, w.amount as withdrawals, d.amount as deposits\n")),(0,i.kt)("div",{parentName:"li",className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("pre",{parentName:"div"},(0,i.kt)("code",{parentName:"pre"},"The `branchID` attribute name is common to both input streams. Therefore, you can also specify `d.branchID as branchID` instead of `w.branchId as branchId`.\n"))))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"To filter only events where total cash withdrawals are greater than 95% of the cash deposits, add a ",(0,i.kt)("inlineCode",{parentName:"p"},"having")," clause as follows."),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"having w.amount > d.amount * 0.95 \n"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"To insert the results into the ",(0,i.kt)("inlineCode",{parentName:"p"},"CashFlowStream")," output stream, add the ",(0,i.kt)("inlineCode",{parentName:"p"},"insert into")," clause as follows."),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"insert into CashFlowStream;\n"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"The completed stream application is as follows:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"@App:name(\"BankTransactionsApp\")\n@App:qlVersion(\"2\")\n\nCREATE STREAM CashWithdrawalStream(branchID string, amount long);\n\nCREATE STREAM CashDepositsStream(branchID string, amount long);\n\nCREATE STREAM CashFlowStream WITH (type='stream', stream='CashFlowStream') (branchID string, withdrawalAmount long, depositAmount long);\n\ninsert into CashFlowStream\nselect w.branchID as branchID, w.amount as withdrawalAmount, d.amount as depositAmount\nfrom CashWithdrawalStream as w join CashDepositsStream as d \n    on w.branchID == d.branchID\nhaving w.amount > d.amount * 0.95;\n")))))),(0,i.kt)("p",null,"For the different types of joins you can perform via streams, see ",(0,i.kt)("a",{parentName:"p",href:"/docs/cep/reference/query-guide#join-stream"},"Stream Query Guide - Join")),(0,i.kt)("h2",{id:"enrich-data-with-external-services"},"Enrich data with External Services"),(0,i.kt)("p",null,"This section explains how to enrich the data in a specific stream by connecting with an external service and adding information received from that service to the existing data."),(0,i.kt)("p",null,"To understand how this is done, consider an example where you have some credit card numbers, but need to connect with an external service to identify the credit card companies that issued them, and then save that information in a database."),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Start creating a new stream application. You can name it ",(0,i.kt)("inlineCode",{parentName:"p"},"CCTypeIdentificationApp")," For instructions, see ",(0,i.kt)("a",{parentName:"p",href:"/docs/cep/tutorials/create-stream-app"},"Creating a Stream Application"),".")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Define the input stream from which the input data (i.e., the credit card no in this example) must be taken."),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-js"},"define stream CreditCardStream (creditCardNo string);\n"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"To publish the input data to the external application, connect a sink to the stream you created as shown below. For more information about publishing information, see the ",(0,i.kt)("a",{parentName:"p",href:"/docs/cep/tutorials/publishing-data"},"Publishing Data guide"),"."),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE STREAM CreditCardStream WITH (type='http-request', publisher.url='https://secure.ftipgw.com/ArgoFire/validate.asmx/GetCardType', method='POST', headers=\"'Content-Type:application/x-www-form-urlencoded'\", sink.id=\"cardTypeSink\", sink.map.type='keyvalue', sink.map.payload = (CardNumber='{{creditCardNo}}')) (creditCardNo string);\n")),(0,i.kt)("div",{parentName:"li",className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("pre",{parentName:"div"},(0,i.kt)("code",{parentName:"pre"},"Note the following about the above sink definition:\n- It is assumed that the external application receives requests in HTTP. Therefore, the sink type is `http-request`.\n- The `publisher.url` parameter specifies the URL to which the outgoing events need to be published via HTTP.\n- For more information about the HTTP transport, see [Plugins - HTTP](/docs/cep/reference/extensions/io/http).\n"))))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"To capture the response of the external application once it returns the credit card type, create a stream as follows. For more information about consuming data, see the ",(0,i.kt)("a",{parentName:"p",href:"/docs/cep/tutorials/consuming-data"},"Consuming Data guide"),"."),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE STREAM EnrichedCreditCardStream (creditCardNo string, creditCardType string);\n"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Assuming the external application sends its output via HTTP transport, connect a source of the ",(0,i.kt)("inlineCode",{parentName:"p"},"http"),"type to the ",(0,i.kt)("inlineCode",{parentName:"p"},"EnrichedCreditCardStream")," stream as follows. For more information about consuming events, see the ",(0,i.kt)("a",{parentName:"p",href:"/docs/cep/tutorials/consuming-data"},"Consuming Data guide"),"."),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE STREAM EnrichedCreditCardInfoStream WITH (source.type='http-response', sink.id='cardTypeSink', map.type='xml', map.namespaces = \"xmlns=http://localhost/SmartPayments/\", attributes.creditCardNo = 'trp:creditCardNo',creditCardType = \".\") (creditCardNo string,creditCardType string);\n")),(0,i.kt)("p",{parentName:"li"},"!!!info\nIt is assumed that the external application sends requests in HTTP. Therefore, the source type is ",(0,i.kt)("inlineCode",{parentName:"p"},"http-request"),". For more information about the HTTP transport, see ",(0,i.kt)("a",{parentName:"p",href:"/docs/cep/reference/extensions/io/http"},"Plugins - HTTP"),".\n")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"To save the response of the external application, define a table named ",(0,i.kt)("inlineCode",{parentName:"p"},"CCInfoTable"),"."),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE TABLE CCInfoTable (cardNo long, cardType string);\n"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"To save the data enriched by integrating the information received from the external service, add a stream query as follows."),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"update or insert into CCInfoTable \n    on CCInfoTable.creditCardNo == creditCardNo\nselect *\nfrom EnrichedCreditCardInfoStream;\n")),(0,i.kt)("p",{parentName:"li"},"The above query selects all the attributes in the ",(0,i.kt)("inlineCode",{parentName:"p"},"EnrichedCreditCardInfoStream")," and inserts them into the ",(0,i.kt)("inlineCode",{parentName:"p"},"CCInfoTable")," table. If a specific record already exists,the query updates it by replacing the attribute values with the latest values taken from the ",(0,i.kt)("inlineCode",{parentName:"p"},"EnrichedCreditCardInfoStream"),".\n")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"The completed stream application is as follows:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"@App:name(\"CCTypeIdentificationApp\")\n@App:qlVersion(\"2\")\n\nCREATE STREAM CreditCardStream (creditCardNo string);\n\nCREATE STREAM GetCreditCardInfoStream WITH (type='http-call', publisher.url='http://secure.ftipgw.com/ArgoFire/validate.asmx/GetCardType', method='POST', headers=\"'Content-Type:application/x-www-form-urlencoded'\", sink.id=\"cardTypeSink\", sink.map.type='keyvalue', sink.map.payload = (CardNumber='{{creditCardNo}}')) (creditCardNo string);\n\nCREATE STREAM EnrichedCreditCardInfoStream WITH (source.type='http-response', sink.id='cardTypeSink', map.type='xml', map.namespaces = \"xmlns=http://localhost/SmartPayments/\", attributes.creditCardNo = 'trp:creditCardNo',creditCardType = \".\") (creditCardNo string,creditCardType string);\n\nCREATE TABLE CCInfoTable (creditCardNo string,creditCardType string);\n\ninsert into GetCreditCardInfoStream\nselect creditCardNo\nfrom CreditCardStream;\n\nupdate or insert into CCInfoTable \n    on CCInfoTable.creditCardNo == creditCardNo\nselect *\nfrom EnrichedCreditCardInfoStream;\n")))),(0,i.kt)("h2",{id:"enrich-data-using-built-in-plugins"},"Enrich data using built-in Plugins"),(0,i.kt)("p",null,"The following is a list of stream plugins  with which you can enrich data."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/docs/cep/reference/extensions/execution/streamingml"},"streamingml")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/docs/cep/reference/extensions/execution/math"},"math")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/docs/cep/reference/extensions/execution/time"},"time")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/docs/cep/reference/extensions/execution/json"},"json"))))}h.isMDXComponent=!0}}]);